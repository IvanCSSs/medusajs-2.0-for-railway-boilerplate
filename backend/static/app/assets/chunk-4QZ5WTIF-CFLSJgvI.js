import{t as oe}from"./chunk-6CPMXY5N-BnsD9cSz.js";import{T as le,D as ce}from"./chunk-3I6G3NRU-Yu_RzIa9.js";import{M as ue}from"./chunk-INE2QCSC-D6C4GUuG.js";import{D as de,S as fe,u as ge,a as me}from"./chunk-CM4CTG5D-ghcQfLC7.js";import{P as _e,S as he,C as ye,V as pe}from"./chunk-XLDQPLK4-BnBv0RH3.js";import{P as be}from"./chunk-IQBAUTU5-BcF73Rgu.js";import{u as G,r as p,j as u,B as X,C as Ce,bl as Se,y as ve,dJ as je,at as $,dK as xe,G as W,c5 as Ae,T as De}from"./index-S35l5lon.js";import{D as Oe}from"./chunk-ROKB75YP-BjHfL7E6.js";import{u as Ne}from"./chunk-C76H5USB-C4gmMgZH.js";import{R as Ee}from"./react-country-flag.esm-D5FaBppi.js";import{u as Re}from"./use-prompt-D56I0Z60.js";import{c as Te}from"./create-data-table-column-helper-CslhiBa7.js";import{S as we}from"./status-badge-CXGqPLdn.js";var Fe=({isDefaultView:e,currentViewId:t,currentViewName:r,onSaveAsDefault:n,onUpdateExisting:s,onSaveAsNew:i})=>{const{t:a}=G(),f=Re(),c=async()=>{await f({title:a("views.prompts.updateDefault.title"),description:a("views.prompts.updateDefault.description"),confirmText:a("views.prompts.updateDefault.confirmText"),cancelText:a("views.prompts.updateDefault.cancelText")})&&n()},C=async()=>{await f({title:a("views.prompts.updateView.title"),description:a("views.prompts.updateView.description",{name:r}),confirmText:a("views.prompts.updateView.confirmText"),cancelText:a("views.prompts.updateView.cancelText")})&&s()};return u.jsxs($,{children:[u.jsx($.Trigger,{asChild:!0,children:u.jsxs(X,{variant:"secondary",size:"small",type:"button",children:[a("views.save"),u.jsx(xe,{})]})}),u.jsx($.Content,{align:"end",children:e?u.jsxs(u.Fragment,{children:[u.jsx($.Item,{onClick:c,children:a("views.updateDefaultForEveryone")}),u.jsx($.Item,{onClick:i,children:a("views.saveAsNew")})]}):u.jsxs(u.Fragment,{children:[u.jsx($.Item,{onClick:C,children:a("views.updateViewName")}),u.jsx($.Item,{onClick:i,children:a("views.saveAsNew")})]})})]})};function $e(e,t){const[r,n]=p.useState(()=>{if(e!=null&&e.length&&(t!=null&&t.configuration)){const o={};return e.forEach(l=>{var g;o[l.field]=((g=t.configuration.visible_columns)==null?void 0:g.includes(l.field))||!1}),o}else if(e!=null&&e.length)return V(e);return{}}),[s,i]=p.useState(()=>{var o;return(o=t==null?void 0:t.configuration)!=null&&o.column_order?t.configuration.column_order:e!=null&&e.length?z(e):[]}),a=p.useMemo(()=>({visibility:r,order:s}),[r,s]),f=p.useMemo(()=>({visible:Object.entries(r).filter(([l,g])=>g).map(([l])=>l),order:s}),[r,s]),c=p.useCallback(o=>{n(o)},[]),C=p.useCallback((o,l)=>{if(o!=null&&o.configuration){const g={};l.forEach(x=>{var v;g[x.field]=((v=o.configuration.visible_columns)==null?void 0:v.includes(x.field))||!1}),n(g),i(o.configuration.column_order||[])}else n(V(l)),i(z(l))},[]),m=p.useCallback(o=>{Object.keys(r).length===0&&n(V(o)),s.length===0&&i(z(o))},[]),S=p.useRef();return p.useEffect(()=>{var o,l,g;if(e!=null&&e.length){const x=((o=S.current)==null?void 0:o.id)!==(t==null?void 0:t.id),v=t&&((l=S.current)==null?void 0:l.id)===t.id&&S.current.updated_at!==t.updated_at;if(x||v)if(t!=null&&t.configuration){const h={};e.forEach(T=>{var O,w;h[T.field]=((w=(O=t.configuration)==null?void 0:O.visible_columns)==null?void 0:w.includes(T.field))||!1}),n(h),i(((g=t.configuration)==null?void 0:g.column_order)||[])}else n(V(e)),i(z(e))}S.current=t},[t,e]),{visibleColumns:r,columnOrder:s,columnState:a,currentColumns:f,setVisibleColumns:n,setColumnOrder:i,handleColumnVisibilityChange:c,handleViewChange:C,initializeColumns:m}}var Y=500;function V(e){if(!e||e.length===0)return{};const t={};return e.forEach(r=>{t[r.field]=r.default_visible??!0}),t}function z(e){return!e||e.length===0?[]:[...e].sort((r,n)=>{const s=r.default_order??Y,i=n.default_order??Y;return s-i}).map(r=>r.field)}var Q={orders:{properties:["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],relations:["*customer","*sales_channel"]},products:{properties:["id","title","handle","status","thumbnail"],relations:["collection.title","*sales_channels","*variants"]},customers:{properties:["id","email","first_name","last_name","created_at","updated_at","has_account"],relations:["*groups"]},inventory:{properties:["id","sku","title","description","stocked_quantity","reserved_quantity","created_at","updated_at"],relations:["*location_levels"]},default:{properties:["id","created_at","updated_at"],relations:[]}};function ke(e){const t=Q[e]||Q.default;return{properties:t.properties,relations:t.relations,formatted:[...t.properties,...t.relations].join(",")}}function Ie(e,t,r){const n=ke(e),s=n.formatted;if(!(t!=null&&t.length))return s;const i=t.filter(l=>Object.keys(r).length>0?r[l.field]===!0:l.default_visible),a=new Set;i.forEach(l=>{var g,x;l.computed?((g=l.computed.required_fields)==null||g.forEach(v=>a.add(v)),(x=l.computed.optional_fields)==null||x.forEach(v=>a.add(v))):(l.field.includes("."),a.add(l.field))});const f=Array.from(a),c=f.filter(l=>l.includes(".")),C=f.filter(l=>!l.includes(".")),m=c.filter(l=>{const[g]=l.split(".");return!n.relations.some(v=>v===`*${g}`||v===g)}),S=C.filter(l=>!n.properties.includes(l)),o=[...m,...S];return o.length>0?`${s},${o.join(",")}`:s}function Je(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}function Me({entity:e,queryPrefix:t="",filters:r=[]}){const n=Se("view_configurations"),[s,i]=ve(),{activeView:a,createView:f}=ge(e),c=(a==null?void 0:a.view_configuration)||null,{updateView:C}=me(e,(c==null?void 0:c.id)||""),{columns:m,isLoading:S}=je(e,{enabled:n}),o=Ne(["q","order","offset","limit",...r.map(_=>_.id)],t),{visibleColumns:l,columnOrder:g,currentColumns:x,setColumnOrder:v,handleColumnVisibilityChange:h,handleViewChange:T}=$e(m,c);p.useEffect(()=>{m&&(T(c,m),i(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),c){const d=c.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _}))},[c,m]);const O=p.useMemo(()=>{const _={};return r.forEach(y=>{o[y.id]!==void 0&&(_[y.id]=JSON.parse(o[y.id]||""))}),{filters:_,sorting:o.order?Je(o.order):null,search:o.q||""}},[r,o]),[w,L]=p.useState(!1),J=p.useMemo(()=>{const _=O.filters,y=O.sorting,d=O.search,D=Object.entries(l).filter(([j,E])=>E).map(([j])=>j).sort();if(c){const j=c.configuration.filters||{},E=c.configuration.sorting,k=c.configuration.search||"",A=[...c.configuration.visible_columns||[]].sort(),R=c.configuration.column_order||[],q=new Set([...Object.keys(_),...Object.keys(j)]);for(const M of q)if(JSON.stringify(_[M])!==JSON.stringify(j[M]))return!0;const F=y||void 0,B=E||void 0;if(JSON.stringify(F)!==JSON.stringify(B)||d!==k||JSON.stringify(D)!==JSON.stringify(A)||JSON.stringify(g)!==JSON.stringify(R))return!0}else{if(Object.keys(_).length>0||y!==null||d!=="")return!0;if(m){const j=new Set(D),E=new Set(m.filter(A=>A.default_visible).map(A=>A.field));if(j.size!==E.size||[...j].some(A=>!E.has(A)))return!0;const k=m.sort((A,R)=>(A.default_order??500)-(R.default_order??500)).map(A=>A.field);if(JSON.stringify(g)!==JSON.stringify(k))return!0}}return!1},[c,l,g,O,m]);p.useEffect(()=>{const _=setTimeout(()=>{L(J)},50);return()=>clearTimeout(_)},[J]);const N=p.useCallback(()=>{m&&T(c,m),i(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),c!=null&&c.configuration){const d=c.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _})},[c,m,t]),U=p.useMemo(()=>Ie(e,m,l),[e,m,l]);return{activeView:c,createView:f,updateView:C,isViewConfigEnabled:n,visibleColumns:l,columnOrder:g,currentColumns:x,setColumnOrder:v,handleColumnVisibilityChange:h,currentConfiguration:O,hasConfigurationChanged:w,handleClearConfiguration:N,apiColumns:m,isLoadingColumns:S,queryParams:o,requiredFields:U}}var b=new Map,Ve=(e,t)=>t.split(".").reduce((r,n)=>r==null?void 0:r[n],e),P=(e,t,r,n)=>e==null?"-":String(e),ze=(e,t,r,n)=>{const s=e||[],i=Array.isArray(s)?s.length:0;return n("general.items",{count:i})},Z=(e,t,r,n)=>{if(!e)return"-";if(r.field==="status"&&t.status&&(t.handle||t.is_giftcard!==void 0))return u.jsx(_e,{status:t.status});const s=f=>{switch(f==null?void 0:f.toLowerCase()){case"active":case"published":case"fulfilled":case"paid":return"green";case"pending":case"proposed":case"processing":return"orange";case"draft":return"grey";case"rejected":case"failed":case"canceled":return"red";default:return"grey"}},a=((f,c)=>{if(!n)return f;const C=f.toLowerCase(),m=oe(C);switch(C){case"active":return n("general.active","Active");case"published":return n("products.productStatus.published","Published");case"draft":return n("orders.status.draft","Draft");case"pending":return n("orders.status.pending","Pending");case"canceled":return n("orders.status.canceled","Canceled");default:return c.context==="payment"?n(`orders.payment.status.${m}`,f):c.context==="fulfillment"?n(`orders.fulfillment.status.${m}`,f):n(`status.${C}`,f)}})(e,r);return u.jsx(we,{color:s(e),children:a})},ee=(e,t,r,n)=>{if(r.field==="sales_channels_display"||r.field==="sales_channels")return u.jsx(he,{salesChannels:t.sales_channels});if(!Array.isArray(e))return"-";const s=e.slice(0,2),i=e.length-2;return u.jsxs("div",{className:"flex gap-1",children:[s.map((a,f)=>u.jsx(W,{size:"xsmall",children:typeof a=="string"?a:a.name||a.title||"-"},f)),i>0&&u.jsx(W,{size:"xsmall",color:"grey",children:n?n("general.plusCountMore","+ {{count}} more",{count:i}):`+${i}`})]})},Le=(e,t,r,n)=>u.jsx(be,{product:t}),Ue=(e,t,r,n)=>u.jsx(ye,{collection:t.collection}),qe=(e,t,r,n)=>u.jsx(pe,{variants:t.variants}),Be=(e,t,r,n)=>{var s,i,a,f;if((s=t.customer)!=null&&s.first_name||(i=t.customer)!=null&&i.last_name){const c=`${t.customer.first_name||""} ${t.customer.last_name||""}`.trim();if(c)return c}return(a=t.customer)!=null&&a.email?t.customer.email:(f=t.customer)!=null&&f.phone?t.customer.phone:n?n("customers.guest","Guest"):"Guest"},He=(e,t,r,n)=>{let s=null;if(r.field==="shipping_address_display"?s=t.shipping_address:r.field==="billing_address_display"?s=t.billing_address:s=t.shipping_address||t.billing_address,!s)return"-";const i=[];s.address_1&&i.push(s.address_1);const a=[];return s.city&&a.push(s.city),s.province&&a.push(s.province),s.postal_code&&a.push(s.postal_code),a.length>0&&i.push(a.join(", ")),s.country_code&&i.push(s.country_code.toUpperCase()),i.join(" â€¢ ")||"-"},Pe=(e,t,r,n)=>{var f;const s=(f=t.shipping_address)==null?void 0:f.country_code;if(!s)return u.jsx("div",{className:"flex w-full justify-center",children:"-"});const i=Ae(s),a=(i==null?void 0:i.display_name)||s.toUpperCase();return u.jsx("div",{className:"flex w-full items-center justify-center",children:u.jsx(De,{content:a,children:u.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:u.jsx(Ee,{countryCode:s.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":a})})})})},K=(e,t,r,n)=>u.jsx(Oe,{date:e}),Ge=(e,t,r,n)=>u.jsx(ce,{displayId:e}),te=(e,t,r,n)=>{const s=t.currency_code||"USD";return u.jsx(ue,{currencyCode:s,amount:e,align:"right"})},Ke=(e,t,r,n)=>{const s=t.currency_code||"USD";return u.jsx(le,{currencyCode:s,total:e})};b.set("text",P);b.set("count",ze);b.set("status",Z);b.set("badge_list",ee);b.set("date",K);b.set("timestamp",K);b.set("currency",te);b.set("total",Ke);b.set("product_info",Le);b.set("collection",Ue);b.set("variants",qe);b.set("sales_channels_list",ee);b.set("customer_name",Be);b.set("address_summary",He);b.set("country_code",Pe);b.set("display_id",Ge);function We(e,t){if(e&&b.has(e))return b.get(e);switch(t){case"number":case"string":return P;case"date":return K;case"boolean":return(r,n,s,i)=>i?r?i("fields.yes","Yes"):i("fields.no","No"):r?"Yes":"No";case"enum":return Z;case"currency":return te;default:return P}}function Ye(e,t){return t.computed?e:Ve(e,t.field)}function Qe(e,t,r){const n=Te(),{t:s}=G();return p.useMemo(()=>t!=null&&t.length?t.map(i=>{var m;let a=(m=i.computed)==null?void 0:m.type;a||(i.semantic_type==="timestamp"?a="timestamp":i.field==="display_id"?a="display_id":i.field==="total"?a="total":i.semantic_type==="currency"&&(a="currency"));const f=We(a,i.data_type),c=r!=null&&r.getColumnAlignment?r.getColumnAlignment(i):Xe(i),C=S=>Ye(S,i);return n.accessor(C,{id:i.field,header:()=>i.name,cell:({getValue:S,row:o})=>{const l=S();if(r!=null&&r.transformCellValue){const g=r.transformCellValue(l,o.original,i);if(g!==null)return g}return f(l,o.original,i,s)},meta:{name:i.name,column:i},enableHiding:i.hideable,enableSorting:!1,headerAlign:c})}):[],[e,t,r,s])}function Xe(e){var t;return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")||e.field.includes("quantity")||e.field.includes("count")?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"||e.field==="country"||e.field.includes("country_code")?"center":"left"}var Ze={getColumnAlignment:e=>{var t;return e.semantic_type==="currency"?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"?"center":"left"}},et={getColumnAlignment:e=>{var t,r,n;return e.field==="product_display"||e.field==="collection.title"||e.field==="sales_channels_display"||e.field==="variants_count"?"left":e.field==="sku"?"center":e.field==="stock"||e.semantic_type==="currency"?"right":(e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="product_info"||((r=e.computed)==null?void 0:r.type)==="count"||((n=e.computed)==null?void 0:n.type)==="sales_channels_list","left")},transformCellValue:(e,t,r)=>{var n,s,i;if(r.field==="variants_count"||((n=r.computed)==null?void 0:n.type)==="count"){const a=Array.isArray(t.variants)?t.variants.length:0;return`${a} ${a===1?"variant":"variants"}`}return r.field==="product_display"||((s=r.computed)==null?void 0:s.type)==="product_info"||r.field==="sales_channels_display"||((i=r.computed)==null?void 0:i.type)==="sales_channels_list"||r.field==="status",null}},tt={getColumnAlignment:e=>e.field==="orders_count"||e.semantic_type==="currency"?"right":e.semantic_type==="status"?"center":"left",transformCellValue:(e,t,r)=>{if(r.field==="name"){const{first_name:n,last_name:s}=t;return n||s?`${n||""} ${s||""}`.trim():"-"}return null}},rt={getColumnAlignment:e=>e.field==="stocked_quantity"||e.field==="reserved_quantity"||e.field==="available_quantity"?"right":e.semantic_type==="status"?"center":"left"},nt={orders:Ze,products:et,customers:tt,inventory:rt};function st(e){return nt[e]}function pt({adapter:e,heading:t,subHeading:r,pageSize:n,queryPrefix:s,layout:i="fill",actions:a}){const{t:f}=G(),[c,C]=p.useState(!1),[m,S]=p.useState(null),o=e.entity,l=e.entityName,g=e.filters||[],x=n||e.pageSize||20,v=s||e.queryPrefix||"",{activeView:h,createView:T,updateView:O,isViewConfigEnabled:w,visibleColumns:L,columnOrder:J,currentColumns:N,setColumnOrder:U,handleColumnVisibilityChange:_,currentConfiguration:y,hasConfigurationChanged:d,handleClearConfiguration:D,isLoadingColumns:j,apiColumns:E,requiredFields:k,queryParams:A}=Me({entity:o,queryPrefix:v,filters:g}),R={...A};g.forEach(I=>{const H=I.id;if(R[H]!==void 0)try{R[H]=JSON.parse(R[H])}catch{}});const q={...R,fields:k,limit:x,offset:R.offset?Number(R.offset):0},F=e.useData(k,q),B=e.columnAdapter||st(o),M=Qe(o,E||[],B),re=e.getColumns&&E?e.getColumns(E):M;if(F.isError)throw F.error;const ne=async()=>{try{h!=null&&h.is_system_default?await O.mutateAsync({name:h.name||null,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}}):await T.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},se=async()=>{if(h)try{await O.mutateAsync({name:h.name,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ie=()=>{C(!0),S(null)},ae=d?u.jsxs(u.Fragment,{children:[u.jsx(X,{variant:"secondary",size:"small",type:"button",onClick:D,children:f("actions.clear")}),u.jsx(Fe,{isDefaultView:(h==null?void 0:h.is_system_default)||!h,currentViewId:h==null?void 0:h.id,currentViewName:h==null?void 0:h.name,onSaveAsDefault:ne,onUpdateExisting:se,onSaveAsNew:ie})]}):null;return u.jsxs(Ce,{className:"divide-y p-0",children:[u.jsx(de,{data:F.data||[],columns:re,filters:g,getRowId:e.getRowId||(I=>I.id),rowCount:F.count,enablePagination:!0,enableSearch:!0,pageSize:x,isLoading:F.isLoading||j,layout:i,heading:t||l||(o?f(`${o}.domain`):""),subHeading:r,enableColumnVisibility:w,initialColumnVisibility:L,onColumnVisibilityChange:_,columnOrder:J,onColumnOrderChange:U,enableViewSelector:w,entity:o,currentColumns:N,filterBarContent:ae,rowHref:e.getRowHref,emptyState:e.emptyState||{empty:{heading:f(`${o}.list.noRecordsMessage`)}},prefix:v,actions:a,enableFilterMenu:!1}),c&&u.jsx(fe,{entity:o,currentColumns:N,currentConfiguration:y,editingView:m,onClose:()=>{C(!1),S(null)},onSaved:()=>{C(!1),S(null)}})]})}function bt(e){return{getRowId:t=>t.id,pageSize:20,queryPrefix:"",...e}}export{pt as C,bt as c,Ze as o,et as p};
