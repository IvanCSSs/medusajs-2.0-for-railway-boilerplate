import{u as F,j as e,H as M,W as g,z as B,c as _,e as L,t as T,bh as V,as as O,v as y,F as b,r as z,at as x,w as H,bi as P,B as E,o as D,l as U,bj as $,bk as K,s as G}from"./index-S35l5lon.js";import{K as Y}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as d,u as J}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{E as W}from"./ellipsis-vertical-JlO7pQeh.js";import{A as q,a as Q}from"./arrow-up-mini-BZwwZ9E8.js";import{T as X}from"./trash-VeZKzNu3.js";var Z=D({key:G(),disabled:K().optional(),value:$()}),ee=D({metadata:U(Z)}),me=l=>{const{t:r}=F(),{isPending:s,...t}=l;return e.jsxs(d,{children:[e.jsxs(d.Header,{children:[e.jsx(d.Title,{asChild:!0,children:e.jsx(M,{children:r("metadata.edit.header")})}),e.jsx(d.Description,{className:"sr-only",children:r("metadata.edit.description")})]}),s?e.jsx(ae,{}):e.jsx(se,{...t})]})},k="metadata-form-key-label",A="metadata-form-value-label",se=({metadata:l,hook:r,isMutating:s})=>{const{t}=F(),{handleSuccess:c}=J(),u=B(),i=re(l),a=_({defaultValues:{metadata:te(l)},resolver:L(ee)}),f=a.handleSubmit(async o=>{const n=le(o,l);await r({metadata:n},{onSuccess:()=>{T.success(t("metadata.edit.successToast")),c()},onError:m=>{T.error(m.message)}})}),{fields:p,insert:w,remove:R}=V({control:a.control,name:"metadata"});function C(o){R(o),p.length===1&&w(0,{key:"",value:"",disabled:!1})}function N(o,n){w(o+(n==="above"?0:1),{key:"",value:"",disabled:!1})}return e.jsx(d.Form,{form:a,children:e.jsxs(Y,{onSubmit:f,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(d.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[e.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[e.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:k,children:t("metadata.edit.labels.key")})}),e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:A,children:t("metadata.edit.labels.value")})})]}),p.map((o,n)=>{const m=o.disabled||!1;let h="-";return typeof o.value=="object"&&(h="{ ... }"),Array.isArray(o.value)&&(h="[ ... ]"),e.jsx(O,{showTooltip:m,content:t("metadata.edit.complexRow.tooltip"),children:e.jsxs("div",{className:"group/table relative",children:[e.jsxs("div",{className:y("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":n===p.length-1}),children:[e.jsx(b.Field,{control:a.control,name:`metadata.${n}.key`,render:({field:j})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":k,...j,disabled:m,placeholder:"Key"})})})}),e.jsx(b.Field,{control:a.control,name:`metadata.${n}.value`,render:({field:{value:j,...S}})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":A,...S,value:m?h:j,disabled:m,placeholder:"Value"})})})})]}),e.jsxs(x,{dir:u,children:[e.jsx(x.Trigger,{className:y("invisible absolute inset-y-0 -end-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:m}),disabled:m,asChild:!0,children:e.jsx(H,{size:"2xsmall",children:e.jsx(W,{})})}),e.jsxs(x.Content,{children:[e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>N(n,"above"),children:[e.jsx(q,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowAbove")]}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>N(n,"below"),children:[e.jsx(Q,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowBelow")]}),e.jsx(x.Separator,{}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>C(n),children:[e.jsx(X,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.deleteRow")]})]})]})]})},o.id)})]}),i&&e.jsx(P,{variant:"warning",label:t("metadata.edit.complexRow.label"),children:t("metadata.edit.complexRow.description")})]}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(E,{size:"small",variant:"secondary",type:"button",disabled:s,children:t("actions.cancel")})}),e.jsx(E,{size:"small",type:"submit",isLoading:s,children:t("actions.save")})]})})]})})},v=z.forwardRef(({className:l,...r},s)=>e.jsx("input",{ref:s,...r,autoComplete:"off",className:y("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",l)}));v.displayName="MetadataForm.GridInput";var ae=()=>e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(d.Body,{children:e.jsx(g,{className:"h-[148ox] w-full rounded-lg"})}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(g,{className:"h-7 w-12 rounded-md"}),e.jsx(g,{className:"h-7 w-12 rounded-md"})]})})]}),I=["string","number","boolean"];function te(l){return!l||!Object.keys(l).length?[{key:"",value:"",disabled:!1}]:Object.entries(l).map(([r,s])=>{if(!I.includes(typeof s))return{key:r,value:s,disabled:!0};let t=s;return typeof s!="string"&&(t=JSON.stringify(s)),{key:r,value:t,original_key:r}})}function le(l,r){const s=l.metadata;if(!s.length||s.length===1&&!s[0].key&&!s[0].value)return null;const c={};return r&&Object.keys(r).forEach(u=>{s.some(a=>a.key===u)||(c[u]="")}),s.forEach(u=>{let i=u.key,a=u.value;const f=u.disabled;if(i){if(f){c[i]=a;return}i=i.trim(),a=(a==null?void 0:a.trim())??"",a==="true"?c[i]=!0:a==="false"?c[i]=!1:/^-?\d*\.?\d+$/.test(a)?c[i]=parseFloat(a):c[i]=a}}),c}function re(l){return l?Object.values(l).some(r=>!I.includes(typeof r)):!1}export{me as M};
