import{u as $,a as H}from"./chunk-IJRZ53H3-ZsR9LBlK.js";import{u as g,cp as Y,bY as K,a as U,P as X,dp as z,m as J,j as s,a1 as Z,O as W,ab as V,M as ee,X as O,eQ as se,C as v,H as y,A as b,q as u,dI as te,r as N,a7 as ae,ds as re,eR as c,L as F,B as ie,eS as le,v as oe,t as f,k as G,ae as ne}from"./index-S35l5lon.js";import{u as ce,a as de,b as ue}from"./chunk-ZJRFL6ZN-Db9QnF_p.js";import{T as _}from"./chunk-GIZFNLKK-DRFYVOmD.js";import{u as I,_ as L}from"./chunk-ULVVVKLF-DQ5i1kAh.js";import"./chunk-GU5PJRPM-CRBxyP7n.js";import{N as me}from"./chunk-EMIHDNB7-1UnYIHIF.js";import{u as j}from"./use-prompt-D56I0Z60.js";import{P as q}from"./pencil-square-Y_YO1xMN.js";import{T as R}from"./trash-VeZKzNu3.js";import{A as pe}from"./arrow-path-BQjzsCv0.js";import{S as fe}from"./status-badge-CXGqPLdn.js";import{c as B}from"./index-D8hIMFbh.js";import{C as D}from"./checkbox-Bm9_gGRM.js";import"./chunk-C76H5USB-C4gmMgZH.js";import"./chunk-3I6G3NRU-Yu_RzIa9.js";import"./chunk-INE2QCSC-D6C4GUuG.js";import"./chunk-X6BAAGCL-D2m0rpEk.js";import"./chunk-DK4WIVY6-CYCbBMOO.js";import"./chunk-P3UUX2T6-CDvcsuG9.js";import"./chunk-7DXVXBSA-CQVKcaLu.js";import"./chunk-ROKB75YP-BjHfL7E6.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./chunk-ADOCJB6L-3RvuFqSE.js";import"./react-country-flag.esm-D5FaBppi.js";import"./chunk-MSDRGCRR-CygM1UmD.js";import"./index-DRUHz9yq.js";import"./check-B9bFzKnZ.js";import"./chunk-HQKGZADC-CFjwmGLF.js";import"./table-u7knMi01.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./index-haGLTuDn.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./plus-mini-B5zW_eay.js";import"./prompt-YaiseBxh.js";var xe=()=>{const{t:e}=g(),{regions:t}=Y({limit:1e3,fields:"id,name"}),{sales_channels:a}=K({limit:1e3,fields:"id,name"});let r=[];if(t){const l={key:"region_id",label:e("fields.region"),type:"select",options:t.map(i=>({label:i.name,value:i.id})),multiple:!0,searchable:!0};r=[...r,l]}if(a){const l={key:"sales_channel_id",label:e("fields.salesChannel"),type:"select",multiple:!0,searchable:!0,options:a.map(i=>({label:i.name,value:i.id}))};r=[...r,l]}e("orders.payment.statusLabel"),e("orders.payment.status.notPaid"),e("orders.payment.status.awaiting"),e("orders.payment.status.captured"),e("orders.payment.status.refunded"),e("orders.payment.status.partiallyRefunded"),e("orders.payment.status.canceled"),e("orders.payment.status.requiresAction"),e("orders.fulfillment.statusLabel"),e("orders.fulfillment.status.notFulfilled"),e("orders.fulfillment.status.fulfilled"),e("orders.fulfillment.status.partiallyFulfilled"),e("orders.fulfillment.status.returned"),e("orders.fulfillment.status.partiallyReturned"),e("orders.fulfillment.status.shipped"),e("orders.fulfillment.status.partiallyShipped"),e("orders.fulfillment.status.canceled"),e("orders.fulfillment.status.requiresAction");const n=[{label:"Created At",key:"created_at"},{label:"Updated At",key:"updated_at"}].map(l=>({key:l.key,label:l.label,type:"date"}));return r=[...r,...n],r},gs=e=>{const{id:t}=e.params||{},{customer:a}=z(t,void 0,{initialData:e.data,enabled:!!t});if(!a)return null;const n=[a.first_name,a.last_name].filter(Boolean).join(" ")||a.email;return s.jsx("span",{children:n})},ge=({labelKey:e,descriptionKey:t,children:a})=>s.jsx("div",{className:"flex flex-col gap-2 px-2 pb-2",children:s.jsx("div",{className:"shadow-elevation-card-rest bg-ui-bg-component transition-fg hover:bg-ui-bg-component-hover active:bg-ui-bg-component-pressed group-focus-visible:shadow-borders-interactive-with-active rounded-md px-4 py-2",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex flex-1 flex-col",children:[s.jsx(u,{size:"small",leading:"compact",weight:"plus",children:e}),s.jsx(u,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:t})]}),s.jsx("div",{className:"flex size-7 items-center justify-center",children:a})]})})}),he=({customer:e})=>{const{t}=g(),a=j(),r=O(),{mutateAsync:n}=le(e.id),l=e.addresses??[],i=async o=>{await a({title:t("general.areYouSure"),description:t("general.areYouSureDescription",{entity:t("fields.address"),title:o.address_name??"n/a"}),verificationInstruction:t("general.typeToConfirm"),verificationText:o.address_name??"address",confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n(o.id,{onSuccess:()=>{f.success(t("general.success",{name:o.address_name??"address"})),r(`/customers/${e.id}`,{replace:!0})},onError:m=>{f.error(m.message)}})};return s.jsxs(v,{className:"p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(y,{level:"h2",children:t("addresses.title")}),s.jsx(F,{to:"create-address",className:"text-ui-fg-muted text-xs",children:"Add"})]}),l.length===0&&s.jsx(me,{className:oe({"flex h-full flex-col overflow-hidden border-t p-6":!0}),icon:null,title:t("general.noRecordsTitle"),message:t("general.noRecordsMessage")}),l.map(o=>s.jsx(ge,{labelKey:o.address_name??"n/a",descriptionKey:[o.address_1,o.address_2].join(" "),children:s.jsx(b,{groups:[{actions:[{icon:s.jsx(R,{}),label:t("actions.delete"),onClick:async()=>{await i(o)}}]}]})},o.id))]})},ve=({customer:e})=>{const{t}=g(),a=j(),r=O(),{mutateAsync:n}=se(e.id),l=[e.first_name,e.last_name].filter(Boolean).join(" "),i=e.has_account?"green":"orange",o=e.has_account?t("customers.fields.registered"):t("customers.fields.guest"),x=async()=>{await a({title:t("customers.delete.title"),description:t("customers.delete.description",{email:e.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:e.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n(void 0,{onSuccess:()=>{f.success(t("customers.delete.successToast",{email:e.email})),r("/customers",{replace:!0})},onError:h=>{f.error(h.message)}})};return s.jsxs(v,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(y,{children:e.email}),s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(fe,{color:i,children:o}),s.jsx(b,{groups:[{actions:[{label:t("actions.edit"),icon:s.jsx(q,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:s.jsx(R,{}),onClick:x}]}]})]})]}),s.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[s.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),s.jsx(u,{size:"small",leading:"compact",children:l||"-"})]}),s.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[s.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),s.jsx(u,{size:"small",leading:"compact",children:e.company_name||"-"})]}),s.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[s.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),s.jsx(u,{size:"small",leading:"compact",children:e.phone||"-"})]})]})},S=10,T="cusgr",ye=({customer:e})=>{const t=j(),[a,r]=N.useState({}),{raw:n,searchParams:l}=ce({pageSize:S,prefix:T}),{customer_groups:i,count:o,isLoading:x,isError:m,error:h}=ae({...l,fields:"+customers.id",customers:{id:e.id}},{placeholderData:G}),{mutateAsync:C}=re(e.id),w=de(),P=je(e.id),{table:M}=I({data:i??[],columns:P,count:o,getRowId:p=>p.id,enablePagination:!0,enableRowSelection:!0,pageSize:S,prefix:T,rowSelection:{state:a,updater:r}}),Q=async()=>{const p=Object.keys(a);await t({title:c("general.areYouSure"),description:c("customers.groups.removeMany",{groups:i==null?void 0:i.filter(d=>p.includes(d.id)).map(d=>d.name).join(",")}),confirmText:c("actions.remove"),cancelText:c("actions.cancel")})&&await C({remove:p},{onSuccess:()=>{f.success(c("customers.groups.removed.success",{groups:i.filter(d=>p.includes(d.id)).map(d=>d==null?void 0:d.name)}))},onError:d=>{f.error(d.message)}})};if(m)throw h;return s.jsxs(v,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(y,{level:"h2",children:c("customerGroups.domain")}),s.jsx(F,{to:`/customers/${e.id}/add-customer-groups`,children:s.jsx(ie,{variant:"secondary",size:"small",children:c("general.add")})})]}),s.jsx(L,{table:M,columns:P,pageSize:S,isLoading:x,count:o,prefix:T,navigateTo:p=>`/customer-groups/${p.id}`,filters:w,search:!0,pagination:!0,orderBy:[{key:"name",label:c("fields.name")},{key:"created_at",label:c("fields.createdAt")},{key:"updated_at",label:c("fields.updatedAt")}],commands:[{action:Q,label:c("actions.remove"),shortcut:"r"}],queryObject:n,noRecords:{message:c("customers.groups.list.noRecordsMessage")}})]})},be=({group:e,customerId:t})=>{const a=j(),{t:r}=g(),{mutateAsync:n}=ne(e.id),l=async()=>{await a({title:r("general.areYouSure"),description:r("customers.groups.remove",{name:e.name}),confirmText:r("actions.remove"),cancelText:r("actions.cancel")})&&await n([t],{onError:o=>{f.error(o.message)}})};return s.jsx(b,{groups:[{actions:[{label:r("actions.edit"),icon:s.jsx(q,{}),to:`/customer-groups/${e.id}/edit`},{label:r("actions.remove"),onClick:l,icon:s.jsx(R,{})}]}]})},E=B(),je=e=>{const t=ue();return N.useMemo(()=>[E.display({id:"select",header:({table:a})=>s.jsx(D,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:r=>a.toggleAllPageRowsSelected(!!r)}),cell:({row:a})=>s.jsx(D,{checked:a.getIsSelected(),onCheckedChange:r=>a.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...t,E.display({id:"actions",cell:({row:a})=>s.jsx(be,{group:a.original,customerId:e})})],[t,e])},A="cusord",k=10,Ce="*customer,*items,*sales_channel",we="id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code",_e=({customer:e})=>{const{t}=g(),{searchParams:a,raw:r}=$({pageSize:k,prefix:A}),{orders:n,count:l,isLoading:i,isError:o,error:x}=te({customer_id:e.id,fields:we+","+Ce,...a},{placeholderData:G}),m=Ae(),h=xe(),{table:C}=I({data:n??[],columns:m,enablePagination:!0,count:l,pageSize:k,prefix:A});if(o)throw x;return s.jsxs(v,{className:"divide-y p-0",children:[s.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:s.jsx(y,{level:"h2",children:t("orders.domain")})}),s.jsx(L,{columns:m,table:C,pagination:!0,navigateTo:w=>`/orders/${w.original.id}`,filters:h,count:l,isLoading:i,pageSize:k,orderBy:[{key:"display_id",label:t("orders.fields.displayId")},{key:"created_at",label:t("fields.createdAt")},{key:"updated_at",label:t("fields.updatedAt")}],search:!0,queryObject:r,prefix:A})]})},Se=({order:e})=>{const{t}=g();return s.jsx(b,{groups:[{actions:[{label:t("transferOwnership.label"),to:`${e.id}/transfer`,icon:s.jsx(pe,{})}]}]})},Te=B(),Ae=()=>{const e=H({exclude:["customer"]});return N.useMemo(()=>[...e,Te.display({id:"actions",cell:({row:t})=>s.jsx(Se,{order:t.original})})],[e])},hs=()=>{const{id:e}=U(),t=X(),{customer:a,isLoading:r,isError:n,error:l}=z(e,{fields:"+*addresses"},{initialData:t}),{getWidgets:i}=J();if(r||!a)return s.jsx(Z,{sections:2,showJSON:!0,showMetadata:!0});if(n)throw l;return s.jsxs(_,{widgets:{before:i("customer.details.before"),after:i("customer.details.after"),sideAfter:i("customer.details.side.after"),sideBefore:i("customer.details.side.before")},data:a,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[s.jsxs(_.Main,{children:[s.jsx(ve,{customer:a}),s.jsx(_e,{customer:a}),s.jsx(ye,{customer:a})]}),s.jsx(_.Sidebar,{children:s.jsx(he,{customer:a})})]})},ke=e=>({queryKey:V.detail(e),queryFn:async()=>W.admin.customer.retrieve(e,{fields:"+*addresses"})}),vs=async({params:e})=>{const t=e.id,a=ke(t);return ee.ensureQueryData(a)};export{gs as Breadcrumb,hs as Component,vs as loader};
