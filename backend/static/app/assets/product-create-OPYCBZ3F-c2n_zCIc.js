import{C as Be}from"./chunk-QPZ77XCH-DmoxMpwC.js";import{n as qe,P as He,a as Ke,U as Le,d as ce}from"./chunk-GZBMKPBD-BhLlZYJw.js";import{C as Ge}from"./chunk-XDJ7OMBR-Doqxp-wX.js";import{r as C,u as D,b2 as Ue,b$ as We,cp as Ze,bN as Xe,j as e,m as ie,z as Ye,eg as Qe,f0 as Je,E as A,O as q,t as se,B as M,eh as ge,co as et,H as ee,F as o,I as Y,bh as L,c_ as re,v as ne,bd as X,dB as tt,w as H,am as ve,i as st,q as G,bi as rt,ak as de,bY as at,k as nt,A as je,b6 as be}from"./index-S35l5lon.js";import"./chunk-ZQRKUG6J-TyK87Nny.js";import{C as ue}from"./chunk-X5VECN6S-C49qKVnn.js";import{S as ye}from"./chunk-PRLQLEEQ-CKYDE1LK.js";import{D as R,c as lt,f as it}from"./chunk-C3TFORYK-CR60shj4.js";import{u as ot,a as ct,b as dt,c as ut}from"./chunk-5IFK2ZTA-CYHgI7Da.js";import{u as U}from"./chunk-3TZOFKX2-M15LmCS4.js";import{D as mt}from"./chunk-CM4CTG5D-ghcQfLC7.js";import{H as pt}from"./chunk-7OYLCEKK-B-sdtvWw.js";import{C as W}from"./chunk-OFN7DIZA-C5u54b_Q.js";import{K as ht}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as $,u as Ce,S as B,b as xt}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{u as Ne,a as Q,D as we,b as _e,d as Se,S as Pe,c as Ve,s as ke,K as De,P as Ie,e as Ee,C as Te}from"./sortable.esm-G2J7QBKc.js";import{D as oe}from"./dots-six-DvRLB6s4.js";import{T as ze}from"./thumbnail-badge-Z1PKPc-j.js";import{T as ft}from"./trash-VeZKzNu3.js";import{P as T}from"./progress-tabs-DyqPaYnl.js";import{T as gt}from"./textarea-FJbwiCAd.js";import{C as me}from"./checkbox-Bm9_gGRM.js";import{c as vt}from"./create-data-table-column-helper-CslhiBa7.js";import"./triangles-mini-CX2619vl.js";import"./index-BqPH3RWs.js";import"./chunk-BYOPZAGX-HdrH_Sf4.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-DK4WIVY6-CYCbBMOO.js";import"./index.esm-BQ-YgayW.js";import"./index-D8hIMFbh.js";import"./adjustments-D-7QP2vC.js";import"./chunk-2X25XWOW-BV1GECY4.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./chunk-2GWGNMAA-CfkRT-MD.js";import"./create-data-table-filter-helper-BDq3TjGS.js";import"./chunk-C76H5USB-C4gmMgZH.js";import"./use-data-table-C4h0AgWj.js";import"./command-bar-D5PjKtE8.js";import"./select-CmrtK7XQ.js";import"./check-B9bFzKnZ.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./table-u7knMi01.js";import"./arrow-up-mini-BZwwZ9E8.js";import"./use-prompt-D56I0Z60.js";import"./prompt-YaiseBxh.js";import"./pencil-square-Y_YO1xMN.js";import"./combobox-provider-CcO6EPfN.js";import"./plus-mini-B5zW_eay.js";import"./focus-modal-B7NOABos.js";var jt=Object.defineProperty,J=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,pe=(t,s,r)=>s in t?jt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,bt=(t,s)=>{for(var r in s||(s={}))Fe.call(s,r)&&pe(t,r,s[r]);if(J)for(var r of J(s))Me.call(s,r)&&pe(t,r,s[r]);return t},yt=(t,s)=>{var r={};for(var l in t)Fe.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&J)for(var l of J(t))s.indexOf(l)<0&&Me.call(t,l)&&(r[l]=t[l]);return r};const Oe=C.forwardRef((t,s)=>{var r=t,{color:l="currentColor"}=r,n=yt(r,["color"]);return C.createElement("svg",bt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},n),C.createElement("path",{stroke:l,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});Oe.displayName="StackPerspective";var Ct=({form:t})=>{const{t:s}=D();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(o.Field,{control:t.control,name:"title",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("products.fields.title.label")}),e.jsx(o.Control,{children:e.jsx(Y,{...r,placeholder:s("products.fields.title.placeholder")})})]})}),e.jsx(o.Field,{control:t.control,name:"subtitle",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.subtitle.label")}),e.jsx(o.Control,{children:e.jsx(Y,{...r,placeholder:s("products.fields.subtitle.placeholder")})})]})}),e.jsx(o.Field,{control:t.control,name:"handle",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{tooltip:s("products.fields.handle.tooltip"),optional:!0,children:s("fields.handle")}),e.jsx(o.Control,{children:e.jsx(pt,{...r,placeholder:s("products.fields.handle.placeholder")})})]})})]})}),e.jsx(o.Field,{control:t.control,name:"description",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(o.Control,{children:e.jsx(gt,{...r,placeholder:s("products.fields.description.placeholder")})})]})})]})},Nt={sideEffects:Se({styles:{active:{opacity:"0.4"}}})},wt=({form:t})=>{const{fields:s,append:r,remove:l}=L({name:"media",control:t.control,keyName:"field_id"}),[n,a]=C.useState(null),u=Ne(Q(Ie),Q(De,{coordinateGetter:ke})),g=m=>{a(m.active.id)},p=m=>{a(null);const{active:S,over:b}=m;if(S.id!==(b==null?void 0:b.id)){const P=s.findIndex(j=>j.field_id===S.id),I=s.findIndex(j=>j.field_id===(b==null?void 0:b.id));t.setValue("media",Ve(s,P,I),{shouldDirty:!0,shouldTouch:!0})}},v=()=>{a(null)},i=m=>()=>{l(m)},d=m=>()=>{const S=s.map((b,P)=>({...b,isThumbnail:P===m}));t.setValue("media",S,{shouldDirty:!0,shouldTouch:!0})},N=m=>({onDelete:i(m),onMakeThumbnail:d(m)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(Le,{form:t,append:r,showHint:!1}),e.jsxs(we,{sensors:u,onDragEnd:p,onDragStart:g,onDragCancel:v,children:[e.jsx(_e,{dropAnimation:Nt,children:n?e.jsx(St,{field:s.find(m=>m.field_id===n)}):null}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:e.jsx(Pe,{items:s.map(m=>m.field_id),children:s.map((m,S)=>{const{onDelete:b,onMakeThumbnail:P}=N(S);return e.jsx(_t,{field:m,onDelete:b,onMakeThumbnail:P},m.field_id)})})})]})]})},_t=({field:t,onDelete:s,onMakeThumbnail:r})=>{const{t:l}=D(),{attributes:n,listeners:a,setNodeRef:u,setActivatorNodeRef:g,transform:p,transition:v,isDragging:i}=Ee({id:t.field_id}),d={opacity:i?.4:void 0,transform:Te.Translate.toString(p),transition:v};return t.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",ref:u,style:d,children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",type:"button",size:"small",...n,...a,ref:g,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(oe,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx($e,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(G,{size:"small",leading:"compact",children:t.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(G,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Ae(t.file.size)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(je,{groups:[{actions:[{label:l("products.media.makeThumbnail"),icon:e.jsx(Oe,{}),onClick:r}]},{actions:[{icon:e.jsx(ft,{}),label:l("actions.delete"),onClick:s}]}]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:s,children:e.jsx(be,{})})]})]}):null},St=({field:t})=>{var s,r;return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",size:"small",className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(oe,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx($e,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(G,{size:"small",leading:"compact",children:(s=t.file)==null?void 0:s.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(G,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Ae(((r=t.file)==null?void 0:r.size)??0)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(je,{groups:[]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:()=>{},children:e.jsx(be,{})})]})]})},$e=({url:t})=>t?e.jsx("img",{src:t,alt:"",className:"size-full object-cover object-center"}):null;function Ae(t,s=2){if(t===0)return"0 Bytes";const r=1024,l=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(s))+" "+l[n]}var Pt=({items:t,onChange:s,renderItem:r})=>{const[l,n]=C.useState(null),[a,u]=C.useMemo(()=>{if(l===null)return[null,null];const d=t.findIndex(({id:N})=>N===l.id);return[t[d],d]},[l,t]),g=Ne(Q(Ie),Q(De,{coordinateGetter:ke})),p=({active:d})=>{n(d)},v=({active:d,over:N})=>{if(N&&d.id!==N.id){const m=t.findIndex(({id:b})=>b===d.id),S=t.findIndex(({id:b})=>b===N.id);s(Ve(t,m,S))}n(null)},i=()=>{n(null)};return e.jsxs(we,{sensors:g,onDragStart:p,onDragEnd:v,onDragCancel:i,children:[e.jsx(kt,{children:a&&u!==null?r(a,u):null}),e.jsx(Pe,{items:t,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:t.map((d,N)=>e.jsx(C.Fragment,{children:r(d,N)},d.id))})})]})},Vt={sideEffects:Se({styles:{active:{opacity:"0.4"}}})},kt=({children:t})=>e.jsx(_e,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:Vt,children:t}),Re=C.createContext(null),Dt=()=>{const t=C.useContext(Re);if(!t)throw new Error("useSortableItemContext must be used within a SortableItemContext");return t},It=({id:t,className:s,children:r})=>{const{attributes:l,isDragging:n,listeners:a,setNodeRef:u,setActivatorNodeRef:g,transform:p,transition:v}=Ee({id:t}),i=C.useMemo(()=>({attributes:l,listeners:a,ref:g,isDragging:n}),[l,a,g,n]),d={opacity:n?.4:void 0,transform:Te.Translate.toString(p),transition:v};return e.jsx(Re.Provider,{value:i,children:e.jsx("li",{className:ne("transition-fg flex flex-1 list-none",s),ref:u,style:d,children:r})})},Et=()=>{const{attributes:t,listeners:s,ref:r}=Dt();return e.jsx(H,{variant:"transparent",size:"small",...t,...s,ref:r,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(oe,{className:"text-ui-fg-muted"})})},ae=Object.assign(Pt,{Item:It,DragHandle:Et}),le=t=>{if(t.length===0)return[];if(t.length===1)return t[0].values.map(l=>({[t[0].title]:l}));const s=t[0],r=t.slice(1);return s.values.flatMap(l=>le(r).map(n=>({[s.title]:l,...n})))},he=t=>Object.values(t).join(" / "),Tt=({form:t})=>{var b,P,I;const{t:s}=D(),r=L({control:t.control,name:"options"}),l=L({control:t.control,name:"variants"}),n=A({control:t.control,name:"enable_variants",defaultValue:!1}),a=A({control:t.control,name:"options",defaultValue:[]}),u=A({control:t.control,name:"variants",defaultValue:[]}),g=!!((b=t.formState.errors.options)!=null&&b.length),p=((I=(P=t.formState.errors.variants)==null?void 0:P.root)==null?void 0:I.message)==="invalid_length",v=(j,h)=>{const{isTouched:y}=t.getFieldState("variants"),c=[...a];c[j].values=h;const x=le(c.filter(({values:f})=>f.length)),w=[...u],_=f=>x.find(z=>Object.keys(f).every(E=>f[E]===z[E])),V=w.reduce((f,z)=>{const E=_(z.options);return E&&f.push({...z,title:he(E),options:E}),f},[]),k=new Set(V.map(f=>f.options));x.filter(f=>!k.has(f)).forEach(f=>{V.push({title:he(f),options:f,should_create:!y,variant_rank:V.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),t.setValue("variants",V)},i=j=>{if(j===0)return;r.remove(j);const h=[...a];h.splice(j,1);const y=new Set(h.map(_=>_.title)),c=le(h),x=[...u],w=c.reduce((_,V)=>{const k=x.find(({options:O})=>Object.keys(O).filter(f=>y.has(f)).every(f=>O[f]===V[f]));return k&&_.push({...k,title:k.title,options:V}),_},[]);t.setValue("variants",w)},d=j=>{const h=j.map((y,c)=>{const x=u.find(w=>w.title===y.title);return{id:y.id,...x||y,variant_rank:c}});l.replace(h)},N=j=>j.every(h=>h.should_create)?!0:j.some(h=>h.should_create)?"indeterminate":!1,m=j=>{switch(j){case!0:{const h=u.map(y=>({...y,should_create:!0}));t.setValue("variants",h);break}case!1:{const h=u.map(y=>({...y,should_create:!1}));t.setValue("variants",ce(h));break}}},S=()=>{t.setValue("options",[{title:"Default option",values:["Default option value"]}]),t.setValue("variants",ce([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(ee,{level:"h2",children:s("products.create.variants.header")}),e.jsx(ye,{control:t.control,name:"enable_variants",label:s("products.create.variants.subHeadingTitle"),description:s("products.create.variants.subHeadingDescription"),onCheckedChange:j=>{j?(t.setValue("options",[{title:"",values:[]}]),t.setValue("variants",[])):S()}})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(o.Field,{control:t.control,name:"options",render:()=>e.jsx(o.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:s("products.create.variants.productOptions.label")}),e.jsx(o.Hint,{children:s("products.create.variants.productOptions.hint")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{r.append({title:"",values:[]})},children:s("actions.add")})]}),g&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:r.fields.map((j,h)=>{var c;const y=!!((c=t.formState.errors.options)!=null&&c[h]);return e.jsxs("li",{className:ne("bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",{"border-ui-border-error shadow-borders-error":y}),children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.title`,children:s("fields.title")})}),e.jsx(Y,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...t.register(`options.${h}.title`),placeholder:s("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.values`,children:s("fields.values")})}),e.jsx(tt,{control:t.control,name:`options.${h}.values`,render:({field:{onChange:x,...w}})=>{const _=V=>{v(h,V),x(V)};return e.jsx(Ge,{...w,variant:"contrast",onChange:_,placeholder:s("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:h===0,onClick:()=>i(h),children:e.jsx(ve,{})})]},j.id)})})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(X,{weight:"plus",children:s("products.create.variants.productVariants.label")}),e.jsx(st,{children:s("products.create.variants.productVariants.hint")})]}),!g&&p&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.variants")}),l.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${a.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(me,{className:"relative",checked:N(u),onCheckedChange:m})}),e.jsx("div",{}),a.map((j,h)=>e.jsx("div",{children:e.jsx(G,{size:"small",leading:"compact",weight:"plus",children:j.title})},h))]}),e.jsx(ae,{items:l.fields,onChange:d,renderItem:(j,h)=>e.jsx(ae.Item,{id:j.id,className:ne("bg-ui-bg-base border-b",{"border-b-0":h===l.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${a.length}, 1fr)`},children:[e.jsx(o.Field,{control:t.control,name:`variants.${h}.should_create`,render:({field:{value:y,onChange:c,...x}})=>e.jsx(o.Item,{children:e.jsx(o.Control,{children:e.jsx(me,{className:"relative",...x,checked:y,onCheckedChange:c})})})}),e.jsx(ae.DragHandle,{}),Object.values(j.options).map((y,c)=>e.jsx(G,{size:"small",leading:"compact",children:y},c))]})})})]}):e.jsx(re,{children:s("products.create.variants.productVariants.alert")}),l.fields.length>0&&e.jsx(rt,{label:s("general.tip"),children:s("products.create.variants.productVariants.tip")})]})})]})]})},zt=({form:t})=>{const{getFormFields:s}=ie(),r=s("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Ft,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(Ct,{form:t}),e.jsx(ge,{fields:r,form:t}),e.jsx(wt,{form:t})]}),e.jsx(et,{}),e.jsx(Tt,{form:t})]})})},Ft=()=>{const{t}=D();return e.jsx("div",{className:"flex flex-col",children:e.jsx(ee,{children:t("products.create.header")})})};function Mt({form:t,variantIndex:s,inventoryIndex:r,inventoryItem:l,isItemOptionDisabled:n,onRemove:a}){const{t:u}=D(),g=A({control:t.control,name:`variants.${s}.inventory.${r}.inventory_item_id`}),p=U({queryKey:["inventory_items"],defaultValueKey:"id",selectedValue:g,queryFn:v=>q.admin.inventoryItem.list(v),getOptions:v=>v.inventory_items.map(i=>({label:`${i.title} ${i.sku?`(${i.sku})`:""}`,value:i.id}))});return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${s}.inventory.${r}.inventory_item_id`,children:u("fields.item")})}),e.jsx(o.Field,{control:t.control,name:`variants.${s}.inventory.${r}.inventory_item_id`,render:({field:v})=>e.jsx(o.Item,{children:e.jsx(o.Control,{children:e.jsx(W,{...v,options:p.options.map(i=>({...i,disabled:n(i,r)})),searchValue:p.searchValue,onBlur:()=>p.onSearchValueChange(""),onSearchValueChange:p.onSearchValueChange,fetchNextPage:p.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:u("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${s}.inventory.${r}.required_quantity`,children:u("fields.quantity")})}),e.jsx(o.Field,{control:t.control,name:`variants.${s}.inventory.${r}.required_quantity`,render:({field:{onChange:v,value:i,...d}})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(Y,{type:"number",className:"bg-ui-bg-field-component",min:0,value:i,onChange:N=>{const m=N.target.value;v(m===""?null:Number(m))},...d,placeholder:u("products.create.inventory.quantityPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:a,children:e.jsx(ve,{})})]},l.id)}function Ot({form:t,variant:s,index:r}){const{t:l}=D(),n=L({control:t.control,name:`variants.${r}.inventory`}),a=A({control:t.control,name:`variants.${r}.inventory`}),u=(g,p)=>!!(a!=null&&a.some((v,i)=>i!=p&&v.inventory_item_id===g.value));return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:s.title}),e.jsx(o.Hint,{children:l("products.create.inventory.label")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{n.append({inventory_item_id:"",required_quantity:""})},children:l("actions.add")})]}),n.fields.map((g,p)=>e.jsx(Mt,{form:t,variantIndex:r,inventoryIndex:p,inventoryItem:g,isItemOptionDisabled:u,onRemove:()=>n.remove(p)},g.id))]})}var $t=({form:t})=>{const{t:s}=D(),r=L({control:t.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:s("products.create.inventory.heading")}),r.fields.filter(l=>l.inventory_kit).map((l,n)=>e.jsx(Ot,{form:t,variant:l,index:n},l.id))]})},At=({form:t})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx($t,{form:t})})}),Rt=({form:t})=>{const{t:s}=D(),r=U({queryKey:["product_collections"],queryFn:i=>q.admin.productCollection.list(i),getOptions:i=>i.collections.map(d=>({label:d.title,value:d.id}))}),l=U({queryKey:["product_types"],queryFn:i=>q.admin.productType.list(i),getOptions:i=>i.product_types.map(d=>({label:d.value,value:d.id}))}),n=U({queryKey:["product_tags"],queryFn:i=>q.admin.productTag.list(i),getOptions:i=>i.product_tags.map(d=>({label:d.value,value:d.id}))}),a=U({queryKey:["shipping_profiles"],queryFn:i=>q.admin.shippingProfile.list(i),getOptions:i=>i.shipping_profiles.map(d=>({label:d.name,value:d.id}))}),{fields:u,remove:g,replace:p}=L({control:t.control,name:"sales_channels",keyName:"key"}),v=()=>{p([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:s("products.organization.header")}),e.jsx(ye,{control:t.control,name:"discountable",label:s("products.fields.discountable.label"),description:s("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(o.Field,{control:t.control,name:"type_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.type.label")}),e.jsx(o.Control,{children:e.jsx(W,{...i,options:l.options,searchValue:l.searchValue,onSearchValueChange:l.onSearchValueChange,fetchNextPage:l.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"collection_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.collection.label")}),e.jsx(o.Control,{children:e.jsx(W,{...i,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(o.Field,{control:t.control,name:"categories",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.categories.label")}),e.jsx(o.Control,{children:e.jsx(Be,{...i})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"tags",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.tags.label")}),e.jsx(o.Control,{children:e.jsx(W,{...i,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,fetchNextPage:n.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.shipping_profile.label")}),e.jsx(o.Hint,{children:e.jsx(de,{i18nKey:"products.fields.shipping_profile.hint"})})]}),e.jsx(o.Field,{control:t.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(W,{...i,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(o.Field,{control:t.control,name:"sales_channels",render:()=>e.jsxs(o.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.sales_channels.label")}),e.jsx(o.Hint,{children:e.jsx(de,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx(B.Trigger,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.add")})})]}),e.jsx(o.Control,{className:"mt-0",children:u.length>0&&e.jsx(ue,{onClearAll:v,onRemove:g,className:"py-4",children:u.map((i,d)=>e.jsx(ue.Chip,{index:d,children:i.name},i.key))})})]})})})]})},Z="sc",xe=20,Bt=({form:t})=>{const{t:s}=D(),{getValues:r,setValue:l}=t,{setIsOpen:n,getIsOpen:a}=xt(),[u,g]=C.useState({}),[p,v]=C.useState([]),i=ot({pageSize:xe,prefix:Z}),{sales_channels:d,count:N,isLoading:m,isError:S,error:b}=at(i,{placeholderData:nt}),P=a(Z);C.useEffect(()=>{if(!P)return;const x=r("sales_channels");x&&(v(x.map(w=>({id:w.id,name:w.name}))),g(x.reduce((w,_)=>({...w,[_.id]:!0}),{})))},[P,r]);const I=x=>{const w=Object.keys(x),_=new Set(w.filter(k=>x[k]&&!u[k]));let V=[];_.size>0&&(V=(d==null?void 0:d.filter(k=>_.has(k.id)))??[]),v(k=>{const O=k.filter(f=>x[f.id]);return Array.from(new Set([...O,...V]))}),g(x)},j=()=>{l("sales_channels",p,{shouldDirty:!0,shouldTouch:!0}),n(Z,!1)},h=ct(),y=Ht(),c=dt();if(S)throw b;return e.jsxs(B.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx(B.Header,{}),e.jsx(B.Body,{className:"flex-1 overflow-hidden",children:e.jsx(mt,{data:d,columns:y,filters:h,emptyState:c,rowCount:N,pageSize:xe,getRowId:x=>x.id,rowSelection:{state:u,onRowSelectionChange:I},isLoading:m,layout:"fill",prefix:Z})}),e.jsx(B.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(B.Close,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.cancel")})}),e.jsx(M,{size:"small",onClick:j,type:"button",children:s("actions.save")})]})})]})},qt=vt(),Ht=()=>{const t=ut();return C.useMemo(()=>[qt.select(),...t],[t])},Kt=({form:t})=>{const{getFormFields:s}=ie(),r=s("product","create","organize");return e.jsxs(B,{id:Z,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Rt,{form:t}),e.jsx(ge,{fields:r,form:t})]})}),e.jsx(Bt,{form:t})]})},Lt=({form:t,regions:s,store:r,pricePreferences:l})=>{const{setCloseOnEscape:n}=Ce(),a=C.useMemo(()=>{var i;return((i=r==null?void 0:r.supported_currencies)==null?void 0:i.map(d=>d.currency_code))||[]},[r]),u=A({control:t.control,name:"variants",defaultValue:[]}),g=A({control:t.control,name:"options",defaultValue:[]}),p=Gt({options:g,currencies:a,regions:s,pricePreferences:l}),v=C.useMemo(()=>{const i=[];return u.forEach((d,N)=>{d.should_create&&i.push({...d,originalIndex:N})}),i},[u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(R,{columns:p,data:v,state:t,onEditingChange:i=>n(!i)})})},K=lt(),Gt=({options:t,currencies:s=[],regions:r=[],pricePreferences:l=[]})=>{const{t:n}=D();return C.useMemo(()=>[K.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t.map(a=>a.title).join(" / ")})}),cell:a=>e.jsx(R.ReadonlyCell,{context:a,children:t.map(u=>a.row.original.options[u.title]).join(" / ")}),disableHiding:!0}),K.column({id:"title",name:n("fields.title"),header:n("fields.title"),field:a=>`variants.${a.row.original.originalIndex}.title`,type:"text",cell:a=>e.jsx(R.TextCell,{context:a})}),K.column({id:"sku",name:n("fields.sku"),header:n("fields.sku"),field:a=>`variants.${a.row.original.originalIndex}.sku`,type:"text",cell:a=>e.jsx(R.TextCell,{context:a})}),K.column({id:"manage_inventory",name:n("fields.managedInventory"),header:n("fields.managedInventory"),field:a=>`variants.${a.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:a=>e.jsx(R.BooleanCell,{context:a})}),K.column({id:"allow_backorder",name:n("fields.allowBackorder"),header:n("fields.allowBackorder"),field:a=>`variants.${a.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:a=>e.jsx(R.BooleanCell,{context:a})}),K.column({id:"inventory_kit",name:n("fields.inventoryKit"),header:n("fields.inventoryKit"),field:a=>`variants.${a.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:a=>e.jsx(R.BooleanCell,{context:a,disabled:!a.row.original.manage_inventory})}),...it({currencies:s,regions:r,pricePreferences:l,getFieldName:(a,u)=>{var g;return(g=a.column.id)!=null&&g.startsWith("currency_prices")?`variants.${a.row.original.originalIndex}.prices.${u}`:`variants.${a.row.original.originalIndex}.prices.${u}`},t:n})],[s,r,t,l,n])},fe="save-draft-button",Ut=({defaultChannel:t,regions:s,store:r,pricePreferences:l})=>{const[n,a]=C.useState("details"),[u,g]=C.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:p}=D(),{handleSuccess:v}=Ce(),{getFormConfigs:i}=ie(),d=i("product","create"),N=Ye(),m=Qe({defaultValues:{...Ke,sales_channels:t?[{id:t.id,name:t.name}]:[]},schema:He,configs:d}),{mutateAsync:S,isPending:b}=Je(),P=C.useMemo(()=>s!=null&&s.length?s.reduce((c,x)=>(c[x.id]=x.currency_code,c),{}):{},[s]),I=A({control:m.control,name:"variants"}),j=C.useMemo(()=>I.some(c=>c.manage_inventory&&c.inventory_kit),[I]),h=m.handleSubmit(async(c,x)=>{var O;let w=!1;(x==null?void 0:x.nativeEvent)instanceof SubmitEvent&&(w=((O=x==null?void 0:x.nativeEvent)==null?void 0:O.submitter).dataset.name===fe);const _=c.media||[],V={...c,media:void 0};let k=[];try{if(_.length){const f=_.find(F=>F.isThumbnail),z=_.filter(F=>!F.isThumbnail),E=[];f&&E.push(q.admin.upload.create({files:[f.file]}).then(F=>F.files.map(te=>({...te,isThumbnail:!0})))),z!=null&&z.length&&E.push(q.admin.upload.create({files:z.map(F=>F.file)}).then(F=>F.files.map(te=>({...te,isThumbnail:!1})))),k=(await Promise.all(E)).flat()}}catch(f){f instanceof Error&&se.error(f.message)}await S(qe({...V,media:k,status:w?"draft":"published",regionsCurrencyMap:P}),{onSuccess:f=>{se.success(p("products.create.successToast",{title:f.product.title})),v(`../${f.product.id}`)},onError:f=>{se.error(f.message)}})}),y=async c=>{await m.trigger()&&(c==="details"&&a("organize"),c==="organize"&&a("variants"),c==="variants"&&a("inventory"))};return C.useEffect(()=>{const c={...u};n==="details"&&(c.details="in-progress"),n==="organize"&&(c.details="completed",c.organize="in-progress"),n==="variants"&&(c.details="completed",c.organize="completed",c.variants="in-progress"),n==="inventory"&&(c.details="completed",c.organize="completed",c.variants="completed",c.inventory="in-progress"),g({...c})},[n]),e.jsx($.Form,{form:m,children:e.jsxs(ht,{onKeyDown:c=>{if(c.key==="Enter"){if(c.target instanceof HTMLTextAreaElement&&!(c.metaKey||c.ctrlKey))return;if(c.preventDefault(),c.metaKey||c.ctrlKey){if(n!=="variants"){c.preventDefault(),c.stopPropagation(),y(n);return}h()}}},onSubmit:h,className:"flex h-full flex-col",children:[e.jsxs(T,{dir:N,value:n,onValueChange:async c=>{await m.trigger()&&a(c)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx($.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(T.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(T.Trigger,{status:u.details,value:"details",className:"max-w-[200px] truncate",children:p("products.create.tabs.details")}),e.jsx(T.Trigger,{status:u.organize,value:"organize",className:"max-w-[200px] truncate",children:p("products.create.tabs.organize")}),e.jsx(T.Trigger,{status:u.variants,value:"variants",className:"max-w-[200px] truncate",children:p("products.create.tabs.variants")}),j&&e.jsx(T.Trigger,{status:u.inventory,value:"inventory",className:"max-w-[200px] truncate",children:p("products.create.tabs.inventory")})]})})}),e.jsxs($.Body,{className:"size-full overflow-hidden",children:[e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(zt,{form:m})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx(Kt,{form:m})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Lt,{form:m,store:r,regions:s,pricePreferences:l})}),j&&e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(At,{form:m})})]})]}),e.jsx($.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx($.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:p("actions.cancel")})}),e.jsx(M,{"data-name":fe,size:"small",type:"submit",isLoading:b,className:"whitespace-nowrap",children:p("actions.saveAsDraft")}),e.jsx(Wt,{tab:n,next:y,isLoading:b,showInventoryTab:j})]})})]})})},Wt=({tab:t,next:s,isLoading:r,showInventoryTab:l})=>{const{t:n}=D();return t==="variants"&&!l||t==="inventory"&&l?e.jsx(M,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:r,children:n("actions.publish")},"submit-button"):e.jsx(M,{type:"button",variant:"primary",size:"small",onClick:()=>s(t),children:n("actions.continue")},"next-button")},Ws=()=>{const{t}=D(),{store:s,isPending:r,isError:l,error:n}=Ue({fields:"+default_sales_channel"}),{sales_channel:a,isPending:u,isError:g,error:p}=We(s==null?void 0:s.default_sales_channel_id,{enabled:!!(s!=null&&s.default_sales_channel_id)}),{regions:v,isPending:i,isError:d,error:N}=Ze({limit:9999}),{price_preferences:m,isPending:S,isError:b,error:P}=Xe({limit:9999}),I=!!s&&!r&&!!v&&!i&&!!a&&!u&&!!m&&!S;if(l)throw n;if(d)throw N;if(g)throw p;if(b)throw P;return e.jsxs($,{children:[e.jsx($.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.title")})}),e.jsx($.Description,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.description")})}),I&&e.jsx(Ut,{defaultChannel:a,store:s,pricePreferences:m,regions:v})]})};export{Ws as Component};
