import{U as z}from"./chunk-PCV2O6DU---SK5UrV.js";import{b as E,a as K,p as b}from"./chunk-G22WWLPG-C9g-VuwI.js";import{u as B,a as L,b as R,c as H}from"./chunk-5IFK2ZTA-CYHgI7Da.js";import{u as q}from"./chunk-DZWH2RV6-B7cI8-p8.js";import{P as F,a as O,m as Q,cO as A,j as e,a1 as Y,O as U,cP as X,M as G,u as h,X as N,cJ as I,cK as J,C as M,H as W,A as $,q as l,G as j,r as g,bY as Z,t as d,bW as V,W as S,cQ as _,k as ee}from"./index-S35l5lon.js";import{D as se}from"./chunk-CM4CTG5D-ghcQfLC7.js";import{S as ae}from"./chunk-GIZFNLKK-DRFYVOmD.js";import{u as v}from"./use-prompt-D56I0Z60.js";import{T as D}from"./trash-VeZKzNu3.js";import{X as te}from"./x-circle-Cl0aixnX.js";import{P}from"./pencil-square-Y_YO1xMN.js";import{c as ne}from"./create-data-table-command-helper-C3wntDfO.js";import{S as ie}from"./status-badge-CXGqPLdn.js";import{C as re}from"./copy-DHt-vIeE.js";import{c as oe}from"./create-data-table-column-helper-CslhiBa7.js";import"./chunk-2X25XWOW-BV1GECY4.js";import"./chunk-2GWGNMAA-CfkRT-MD.js";import"./create-data-table-filter-helper-BDq3TjGS.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./chunk-C76H5USB-C4gmMgZH.js";import"./use-data-table-C4h0AgWj.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./adjustments-D-7QP2vC.js";import"./checkbox-Bm9_gGRM.js";import"./select-CmrtK7XQ.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./table-u7knMi01.js";import"./arrow-up-mini-BZwwZ9E8.js";import"./index-D8hIMFbh.js";import"./sortable.esm-G2J7QBKc.js";import"./index-DRUHz9yq.js";import"./prompt-YaiseBxh.js";import"./index-BZWkVw9-.js";var le=({apiKey:a})=>{const{t:s}=h(),t=N(),n=v(),{getFullDate:r}=q(),{mutateAsync:o}=I(a.id),{mutateAsync:c}=J(a.id),i=async()=>{await n({title:s("general.areYouSure"),description:s("apiKeyManagement.delete.warning",{title:a.title}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await c(void 0,{onSuccess:()=>{d.success(s("apiKeyManagement.delete.successToast",{title:a.title})),t("..",{replace:!0})},onError:y=>{d.error(y.message)}})},u=async()=>{await n({title:s("general.areYouSure"),description:s("apiKeyManagement.revoke.warning",{title:a.title}),confirmText:s("apiKeyManagement.actions.revoke"),cancelText:s("actions.cancel")})&&await o(void 0,{onSuccess:()=>{d.success(s("apiKeyManagement.revoke.successToast",{title:a.title}))},onError:y=>{d.error(y.message)}})},m=[{icon:e.jsx(D,{}),label:s("actions.delete"),onClick:i,disabled:!a.revoked_at}];a.revoked_at||m.unshift({icon:e.jsx(te,{}),label:s("apiKeyManagement.actions.revoke"),onClick:u,disabled:!!a.revoked_at});const x=E(a.revoked_at,s),f=K(a.type,s);return e.jsxs(M,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(W,{children:a.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center gap-x-2",children:e.jsx(ie,{color:x.color,children:x.label})}),e.jsx($,{groups:[{actions:[{label:s("actions.edit"),icon:e.jsx(P,{}),to:"edit"}]},{actions:m}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("fields.key")}),a.type==="secret"?e.jsx(j,{size:"2xsmall",className:"inline-block w-fit",children:b(a.redacted)}):e.jsx(re,{asChild:!0,content:a.token,className:"cursor-pointer",children:e.jsx(j,{size:"2xsmall",className:"text-ui-tag-neutral-text",children:b(a.redacted)})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("fields.type")}),e.jsx(l,{size:"small",leading:"compact",children:f.label})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("apiKeyManagement.fields.lastUsedAtLabel")}),e.jsx(l,{size:"small",leading:"compact",children:a.last_used_at?r({date:a.last_used_at,includeTime:!0}):"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("apiKeyManagement.fields.createdByLabel")}),e.jsx(k,{userId:a.created_by})]}),a.revoked_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("apiKeyManagement.fields.revokedAtLabel")}),e.jsx(l,{size:"small",leading:"compact",children:r({date:a.revoked_at,includeTime:!0})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("apiKeyManagement.fields.revokedByLabel")}),e.jsx(k,{userId:a.revoked_by})]})]})]})},k=({userId:a})=>{const{user:s,isLoading:t,isError:n,error:r}=V(a,void 0,{enabled:!!a});if(!a)return e.jsx(l,{size:"small",className:"text-ui-fg-subtle",children:"-"});if(n)throw r;return t?e.jsxs("div",{className:"grid grid-cols-[20px_1fr]",children:[e.jsx(S,{className:"h-5 w-5 rounded-full"}),e.jsx(S,{className:"w-full max-w-[220px]"})]}):s?e.jsx(z,{...s}):e.jsx(l,{size:"small",className:"text-ui-fg-subtle",children:"-"})},w=10,C="sc",ce=({apiKey:a})=>{const[s,t]=g.useState({}),{t:n}=h(),r=B({pageSize:w,prefix:C}),{sales_channels:o,count:c,isPending:i}=Z({...r,publishable_key_id:a.id},{placeholderData:ee}),u=me(a.id),m=L(),x=ue(a.id,t),f=R();return e.jsx(M,{className:"divide-y p-0",children:e.jsx(se,{data:o,columns:u,filters:m,commands:x,heading:n("salesChannels.domain"),headingLevel:"h2",getRowId:p=>p.id,rowCount:c,isLoading:i,emptyState:f,rowSelection:{state:s,onRowSelectionChange:t},rowHref:p=>`/settings/sales-channels/${p.id}`,action:{label:n("actions.add"),to:"sales-channels"},prefix:C,pageSize:w})})},T=oe(),me=a=>{const{t:s}=h(),t=N(),n=v(),r=H(),{mutateAsync:o}=_(a),c=g.useCallback(async i=>{await n({title:s("general.areYouSure"),description:s("apiKeyManagement.removeSalesChannel.warning",{name:i.name}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await o([i.id],{onSuccess:()=>{d.success(s("apiKeyManagement.removeSalesChannel.successToast",{count:1}))},onError:m=>{d.error(m.message)}})},[o,n,s]);return g.useMemo(()=>[T.select(),...r,T.action({actions:i=>[[{label:s("actions.edit"),icon:e.jsx(P,{}),onClick:()=>{t(`/settings/sales-channels/${i.row.original.id}/edit`)}}],[{icon:e.jsx(D,{}),label:s("actions.delete"),onClick:()=>c(i.row.original)}]]})],[r,c,t,s])},de=ne(),ue=(a,s)=>{const{t}=h(),n=v(),{mutateAsync:r}=_(a),o=g.useCallback(async c=>{const i=Object.keys(c);await n({title:t("general.areYouSure"),description:t("apiKeyManagement.removeSalesChannel.warningBatch",{count:i.length}),confirmText:t("actions.continue"),cancelText:t("actions.cancel")})&&await r(i,{onSuccess:()=>{d.success(t("apiKeyManagement.removeSalesChannel.successToastBatch",{count:i.length})),s({})},onError:m=>{d.error(m.message)}})},[r,n,t,s]);return g.useMemo(()=>[de.command({action:o,label:t("actions.remove"),shortcut:"r"})],[o,t])},Ve=()=>{const a=F(),{id:s}=O(),{getWidgets:t}=Q(),{api_key:n,isLoading:r,isError:o,error:c}=A(s,{initialData:a});if(r||!n)return e.jsx(Y,{showJSON:!0,sections:1});const i=(n==null?void 0:n.type)==="publishable";if(o)throw c;return e.jsxs(ae,{hasOutlet:!0,showJSON:!0,widgets:{before:t("api_key.details.before"),after:t("api_key.details.after")},data:n,children:[e.jsx(le,{apiKey:n}),i&&e.jsx(ce,{apiKey:n})]})},es=a=>{const{id:s}=a.params||{},{api_key:t}=A(s,{initialData:a.data,enabled:!!s});return t?e.jsx("span",{children:t.title}):null},pe=a=>({queryKey:X.detail(a),queryFn:async()=>U.admin.apiKey.retrieve(a)}),ss=async({params:a})=>{const s=a.id,t=pe(s);return G.ensureQueryData(t)};export{es as Breadcrumb,Ve as Component,ss as loader};
