import{a as K,dN as U,j as e,u as P,r as p,c as G,e as H,ej as L,et as $,t as y,B as x,o as J,v as f,T as Q,a5 as W,s as S,l as X}from"./index-S35l5lon.js";import{K as Y}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as h,u as Z}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{T as ee}from"./thumbnail-badge-Z1PKPc-j.js";import{C as u}from"./command-bar-D5PjKtE8.js";import{C as se}from"./checkbox-Bm9_gGRM.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./index-BqPH3RWs.js";var ae=J({image_ids:X(S()),thumbnail:S().nullable()}),ie=({variant:t})=>{var k,C;const{t:a}=P(),{handleSuccess:c}=Z(),n=((k=t.product)==null?void 0:k.images)||[],m=(t.images||[]).filter(s=>{var i;return(i=s.variants)==null?void 0:i.some(o=>o.id===o.id)}),b=n.filter(s=>{var i;return!((i=s.variants)!=null&&i.some(o=>o.id===o.id))}),[r,j]=p.useState({}),[I,v]=p.useState(!1),d=G({defaultValues:{image_ids:m.map(s=>s.id),thumbnail:t.thumbnail},resolver:H(ae)}),w=d.watch("image_ids"),N=b.filter(s=>!w.includes(s.id)),{mutateAsync:_}=L(t.product_id,t.id),{mutateAsync:z,isPending:A}=$(t.product_id,t.id),O=d.handleSubmit(async s=>{const i=m.map(l=>l.id),o=s.image_ids,g=o.filter(l=>!i.includes(l)),D=i.filter(l=>!o.includes(l));if(s.thumbnail!==t.thumbnail){let l=s.thumbnail;l&&![...i,...o].includes(l)&&(l=null),_({thumbnail:s.thumbnail}).catch(q=>{y.error(q.message)})}await z({add:g,remove:D},{onSuccess:()=>{y.success(a("products.media.successToast")),c()},onError:l=>{y.error(l.message)}})}),T=s=>{const i=d.getValues("image_ids");d.setValue("image_ids",[...i,s],{shouldDirty:!0,shouldTouch:!0})},F=p.useCallback(s=>i=>{if(i)j(o=>({...o,[s]:!0}));else{const{[s]:o,...g}=r;j(g)}},[r]),B=()=>{const s=Object.keys(r);if(!s.length)return;const i=n.find(o=>o.id===s[0]);i&&d.setValue("thumbnail",i.url,{shouldDirty:i.url!==t.thumbnail,shouldTouch:i.url!==t.thumbnail})},M=()=>{const s=Object.keys(r);if(s.length===0)return;const o=d.getValues("image_ids").filter(g=>!s.includes(g));d.setValue("image_ids",o,{shouldDirty:!0,shouldTouch:!0}),j({})},R=d.watch("thumbnail"),E=t.thumbnail&&Object.keys(r).length===1&&R===((C=t.images.find(s=>s.id===Object.keys(r)[0]))==null?void 0:C.url);return e.jsx(h.Form,{blockSearchParams:!0,form:d,children:e.jsxs(Y,{className:"flex size-full flex-col overflow-hidden",onSubmit:O,children:[e.jsx(h.Header,{}),e.jsx(h.Body,{className:"flex flex-col overflow-hidden",children:e.jsxs("div",{className:"relative flex size-full",children:[e.jsxs("div",{className:"bg-ui-bg-subtle flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden",children:[e.jsx("h3",{className:"text-sm font-medium",children:a("products.media.variantImages")}),e.jsx(x,{type:"button",variant:"secondary",size:"small",onClick:()=>v(!I),children:a("products.media.showAvailableImages")})]}),e.jsx("div",{className:"grid h-fit auto-rows-auto grid-cols-2 gap-4 p-4 sm:grid-cols-3 lg:grid-cols-6 lg:gap-6 lg:p-6",children:n.filter(s=>w.includes(s.id)).map(s=>e.jsx(te,{media:s,checked:!!r[s.id],onCheckedChange:F(s.id),isThumbnail:s.url===d.watch("thumbnail")},s.id))})]}),e.jsxs("div",{className:"border-ui-border-base bg-ui-bg-base hidden w-80 border-l lg:block",children:[e.jsx("div",{className:"border-ui-border-base border-b p-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"ui-fg-base ",children:a("products.media.availableImages")}),e.jsx("p",{className:"text-ui-fg-muted mt-1 text-sm",children:a("products.media.selectToAdd")})]})}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:N.map(s=>e.jsx(V,{media:s,onAdd:()=>T(s.id)},s.id))})})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 lg:hidden",onClick:()=>v(!1),children:e.jsxs("div",{className:"bg-ui-bg-base border-ui-border-base absolute right-0 top-0 h-full w-80 border-l",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"border-ui-border-base border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"ui-fg-base text-sm font-medium",children:a("products.media.availableImages")}),e.jsx("p",{className:"text-ui-fg-muted mt-1 pr-2 text-xs",children:a("products.media.selectToAdd")})]}),e.jsx(x,{variant:"transparent",size:"small",onClick:()=>v(!1),children:"Ã—"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:N.map(s=>e.jsx(V,{media:s,onAdd:()=>T(s.id)},s.id))})})]})})]})}),e.jsx(u,{open:Object.keys(r).length>0,children:e.jsxs(u.Bar,{children:[e.jsx(u.Value,{children:a("general.countSelected",{count:Object.keys(r).length})}),e.jsx(u.Seperator,{}),Object.keys(r).length===1&&!E&&e.jsxs(p.Fragment,{children:[e.jsx(u.Command,{action:B,label:a("products.media.makeThumbnail"),shortcut:"t"}),e.jsx(u.Seperator,{})]}),e.jsx(u.Command,{action:M,label:a("products.media.removeSelected"),shortcut:"r"})]})}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(x,{size:"small",type:"submit",isLoading:A,children:a("actions.save")})]})})]})})},te=({media:t,checked:a,onCheckedChange:c,isThumbnail:n})=>{const m=p.useCallback(r=>{c(r)},[c]),{t:b}=P();return e.jsxs("div",{className:f("shadow-elevation-card-rest hover:shadow-elevation-card-hover focus-visible:shadow-borders-focus bg-ui-bg-subtle-hover group relative aspect-square h-auto max-w-full overflow-hidden rounded-lg outline-none"),children:[n&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(Q,{content:b("products.media.thumbnailTooltip"),children:e.jsx(ee,{})})}),e.jsx("div",{className:f("transition-fg absolute right-2 top-2 opacity-0",{"group-focus-within:opacity-100 group-hover:opacity-100 group-focus:opacity-100":!a,"opacity-100":a}),children:e.jsx(se,{onClick:r=>{r.stopPropagation()},checked:a,onCheckedChange:m})}),e.jsx("img",{src:t.url,className:"size-full object-cover object-center"})]})},V=({media:t,onAdd:a})=>e.jsxs("div",{className:f("shadow-elevation-card-rest hover:shadow-elevation-card-hover focus-visible:shadow-borders-focus bg-ui-bg-subtle-hover group relative aspect-square h-auto max-w-full cursor-pointer overflow-hidden rounded-lg outline-none"),onClick:a,children:[e.jsx("div",{className:f("transition-fg absolute inset-0 flex items-center justify-center bg-black/30 opacity-0",{"group-focus-within:opacity-100 group-hover:opacity-100 group-focus:opacity-100":!0}),children:e.jsx("div",{className:"bg-ui-bg-base border-ui-border-base flex h-12 w-12 items-center justify-center rounded-full border shadow-lg",children:e.jsx(W,{})})}),e.jsx("img",{src:t.url,className:"size-full object-cover object-center"})]}),be=()=>{const{id:t,variant_id:a}=K(),{variant:c,isFetching:n,isError:m,error:b}=U(t,a,{fields:"*product,*product.images,*images,+images.variants.id"}),r=!n&&c;if(m)throw b;return e.jsx(h,{children:r&&e.jsx(ie,{variant:c})})};export{be as Component};
