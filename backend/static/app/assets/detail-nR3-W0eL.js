import{a as D,X as L,eF as z,bJ as q,r as p,K as f,j as e,L as y}from"./index-S35l5lon.js";import{s as u}from"./client-DUf8-hSd.js";import{t as o}from"./toast-_TmXxcvA.js";import{A as B,S as A}from"./switch-BDQaPcbG.js";import{E as H}from"./envelope-solid-BKxvxx9H.js";import{E as K,L as m,I as h,T as M}from"./textarea-MFJZH2HF.js";import{T as Q}from"./trash-B7qNFf4m.js";import{C as d,T as g,H as x}from"./heading-Cdx6okg4.js";import{B as r}from"./button-9jJy7PHD.js";import{B as $}from"./badge-DtJwLgim.js";import"./spinner-2pZ_p3OB.js";import"./x-circle-solid-BoF-1eMv.js";import"./index-B9-Umq18.js";const I=async a=>await u.client.fetch(`/admin/email-templates/${a}`,{method:"GET"}),U=async({id:a,data:n})=>await u.client.fetch(`/admin/email-templates/${a}`,{method:"PUT",body:n}),G=async a=>await u.client.fetch(`/admin/email-templates/${a}`,{method:"DELETE"}),J=async({id:a,variables:n})=>await u.client.fetch(`/admin/email-templates/${a}/preview`,{method:"POST",body:{variables:n}}),le=()=>{const{id:a}=D(),n=L(),c=z(),{data:v,isLoading:E,error:_}=q({queryKey:["email-template",a],queryFn:()=>I(a),enabled:!!a}),i=v==null?void 0:v.template,[t,l]=p.useState({name:"",subject:"",description:"",event_name:"",html_content:"",is_active:!0}),[N,T]=p.useState(null),[S,b]=p.useState(!1);p.useEffect(()=>{i&&l({name:i.name,subject:i.subject,description:i.description||"",event_name:i.event_name,html_content:i.html_content,is_active:i.is_active})},[i]);const j=f({mutationFn:U,onSuccess:()=>{c.invalidateQueries({queryKey:["email-templates"]}),c.invalidateQueries({queryKey:["email-template",a]}),o.success("Template updated successfully")},onError:s=>{o.error(s.message||"Failed to update template")}}),w=f({mutationFn:G,onSuccess:()=>{c.invalidateQueries({queryKey:["email-templates"]}),o.success("Template deleted successfully"),n("/notifications")},onError:s=>{o.error(s.message||"Failed to delete template")}}),C=f({mutationFn:J,onSuccess:s=>{T(s.html),b(!0)},onError:s=>{o.error(s.message||"Failed to preview template")}}),F=s=>{s.preventDefault(),a&&j.mutate({id:a,data:t})},P=()=>{a&&confirm("Are you sure you want to delete this template?")&&w.mutate(a)},k=()=>{a&&C.mutate({id:a})};return E?e.jsx("div",{className:"flex flex-col gap-y-4 p-6",children:e.jsx(d,{className:"p-6",children:e.jsx(g,{children:"Loading..."})})}):_||!i?e.jsx("div",{className:"flex flex-col gap-y-4 p-6",children:e.jsxs(d,{className:"p-6",children:[e.jsx(g,{className:"text-ui-fg-error",children:"Failed to load template"}),e.jsx(r,{variant:"secondary",asChild:!0,className:"mt-4",children:e.jsx(y,{to:"/notifications",children:"Back to Notifications"})})]})}):e.jsxs("div",{className:"flex flex-col gap-y-4 p-6",children:[e.jsx(d,{className:"divide-y p-0",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(r,{variant:"transparent",size:"small",asChild:!0,children:e.jsx(y,{to:"/notifications",children:e.jsx(B,{})})}),e.jsx(H,{className:"text-ui-fg-subtle"}),e.jsx(x,{level:"h1",children:i.name}),e.jsx($,{color:i.is_active?"green":"grey",size:"2xsmall",children:i.is_active?"active":"inactive"})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs(r,{size:"small",variant:"secondary",onClick:k,disabled:C.isPending,children:[e.jsx(K,{}),"Preview"]}),e.jsxs(r,{size:"small",variant:"danger",onClick:P,disabled:w.isPending,children:[e.jsx(Q,{}),"Delete"]})]})]})}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(d,{className:"divide-y p-0",children:[e.jsx("div",{className:"px-6 py-4",children:e.jsx(x,{level:"h2",children:"Template Details"})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Name"}),e.jsx(h,{id:"name",value:t.name,onChange:s=>l({...t,name:s.target.value}),placeholder:"Template name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"event_name",children:"Event Name"}),e.jsx(h,{id:"event_name",value:t.event_name,onChange:s=>l({...t,event_name:s.target.value}),placeholder:"e.g., order.placed",className:"font-mono"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"subject",children:"Subject"}),e.jsx(h,{id:"subject",value:t.subject,onChange:s=>l({...t,subject:s.target.value}),placeholder:"Email subject line"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(h,{id:"description",value:t.description,onChange:s=>l({...t,description:s.target.value}),placeholder:"Brief description of this template"})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(A,{id:"is_active",checked:t.is_active,onCheckedChange:s=>l({...t,is_active:s})}),e.jsx(m,{htmlFor:"is_active",children:"Active"})]})]})]}),e.jsxs(d,{className:"divide-y p-0 mt-4",children:[e.jsxs("div",{className:"px-6 py-4",children:[e.jsx(x,{level:"h2",children:"HTML Content"}),e.jsxs(g,{size:"small",className:"text-ui-fg-subtle mt-1",children:["Use ","{{variable}}"," syntax for dynamic content. Available variables depend on the event."]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(M,{value:t.html_content,onChange:s=>l({...t,html_content:s.target.value}),placeholder:"<html>...</html>",className:"font-mono text-sm min-h-[400px]"})})]}),e.jsxs("div",{className:"flex justify-end gap-x-2 mt-4",children:[e.jsx(r,{variant:"secondary",asChild:!0,children:e.jsx(y,{to:"/notifications",children:"Cancel"})}),e.jsx(r,{type:"submit",disabled:j.isPending,children:j.isPending?"Saving...":"Save Changes"})]})]}),S&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx(x,{level:"h2",children:"Email Preview"}),e.jsx(r,{variant:"secondary",size:"small",onClick:()=>b(!1),children:"Close"})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[calc(90vh-80px)]",children:e.jsx("iframe",{srcDoc:N,className:"w-full h-[600px] border rounded",title:"Email Preview"})})]})})]})};export{le as Component};
