import{p as T}from"./chunk-6CPMXY5N-BnsD9cSz.js";import{S as E}from"./chunk-PRLQLEEQ-CKYDE1LK.js";import{i as I}from"./chunk-UC26CCHZ-jn8Rx18I.js";import{S as V}from"./chunk-PYIO3TDQ-D8Zv8hXV.js";import{u as y}from"./chunk-3TZOFKX2-M15LmCS4.js";import{f as w}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{C as j}from"./chunk-OFN7DIZA-C5u54b_Q.js";import{a as N,b as P}from"./chunk-ASIIOFVB-BHdj0c6d.js";import{u as L,a as O,bL as q,j as e,H as z,z as B,c as D,t as v,F as i,I as M,co as R,B as S,e as $,O as k,o as K,s as m,bk as H,cq as A}from"./index-S35l5lon.js";import{K as G}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as c,u as U}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{R as b}from"./radio-group-DTwFvrbm.js";import"./combobox-provider-CcO6EPfN.js";import"./triangles-mini-CX2619vl.js";import"./plus-mini-B5zW_eay.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./index-haGLTuDn.js";var Z=K({name:m().min(1),price_type:A(V),enabled_in_store:H().optional(),shipping_profile_id:m(),shipping_option_type_id:m(),provider_id:m().optional()}),J=({locationId:h,shippingOption:r,type:d})=>{const{t:o}=L(),{handleSuccess:u}=U(),x=B(),f=d==="pickup",p=y({queryFn:s=>k.admin.shippingProfile.list(s),queryKey:["shipping_profiles"],getOptions:s=>s.shipping_profiles.map(t=>({label:t.name,value:t.id})),defaultValue:r.shipping_profile_id}),n=y({queryFn:s=>k.admin.shippingOptionType.list(s),queryKey:["shipping_option_types"],getOptions:s=>s.shipping_option_types.map(t=>({label:t.label,value:t.id}))}),a=D({defaultValues:{name:r.name,price_type:r.price_type,enabled_in_store:I(r),shipping_profile_id:r.shipping_profile_id,shipping_option_type_id:r.type.id,provider_id:r.provider_id},resolver:$(Z)}),{mutateAsync:_,isPending:C}=P(r.id),F=a.handleSubmit(async s=>{const t=r.rules.map(l=>({...T(l,["id","attribute","operator","value"])})),g=t.find(l=>l.attribute==="enabled_in_store");g?g.value=s.enabled_in_store?"true":"false":t.push({value:s.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await _({name:s.name,price_type:s.price_type,shipping_profile_id:s.shipping_profile_id,rules:t,type_id:s.shipping_option_type_id},{onSuccess:({shipping_option:l})=>{v.success(o("stockLocations.shippingOptions.edit.successToast",{name:l.name})),u(`/settings/locations/${h}`)},onError:l=>{v.error(l.message)}})});return e.jsx(c.Form,{form:a,children:e.jsxs(G,{onSubmit:F,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(c.Body,{className:"overflow-y-auto",children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[!f&&e.jsx(i.Field,{control:a.control,name:"price_type",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(i.Control,{children:e.jsxs(b,{dir:x,...s,onValueChange:s.onChange,children:[e.jsx(b.ChoiceBox,{className:"flex-1",value:"flat",label:o("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(b.ChoiceBox,{className:"flex-1",value:"calculated",label:o("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(i.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(i.Field,{control:a.control,name:"name",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("fields.name")}),e.jsx(i.Control,{children:e.jsx(M,{...s})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"shipping_profile_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.profile")}),e.jsx(i.Control,{children:e.jsx(j,{...s,options:p.options,searchValue:p.searchValue,onSearchValueChange:p.onSearchValueChange,disabled:p.disabled})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"shipping_option_type_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.type")}),e.jsx(i.Control,{children:e.jsx(j,{...s,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,disabled:n.disabled})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"provider_id",disabled:!0,render:({field:s})=>{var t;return e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.provider")}),e.jsx(i.Control,{children:e.jsx(j,{value:r.provider_id,disabled:!0,options:[{label:`${w(r.provider_id)} (${((t=r==null?void 0:r.data)==null?void 0:t.id)||"N/A"})`,value:r.provider_id}]})}),e.jsx(i.ErrorMessage,{})]})}})]}),e.jsx(R,{}),e.jsx(E,{control:a.control,name:"enabled_in_store",label:o("stockLocations.shippingOptions.fields.enableInStore.label"),description:o("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(c.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(S,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(S,{size:"small",type:"submit",isLoading:C,children:o("actions.save")})]})})]})})},ue=()=>{const{t:h}=L(),{location_id:r,so_id:d}=O(),{shipping_options:o,isPending:u,isFetching:x,isError:f,error:p}=N({id:d,fields:"+service_zone.fulfillment_set.type"}),n=o==null?void 0:o.find(_=>_.id===d);if(!u&&!x&&!n)throw q({message:`Shipping option with ID ${d} was not found`},404);if(f)throw p;const a=(n==null?void 0:n.service_zone.fulfillment_set.type)==="pickup";return e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx(z,{children:h(`stockLocations.${a?"pickupOptions":"shippingOptions"}.edit.header`)})}),n&&e.jsx(J,{shippingOption:n,locationId:r,type:n.service_zone.fulfillment_set.type})]})};export{ue as Component};
