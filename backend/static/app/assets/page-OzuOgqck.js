import{r as a,bJ as S,j as e}from"./index-S35l5lon.js";import{s as D}from"./client-DUf8-hSd.js";import{S as w}from"./shopping-cart-B8FY75jc.js";import{c as f,C,H as F,T as d}from"./heading-Cdx6okg4.js";import{B as y}from"./button-9jJy7PHD.js";import{S as u}from"./skeleton-D0DBGavF.js";import{B as U}from"./badge-DtJwLgim.js";import"./spinner-2pZ_p3OB.js";var A=Object.defineProperty,j=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,_=(s,r,t)=>r in s?A(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,q=(s,r)=>{for(var t in r||(r={}))E.call(r,t)&&_(s,t,r[t]);if(j)for(var t of j(r))R.call(r,t)&&_(s,t,r[t]);return s},G=(s,r)=>{var t={};for(var i in s)E.call(s,i)&&r.indexOf(i)<0&&(t[i]=s[i]);if(s!=null&&j)for(var i of j(s))r.indexOf(i)<0&&R.call(s,i)&&(t[i]=s[i]);return t};const T=a.forwardRef((s,r)=>{var t=s,{color:i="currentColor"}=t,c=G(t,["color"]);return a.createElement("svg",q({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},c),a.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.5 7.5h10"}))});T.displayName="Minus";const H=a.forwardRef(({className:s,...r},t)=>a.createElement("table",{ref:t,className:f("text-ui-fg-subtle txt-compact-small w-full",s),...r}));H.displayName="Table";const k=a.forwardRef(({className:s,...r},t)=>a.createElement("tr",{ref:t,className:f("bg-ui-bg-base hover:bg-ui-bg-base-hover border-ui-border-base transition-fg border-b","[&_td:last-child]:pr-6 [&_th:last-child]:pr-6","[&_td:first-child]:pl-6 [&_th:first-child]:pl-6",s),...r}));k.displayName="Table.Row";const O=a.forwardRef(({className:s,...r},t)=>a.createElement("td",{ref:t,className:f("h-12 py-0 pl-0 pr-6",s),...r}));O.displayName="Table.Cell";const P=a.forwardRef(({className:s,...r},t)=>a.createElement("thead",{ref:t,className:f("border-ui-border-base txt-compact-small-plus [&_tr]:bg-ui-bg-subtle [&_tr]:hover:bg-ui-bg-subtle border-y",s),...r}));P.displayName="Table.Header";const $=a.forwardRef(({className:s,...r},t)=>a.createElement("th",{ref:t,className:f("txt-compact-small-plus h-12 py-0 pl-0 pr-6 text-left",s),...r}));$.displayName="Table.HeaderCell";const L=a.forwardRef(({className:s,...r},t)=>a.createElement("tbody",{ref:t,className:f("border-ui-border-base border-b",s),...r}));L.displayName="Table.Body";const M=a.forwardRef(({className:s,count:r,pageSize:t,pageCount:i,pageIndex:c,canPreviousPage:g,canNextPage:x,nextPage:N,previousPage:v,translations:m={of:"of",results:"results",pages:"pages",prev:"Prev",next:"Next"},...l},o)=>{const{from:h,to:p}=a.useMemo(()=>{const b=r===0?r:c*t+1,B=Math.min(r,(c+1)*t);return{from:b,to:B}},[r,c,t]);return a.createElement("div",{ref:o,className:f("text-ui-fg-subtle txt-compact-small-plus flex w-full items-center justify-between px-3 py-4",s),...l},a.createElement("div",{className:"inline-flex items-center gap-x-1 px-3 py-[5px]"},a.createElement("p",null,h),a.createElement(T,{className:"text-ui-fg-muted"}),a.createElement("p",null,`${p} ${m.of} ${r} ${m.results}`)),a.createElement("div",{className:"flex items-center gap-x-2"},a.createElement("div",{className:"inline-flex items-center gap-x-1 px-3 py-[5px]"},a.createElement("p",null,c+1," ",m.of," ",Math.max(i,1)," ",m.pages)),a.createElement(y,{type:"button",variant:"transparent",onClick:v,disabled:!g},m.prev),a.createElement(y,{type:"button",variant:"transparent",onClick:N,disabled:!x},m.next)))});M.displayName="Table.Pagination";const n=Object.assign(H,{Row:k,Cell:O,Header:P,HeaderCell:$,Body:L,Pagination:M}),I=async s=>await D.client.fetch(`/admin/abandoned-carts?hours=${s}`,{method:"GET"}),z=()=>{const[s,r]=a.useState(24),{data:t,isLoading:i,error:c,refetch:g}=S({queryKey:["abandoned-carts",s],queryFn:()=>I(s)}),x=(t==null?void 0:t.carts)??[],N=(l,o)=>new Intl.NumberFormat("en-US",{style:"currency",currency:(o==null?void 0:o.toUpperCase())||"USD"}).format(l/100),v=l=>{const o=new Date(l),p=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));if(p<24)return`${p} hours ago`;{const b=Math.floor(p/24);return`${b} day${b>1?"s":""} ago`}},m=l=>{var o,h;return(o=l.shipping_address)!=null&&o.first_name?`${l.shipping_address.first_name} ${l.shipping_address.last_name||""}`.trim():((h=l.email)==null?void 0:h.split("@")[0])||"Unknown"};return e.jsxs("div",{className:"flex flex-col gap-y-4 p-6",children:[e.jsx(C,{className:"divide-y p-0",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(w,{className:"text-ui-fg-subtle"}),e.jsxs("div",{children:[e.jsx(F,{level:"h1",children:"Abandoned Checkouts"}),e.jsx(d,{className:"text-ui-fg-subtle",children:"Customers who started checkout but didn't complete their order"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:s,onChange:l=>r(Number(l.target.value)),className:"rounded-md border border-ui-border-base px-3 py-2 text-sm bg-ui-bg-field",children:[e.jsx("option",{value:1,children:"Last hour"}),e.jsx("option",{value:6,children:"Last 6 hours"}),e.jsx("option",{value:24,children:"Last 24 hours"}),e.jsx("option",{value:48,children:"Last 48 hours"}),e.jsx("option",{value:168,children:"Last 7 days"}),e.jsx("option",{value:720,children:"Last 30 days"})]}),e.jsx(y,{variant:"secondary",onClick:()=>g(),children:"Refresh"})]})]})}),e.jsx(C,{className:"divide-y p-0",children:e.jsx("div",{className:"px-6 py-4",children:i?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(l=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{className:"h-5 w-32"}),e.jsx(u,{className:"h-5 w-48"}),e.jsx(u,{className:"h-5 w-24"}),e.jsx(u,{className:"h-5 w-16"}),e.jsx(u,{className:"h-5 w-20"}),e.jsx(u,{className:"h-5 w-24"})]},l))}):c?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(d,{className:"text-ui-fg-error",children:"Failed to load abandoned carts. Make sure the backend is running."})}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10",children:[e.jsx(w,{className:"text-ui-fg-muted mb-2 h-10 w-10"}),e.jsx(d,{className:"text-ui-fg-muted",children:"No abandoned carts found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(U,{color:"orange",children:[x.length," abandoned checkout",x.length!==1?"s":""]})}),e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsxs(n.Row,{children:[e.jsx(n.HeaderCell,{children:"Customer"}),e.jsx(n.HeaderCell,{children:"Email"}),e.jsx(n.HeaderCell,{children:"Phone"}),e.jsx(n.HeaderCell,{children:"Items"}),e.jsx(n.HeaderCell,{children:"Total"}),e.jsx(n.HeaderCell,{children:"Abandoned"})]})}),e.jsx(n.Body,{children:x.map(l=>{var o,h,p;return e.jsxs(n.Row,{className:"cursor-pointer hover:bg-ui-bg-subtle",children:[e.jsx(n.Cell,{children:e.jsx(d,{className:"font-medium",children:m(l)})}),e.jsx(n.Cell,{children:e.jsx(d,{children:l.email||"-"})}),e.jsx(n.Cell,{children:e.jsx(d,{children:((o=l.shipping_address)==null?void 0:o.phone)||"-"})}),e.jsx(n.Cell,{children:e.jsxs(d,{children:[((h=l.items)==null?void 0:h.length)||0," item",(((p=l.items)==null?void 0:p.length)||0)!==1?"s":""]})}),e.jsx(n.Cell,{children:e.jsx(d,{className:"font-medium",children:N(l.total,l.currency_code)})}),e.jsx(n.Cell,{children:e.jsx(d,{className:"text-ui-fg-subtle",children:v(l.updated_at)})})]},l.id)})})]})]})})})]})};export{z as Component};
