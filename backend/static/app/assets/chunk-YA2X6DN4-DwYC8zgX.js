import{u as w}from"./chunk-3TZOFKX2-M15LmCS4.js";import{C as F}from"./chunk-IIOYXMGT-mKE2FEFe.js";import{C as B}from"./chunk-OFN7DIZA-C5u54b_Q.js";import{u as b,c as S,e as A,ey as E,t as v,E as y,r as C,j as e,B as N,z as V,O as T,b as K,F as c,o as z,H as _,q as t,J as D,s as I}from"./index-S35l5lon.js";import{K as L}from"./chunk-6HTZNHPT-USxWRfar.js";import{u as P,a as h}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{R as j}from"./radio-group-DTwFvrbm.js";var R={spend:"spend",usage:"usage",use_by_attribute:"useByAttribute"},M=s=>{const a=R[s==null?void 0:s.type]||"-";return(s==null?void 0:s.type)==="use_by_attribute"?(s==null?void 0:s.attribute)==="customer_id"?"campaigns.budget.type.useByAttribute.titleCustomerId":(s==null?void 0:s.attribute)==="customer_email"?"campaigns.budget.type.useByAttribute.titleEmail":"campaigns.budget.type.useByAttribute.title":`campaigns.budget.type.${a}.title`},q=({campaign:s})=>{var d,i,m,l,o,x;const{t:a}=b();if(s)return e.jsxs(C.Fragment,{children:[e.jsxs("div",{children:[e.jsx(_,{level:"h2",className:"mb-4",children:a("campaigns.details")}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus font-",children:a("campaigns.fields.identifier")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:s.campaign_identifier||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:a("fields.description")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:s.description||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:a("campaigns.fields.start_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((d=s.starts_at)==null?void 0:d.toString())||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:a("campaigns.fields.end_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((i=s.ends_at)==null?void 0:i.toString())||"-"})})]})]}),e.jsxs("div",{children:[e.jsx(_,{level:"h2",className:"mb-4",children:a("campaigns.budget.details")}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus font-",children:a("campaigns.budget.fields.type")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small truncate",children:a(M(s.budget),{defaultValue:"-"})})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:a("campaigns.budget.fields.currency")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((m=s==null?void 0:s.budget)==null?void 0:m.currency_code)||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:a("campaigns.budget.fields.limit")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((l=s.budget)==null?void 0:l.limit)||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:((o=s.budget)==null?void 0:o.type)==="use_by_attribute"?a("campaigns.fields.totalUsedByAttribute"):a("campaigns.budget.fields.used")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((x=s.budget)==null?void 0:x.used)||"-"})})]})]})]})},U=z({campaign_id:I().optional().nullable(),campaign_choice:D(["none","existing"]).optional()}),H=({form:s,withNewCampaign:a=!0,promotionCurrencyCode:d})=>{const{t:i}=b(),m=V(),l=y({control:s.control,name:"campaign_id"}),o=y({control:s.control,name:"campaign_choice"}),x=w({queryFn:n=>T.admin.campaign.list({...n}),queryKey:["campaigns"],getOptions:n=>n.campaigns.map(r=>{var p,u,g;return{label:r.name.toUpperCase(),value:r.id,disabled:((p=r.budget)==null?void 0:p.currency_code)&&((g=(u=r.budget)==null?void 0:u.currency_code)==null?void 0:g.toLowerCase())!==(d==null?void 0:d.toLowerCase())}})}),{campaign:f}=K(l,void 0,{enabled:!!l});return e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(c.Field,{control:s.control,name:"campaign_choice",render:({field:n})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{children:i("promotions.fields.campaign")}),e.jsx(c.Control,{children:e.jsxs(j,{dir:m,className:"grid grid-cols-1 gap-3",...n,value:n.value,onValueChange:n.onChange,children:[e.jsx(j.ChoiceBox,{value:"none",label:i("promotions.form.campaign.none.title"),description:i("promotions.form.campaign.none.description")}),e.jsx(j.ChoiceBox,{value:"existing",label:i("promotions.form.campaign.existing.title"),description:i("promotions.form.campaign.existing.description")}),a&&e.jsx(j.ChoiceBox,{value:"new",label:i("promotions.form.campaign.new.title"),description:i("promotions.form.campaign.new.description")})]})}),e.jsx(c.ErrorMessage,{})]})}),o==="existing"&&e.jsx(c.Field,{control:s.control,name:"campaign_id",render:({field:{onChange:n,...r}})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{tooltip:i("campaigns.fields.campaign_id.hint"),children:i("promotions.form.campaign.existing.title")}),e.jsx(c.Control,{children:e.jsx(B,{dir:m,options:x.options,searchValue:x.searchValue,onSearchValueChange:x.onSearchValueChange,onChange:n,...r})}),e.jsx(c.ErrorMessage,{})]})}),o==="new"&&e.jsx(F,{form:s,fieldScope:"campaign."}),e.jsx(q,{campaign:f})]})},X=({promotion:s})=>{var p;const{t:a}=b(),{handleSuccess:d}=P(),{campaign:i}=s,m=i==null?void 0:i.id,l=S({defaultValues:{campaign_id:i==null?void 0:i.id,campaign_choice:i!=null&&i.id?"existing":"none"},resolver:A(U)}),{setValue:o}=l,{mutateAsync:x,isPending:f}=E(s.id),n=l.handleSubmit(async u=>{await x({campaign_id:u.campaign_id},{onSuccess:()=>{v.success(a("promotions.campaign.edit.successToast")),d()},onError:g=>{v.error(g.message)}})}),r=y({control:l.control,name:"campaign_choice"});return C.useEffect(()=>{r==="none"&&o("campaign_id",null),r==="existing"&&o("campaign_id",m)},[r,o,m]),e.jsx(h.Form,{form:l,children:e.jsxs(L,{onSubmit:n,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(h.Body,{className:"size-full overflow-auto",children:e.jsx(H,{form:l,withNewCampaign:!1,promotionCurrencyCode:(p=s.application_method)==null?void 0:p.currency_code})}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(N,{size:"small",variant:"secondary",children:a("actions.cancel")})}),e.jsx(N,{size:"small",type:"submit",isLoading:f,children:a("actions.save")})]})})]})})};export{H as A,X as a};
