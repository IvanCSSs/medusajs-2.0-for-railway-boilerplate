import{a as k,u as g,bA as I,bv as w,j as e,H as C,r as u,dF as _,q as d,dG as E,O as F,B as y,I as B,v as D,t as L}from"./index-S35l5lon.js";import{a as x,u as T}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{C as q}from"./checkbox-Bm9_gGRM.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var A=({selected:a,onSelect:n,location:s})=>{var c,i,r;return e.jsxs("div",{className:D("flex w-full cursor-pointer gap-x-2 rounded-lg border px-2 py-2",{"border-ui-border-interactive ":a}),onClick:()=>n(!a),children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(q,{onClick:l=>{l.stopPropagation(),n(!a)},checked:a})}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:s.name}),e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:[(c=s.address)==null?void 0:c.address_1,(i=s.address)==null?void 0:i.city,(r=s.address)==null?void 0:r.country_code].filter(l=>!!l).join(", ")})]})]})},M=({onSearchChange:a,placeholder:n})=>{const{t:s}=g(),[c,i]=u.useState("");return u.useEffect(()=>{const r=setTimeout(()=>{a(c)},300);return()=>clearTimeout(r)},[c,a]),e.jsx(B,{type:"text",placeholder:n||s("general.search"),value:c,onChange:r=>i(r.target.value),className:"w-full"})},H=({item:a})=>{const n=u.useMemo(()=>{var t;return new Set(((t=a.location_levels)==null?void 0:t.map(m=>m.location_id))??[])},[a.location_levels]),{t:s}=g(),{handleSuccess:c}=T(),[i,r]=u.useState(""),[l,h]=u.useState(n),{count:f}=w({limit:1,fields:"id"}),N=(t,m)=>{h(p=>{const o=new Set(p);return m?o.add(t):o.delete(t),o})},{mutateAsync:S}=_(a.id),z=async()=>{const t=Array.from(l).filter(o=>!n.has(o)),p=Array.from(n).filter(o=>!l.has(o)).map(o=>{var j,v;return(v=(j=a.location_levels)==null?void 0:j.find(b=>b.location_id===o))==null?void 0:v.id}).filter(Boolean);await S({create:t.map(o=>({location_id:o})),delete:p},{onSuccess:()=>{L.success(s("inventory.toast.updateLocations")),c()},onError:o=>{L.error(o.message)}})};return e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(x.Body,{className:"flex flex-1 flex-col gap-y-4 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-2 divide-y rounded-lg border",children:[e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(d,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s("fields.title")}),e.jsx(d,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.title??"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(d,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s("fields.sku")}),e.jsx(d,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.sku})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(d,{size:"small",weight:"plus",leading:"compact",children:s("locations.domain")}),e.jsxs("div",{className:"text-ui-fg-subtle flex w-full justify-between",children:[e.jsx(d,{size:"small",leading:"compact",children:s("locations.selectLocations")}),e.jsxs(d,{size:"small",leading:"compact",children:["(",s("general.countOfTotalSelected",{count:l.size,total:f}),")"]})]})]}),e.jsx(M,{onSearchChange:r,placeholder:s("general.search")}),e.jsx("div",{className:"min-h-0 flex-1",children:e.jsx(E,{queryKey:["stock-locations",i],queryFn:async t=>await F.admin.stockLocation.list({limit:t.limit,offset:t.offset,...i&&{q:i}}),responseKey:"stock_locations",renderItem:t=>e.jsx(A,{selected:l.has(t.id),location:t,onSelect:m=>N(t.id,m)}),renderEmpty:()=>e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(d,{size:"small",className:"text-ui-fg-subtle",children:s("locations.noLocationsFound")})}),pageSize:20})})]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(y,{onClick:z,size:"small",isLoading:!1,children:s("actions.save")})]})})]})},V=()=>{const{id:a}=k(),{t:n}=g(),{inventory_item:s,isPending:c,isError:i,error:r}=I(a),{stock_locations:l,isLoading:h}=w(),f=!c&&!h&&s&&l;if(i)throw r;return e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsx(C,{children:n("inventory.manageLocations")})}),f&&e.jsx(H,{item:s,locations:l})]})};export{V as Component};
