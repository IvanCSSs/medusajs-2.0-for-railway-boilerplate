import{u as k,a as A,d2 as O,bL as z,j as e,H as B,ek as F,r as v,c as H,e as M,t as w,ec as q,B as P,o as L,k as J,l as K,s as Q}from"./index-S35l5lon.js";import{u as $,_ as G}from"./chunk-ULVVVKLF-DQ5i1kAh.js";import"./chunk-GU5PJRPM-CRBxyP7n.js";import{u as Z}from"./chunk-C76H5USB-C4gmMgZH.js";import{K as U}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as d,u as W}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{c as X}from"./index-D8hIMFbh.js";import{C as N}from"./checkbox-Bm9_gGRM.js";import"./chunk-HQKGZADC-CFjwmGLF.js";import"./table-u7knMi01.js";import"./chunk-EMIHDNB7-1UnYIHIF.js";import"./plus-mini-B5zW_eay.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./index-haGLTuDn.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var Y=({prefix:u,pageSize:r=20})=>{const t=Z(["offset","q","order","created_at","updated_at"],u),{offset:o,q:h,order:l,created_at:i,updated_at:m}=t;return{searchParams:{limit:r,offset:o?Number(o):0,order:l,created_at:i?JSON.parse(i):void 0,updated_at:m?JSON.parse(m):void 0,q:h},raw:t}},j=20,ee=L({variants:K(Q())}),f=X(),se=({productId:u,image:r})=>{var S;const{t}=k(),{handleSuccess:o}=W(),{mutateAsync:h,isPending:l}=F(u,r.id),[i,m]=v.useState(()=>{var s;return((s=r.variants)==null?void 0:s.reduce((a,c)=>(a[c.id]=!0,a),{}))||{}});v.useEffect(()=>{var s;m(((s=r.variants)==null?void 0:s.reduce((a,c)=>(a[c.id]=!0,a),{}))||{})},[r.variants.length]);const p=H({defaultValues:{variants:((S=r.variants)==null?void 0:S.map(s=>s.id))||[]},resolver:M(ee)}),T=p.handleSubmit(async s=>{var y;const a=((y=r==null?void 0:r.variants)==null?void 0:y.map(n=>n.id))||[],c=Object.keys(i).filter(n=>i[n]),x=c.filter(n=>!a.includes(n)),E=a.filter(n=>!c.includes(n));await h({add:x,remove:E},{onSuccess:()=>{w.success(t("products.variantMedia.successToast")),o()},onError:n=>{w.error(n.message)}})}),g=v.useMemo(()=>[f.display({id:"select",header:({table:s})=>e.jsx(N,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a)}),cell:({row:s})=>e.jsx(N,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),f.accessor("title",{header:()=>t("fields.title"),cell:({getValue:s})=>{const a=s();return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:a||"-"})})}}),f.accessor("sku",{header:()=>t("fields.sku"),cell:({getValue:s})=>{const a=s();return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate font-mono text-sm",children:a||"-"})})}}),f.accessor("thumbnail",{header:()=>t("fields.thumbnail"),cell:({getValue:s})=>{const a=s()===r.url;return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate text-sm",children:t(a?"fields.true":"fields.false")})})}})],[t]),C=s=>{const a=typeof s=="function"?s(i):s;m(a);const c=Object.keys(a).filter(x=>a[x]);p.setValue("variants",c,{shouldDirty:!0,shouldTouch:!0})},{searchParams:V,raw:I}=Y({pageSize:j}),{variants:_,count:b,isPending:D}=q(u,{...V},{placeholderData:J}),{table:R}=$({data:_||[],columns:g,count:b,enablePagination:!0,enableRowSelection:!0,pageSize:j,getRowId:s=>s.id,rowSelection:{state:i,updater:C}});return e.jsx(d.Form,{form:p,children:e.jsxs(U,{onSubmit:T,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(d.Body,{className:"flex flex-col gap-y-8 overflow-y-auto p-0",children:e.jsx("div",{className:"flex h-full flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(G,{layout:"fill",table:R,columns:g,count:b,isLoading:D,pageSize:j,queryObject:I,pagination:!0,search:!0})})})}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(P,{size:"small",variant:"secondary",children:t("actions.cancel")})}),e.jsx(P,{size:"small",type:"submit",isLoading:l,disabled:l,children:t("actions.save")})]})})]})})},Ne=()=>{var i;const{t:u}=k(),{id:r,image_id:t}=A(),{product:o,isPending:h}=O(r,{fields:"images.id,images.url,images.variants.id"},{enabled:!!r&&!!t}),l=(i=o==null?void 0:o.images)==null?void 0:i.find(m=>m.id===t);if(!r||!t||h)return null;if(!h&&!l)throw z({message:`An image with ID ${t} was not found`},404);return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("img",{src:l.url,className:"h-20"}),e.jsxs("div",{children:[e.jsx(d.Title,{asChild:!0,children:e.jsx(B,{children:u("products.variantMedia.manageVariants")})}),e.jsx(d.Description,{children:u("products.variantMedia.manageVariantsDescription")})]})]})}),e.jsx(se,{productId:r,image:l})]})};export{Ne as Component};
