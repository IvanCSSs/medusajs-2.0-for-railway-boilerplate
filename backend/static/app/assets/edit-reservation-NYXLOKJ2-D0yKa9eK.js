import{a as E,u as w,bz as I,bA as R,bv as T,j as e,H as k,z as C,c as N,e as z,bD as D,t as _,F as t,I as L,B as q,o as A,q as F,n as M,s as S}from"./index-S35l5lon.js";import{K as V}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as c,u as B}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{S as u}from"./select-CmrtK7XQ.js";import{T as H}from"./textarea-FJbwiCAd.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";var K=A({location_id:S(),description:S().optional(),quantity:M().min(1)}),v=({title:i,value:o})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(F,{className:"px-2 py-1.5",size:"small",leading:"compact",children:i}),e.jsx(F,{className:"px-2 py-1.5",size:"small",leading:"compact",children:o})]}),P=i=>({quantity:i.quantity,location_id:i.location_id,description:i.description??void 0}),G=({reservation:i,item:o,locations:r})=>{const{t:a}=w(),{handleSuccess:h}=B(),p=C(),s=N({defaultValues:P(i),resolver:z(K)}),{mutateAsync:m}=D(i.id),y=s.handleSubmit(async n=>{m(n,{onSuccess:()=>{_.success(a("inventory.reservation.updateSuccessToast")),h()},onError:d=>{_.error(d.message)}})}),x=s.watch("quantity"),f=s.watch("location_id"),j=o.location_levels.find(n=>n.location_id===f);return e.jsx(c.Form,{form:s,children:e.jsxs(V,{onSubmit:y,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(t.Field,{control:s.control,name:"location_id",render:({field:{onChange:n,value:d,ref:g,...b}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:a("inventory.reservation.location")}),e.jsx(t.Control,{children:e.jsxs(u,{dir:p,value:d,onValueChange:l=>{n(l)},...b,children:[e.jsx(u.Trigger,{ref:g,children:e.jsx(u.Value,{})}),e.jsx(u.Content,{children:(r||[]).map(l=>e.jsx(u.Item,{value:l.id,children:l.name},l.id))})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(v,{title:a("fields.title"),value:o.title??o.sku}),e.jsx(v,{title:a("fields.sku"),value:o.sku}),e.jsx(v,{title:a("fields.inStock"),value:j.stocked_quantity}),e.jsx(v,{title:a("inventory.available"),value:j.stocked_quantity-(j.reserved_quantity-i.quantity)-x})]}),e.jsx(t.Field,{control:s.control,name:"quantity",render:({field:{onChange:n,value:d,...g}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:a("inventory.reservation.reservedAmount")}),e.jsx(t.Control,{children:e.jsx(L,{type:"number",min:0,max:(j.available_quantity||0)+(i.quantity||0),value:d||"",onChange:b=>{const l=b.target.value;n(l===""?null:parseFloat(l))},...g})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:s.control,name:"description",render:({field:n})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:a("fields.description")}),e.jsx(t.Control,{children:e.jsx(H,{...n})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsx(c.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(q,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(q,{type:"submit",size:"small",isLoading:!1,children:a("actions.save")})]})})]})})},ee=()=>{var x;const{id:i}=E(),{t:o}=w(),{reservation:r,isPending:a,isError:h,error:p}=I(i),{inventory_item:s}=R(r==null?void 0:r.inventory_item_id,{enabled:!!r}),{stock_locations:m}=T({id:(x=s==null?void 0:s.location_levels)==null?void 0:x.map(f=>f.location_id)},{enabled:!!(s!=null&&s.location_levels)}),y=!a&&r&&s&&m;if(h)throw p;return e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx(k,{children:o("inventory.reservation.editItemDetails")})}),y&&e.jsx(G,{locations:m,reservation:r,item:s})]})};export{ee as Component};
