import{u as X}from"./chunk-3TZOFKX2-M15LmCS4.js";import{u as $,a as Q,b as U}from"./chunk-NOAFLTPV-oIicrk9h.js";import{f as W}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{b2 as Z,j as e,r as H,z as J,c as Y,E as ee,u as se,bG as re,t as w,bH as k,v as ie,H as te,q as p,F as r,I as oe,bI as I,B as x,e as ae,am as ne,O as le,o as P,l as R,bk as T,s as j}from"./index-S35l5lon.js";import{C as ce}from"./chunk-OFN7DIZA-C5u54b_Q.js";import{u as de,_ as me}from"./chunk-ULVVVKLF-DQ5i1kAh.js";import"./chunk-GU5PJRPM-CRBxyP7n.js";import{c as ue}from"./chunk-DK4WIVY6-CYCbBMOO.js";import{K as xe}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as h,b as he,u as pe,S as u}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{S as f}from"./select-CmrtK7XQ.js";import{c as je}from"./index-D8hIMFbh.js";import{C as F}from"./checkbox-Bm9_gGRM.js";import"./chunk-C76H5USB-C4gmMgZH.js";import"./combobox-provider-CcO6EPfN.js";import"./triangles-mini-CX2619vl.js";import"./plus-mini-B5zW_eay.js";import"./chunk-HQKGZADC-CFjwmGLF.js";import"./table-u7knMi01.js";import"./chunk-EMIHDNB7-1UnYIHIF.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./index-haGLTuDn.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./check-B9bFzKnZ.js";var fe=P({name:j().min(1),currency_code:j().min(2,"Select a currency"),automatic_taxes:T(),is_tax_inclusive:T(),countries:R(P({code:j(),name:j()})),payment_providers:R(j()).min(1)}),y="cr",C=50,z="countries-modal",ge=({currencies:a})=>{const{setIsOpen:o}=he(),[l,d]=H.useState({}),{handleSuccess:g}=pe(),v=J(),n=Y({defaultValues:{name:"",currency_code:"",automatic_taxes:!0,is_tax_inclusive:!1,countries:[],payment_providers:[]},resolver:ae(fe)}),b=ee({control:n.control,name:"countries",defaultValue:[]}),{t}=se(),{mutateAsync:E,isPending:M}=re(),D=n.handleSubmit(async s=>{await E({name:s.name,countries:s.countries.map(i=>i.code),currency_code:s.currency_code,payment_providers:s.payment_providers,automatic_taxes:s.automatic_taxes,is_tax_inclusive:s.is_tax_inclusive},{onSuccess:({region:i})=>{w.success(t("regions.toast.create")),g(`../${i.id}`)},onError:i=>{w.error(i.message)}})}),{searchParams:L,raw:A}=$({pageSize:C,prefix:y}),{countries:V,count:_}=Q({countries:k.map((s,i)=>({display_name:s.display_name,name:s.name,id:i,iso_2:s.iso_2,iso_3:s.iso_3,num_code:s.num_code,region_id:null,region:{}})),...L}),N=be(),{table:O}=de({data:V||[],columns:N,count:_,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:l,updater:d},getRowId:s=>s.iso_2,pageSize:C,prefix:y}),B=()=>{const s=Object.keys(l).filter(i=>l[i]);n.setValue("countries",s.map(i=>({code:i,name:k.find(m=>m.iso_2===i).display_name})),{shouldDirty:!0,shouldTouch:!0}),o(z,!1)},q=s=>{const i=b.filter(c=>c.code!==s),m=i.map(c=>c.code).reduce((c,G)=>(c[G]=!0,c),{});n.setValue("countries",i,{shouldDirty:!0,shouldTouch:!0}),d(m)},K=()=>{n.setValue("countries",[],{shouldDirty:!0,shouldTouch:!0}),d({})},S=X({queryFn:s=>le.admin.payment.listPaymentProviders({...s,is_enabled:!0}),queryKey:["payment_providers"],getOptions:s=>s.payment_providers.map(i=>({label:W(i.id),value:i.id}))});return e.jsx(h.Form,{form:n,children:e.jsxs(xe,{className:"flex h-full flex-col overflow-hidden",onSubmit:D,children:[e.jsx(h.Header,{}),e.jsx(h.Body,{className:"flex overflow-hidden",children:e.jsx("div",{className:ie("flex h-full w-full flex-col items-center overflow-y-auto p-16"),id:"form-section",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(te,{children:t("regions.createRegion")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.createRegionHint")})]}),e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:n.control,name:"name",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.name")}),e.jsx(r.Control,{children:e.jsx(oe,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"currency_code",render:({field:{onChange:s,ref:i,...m}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.currency")}),e.jsx(r.Control,{children:e.jsxs(f,{dir:v,...m,onValueChange:s,children:[e.jsx(f.Trigger,{ref:i,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:a.map(c=>e.jsx(f.Item,{value:c.code,children:c.name},c.code))})]})}),e.jsx(r.ErrorMessage,{})]})})]})}),e.jsx(r.Field,{control:n.control,name:"automatic_taxes",render:({field:{value:s,onChange:i,...m}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:t("fields.automaticTaxes")}),e.jsx(r.Control,{children:e.jsx(I,{dir:"ltr",className:"rtl:rotate-180",...m,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:t("regions.automaticTaxesHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx(r.Field,{control:n.control,name:"is_tax_inclusive",render:({field:{value:s,onChange:i,...m}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:t("fields.taxInclusivePricing")}),e.jsx(r.Control,{children:e.jsx(I,{className:"rtl:rotate-180",dir:"ltr",...m,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:t("regions.taxInclusiveHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.countries")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.countriesHint")})]}),b.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(s=>e.jsx(ye,{country:s,onRemove:q},s.code)),e.jsx(x,{variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle",onClick:K,children:t("actions.clearAll")})]}),e.jsxs(u,{id:z,children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(u.Trigger,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:t("regions.addCountries")})})}),e.jsx(u.Content,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(u.Header,{children:e.jsx(u.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("regions.addCountries")})})}),e.jsx(u.Body,{className:"overflow-hidden",children:e.jsx(me,{table:O,columns:N,count:_,pageSize:C,orderBy:[{key:"display_name",label:t("fields.name")},{key:"iso_2",label:t("fields.code")}],pagination:!0,search:"autofocus",layout:"fill",queryObject:A,prefix:y})}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(x,{size:"small",type:"button",onClick:B,children:t("actions.save")})]})})]})})]})]}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.providers")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.providersHint")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(r.Field,{control:n.control,name:"payment_providers",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.paymentProviders")}),e.jsx(r.Control,{children:e.jsx(ce,{forceHideInput:!0,options:S.options,fetchNextPage:S.fetchNextPage,...s})}),e.jsx(r.ErrorMessage,{})]})})})]})]})})}),e.jsxs(h.Footer,{children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(x,{size:"small",variant:"secondary",children:t("actions.cancel")})}),e.jsx(x,{size:"small",type:"submit",isLoading:M,children:t("actions.save")})]})]})})},ve=je(),be=()=>{const a=U();return H.useMemo(()=>[ve.display({id:"select",header:({table:o})=>e.jsx(F,{checked:o.getIsSomePageRowsSelected()?"indeterminate":o.getIsAllPageRowsSelected(),onCheckedChange:l=>o.toggleAllPageRowsSelected(!!l)}),cell:({row:o})=>{const l=!o.getCanSelect();return e.jsx(F,{checked:o.getIsSelected()||l,disabled:l,onCheckedChange:d=>o.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),...a],[a])},ye=({country:a,onRemove:o})=>e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base transition-fg hover:bg-ui-bg-field-hover flex h-7 items-center overflow-hidden rounded-md",children:[e.jsx("div",{className:"txt-compact-small-plus flex h-full select-none items-center justify-center px-2 py-0.5",children:a.name}),e.jsx("button",{type:"button",onClick:()=>o(a.code),className:"focus-visible:bg-ui-bg-field-hover transition-fg hover:bg-ui-bg-field-hover flex h-full w-7 items-center justify-center border-l outline-none",children:e.jsx(ne,{className:"text-ui-fg-muted"})})]}),es=()=>{const{store:a,isPending:o,isError:l,error:d}=Z(),g=((a==null?void 0:a.supported_currencies)??[]).map(v=>ue[v.currency_code.toUpperCase()]);if(l)throw d;return e.jsx(h,{children:!o&&a&&e.jsx(ge,{currencies:g})})};export{es as Component};
