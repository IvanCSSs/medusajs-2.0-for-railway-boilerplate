import{P as G}from"./chunk-AM2BU2RH-Jz_rw4zs.js";import{P as $}from"./chunk-MAFEBZA7-ChMQGASp.js";import{S as X,a as Z}from"./chunk-HWKLNKOY-Cn0Svd_K.js";import{a as ee}from"./chunk-B6ZOPCPA-Bu8977YU.js";import{S as x}from"./chunk-LFLGEXIG-4PAd85Bq.js";import{u as te}from"./chunk-2GWGNMAA-CfkRT-MD.js";import{D as se}from"./chunk-CM4CTG5D-ghcQfLC7.js";import{d2 as Y,j as e,P as ae,a as ie,m as L,R as ne,O as re,ab as le,M as oe,u as v,X as M,e4 as ce,C as S,H as N,A as w,r as b,eb as de,v as U,T as z,L as q,q as P,B as ue,a5 as me,G as R,ec as pe,ed as J,bY as xe,ak as he,t as fe,ee as ve,ef as ge,y as je,bg as ye,k as be}from"./index-S35l5lon.js";import{T as E}from"./chunk-GIZFNLKK-DRFYVOmD.js";import{u as Se}from"./chunk-C76H5USB-C4gmMgZH.js";import{u as B}from"./use-prompt-D56I0Z60.js";import{P as j}from"./pencil-square-Y_YO1xMN.js";import{T as H}from"./trash-VeZKzNu3.js";import{T as we}from"./thumbnail-badge-Z1PKPc-j.js";import{C as Ce}from"./channels-W9FOQbxK.js";import{C as F}from"./component-DIzZwMmE.js";import{S as Ne}from"./status-badge-CXGqPLdn.js";import{C as ke}from"./checkbox-Bm9_gGRM.js";import{C as k}from"./command-bar-D5PjKtE8.js";import{c as _e}from"./create-data-table-column-helper-CslhiBa7.js";import{c as Pe}from"./create-data-table-filter-helper-BDq3TjGS.js";import{c as Te}from"./create-data-table-command-helper-C3wntDfO.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./use-data-table-C4h0AgWj.js";import"./adjustments-D-7QP2vC.js";import"./select-CmrtK7XQ.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./index-BqPH3RWs.js";import"./triangle-left-mini-CmFFwE40.js";import"./table-u7knMi01.js";import"./arrow-up-mini-BZwwZ9E8.js";import"./index-D8hIMFbh.js";import"./sortable.esm-G2J7QBKc.js";import"./index-DRUHz9yq.js";import"./prompt-YaiseBxh.js";var zt=s=>{const{id:t}=s.params||{},{product:a}=Y(t,{fields:$},{initialData:s.data,enabled:!!t});return a?e.jsx("span",{children:a.title}):null},De=s=>({queryKey:le.detail(s,{fields:$}),queryFn:async()=>re.admin.product.retrieve(s,{fields:$})}),At=async({params:s})=>{const t=s.id,a=De(t);return await oe.ensureQueryData({...a,staleTime:9e4})},Ie=({product:s})=>{const{t}=v(),{getDisplays:a}=L();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.attributes")}),e.jsx(w,{groups:[{actions:[{label:t("actions.edit"),to:"attributes",icon:e.jsx(j,{})}]}]})]}),e.jsx(x,{title:t("fields.height"),value:s.height}),e.jsx(x,{title:t("fields.width"),value:s.width}),e.jsx(x,{title:t("fields.length"),value:s.length}),e.jsx(x,{title:t("fields.weight"),value:s.weight}),e.jsx(x,{title:t("fields.midCode"),value:s.mid_code}),e.jsx(x,{title:t("fields.hsCode"),value:s.hs_code}),e.jsx(x,{title:t("fields.countryOfOrigin"),value:ee(s.origin_country)}),a("product","attributes").map((n,i)=>e.jsx(n,{data:s},i))]})},ze=s=>{switch(s){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},Ae=({product:s})=>{const{t}=v(),a=B(),n=M(),{getDisplays:i}=L(),r=i("product","general"),{mutateAsync:o}=ce(s.id),m=async()=>{await a({title:t("general.areYouSure"),description:t("products.deleteWarning",{title:s.title}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await o(void 0,{onSuccess:()=>{n("..")},onError:f=>{fe.error(t("products.toasts.delete.error.header"),{description:f.message})}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{children:s.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(Ne,{color:ze(s.status),children:t(`products.productStatus.${s.status}`)}),e.jsx(w,{groups:[{actions:[{label:t("actions.edit"),to:"edit",icon:e.jsx(j,{})}]},{actions:[{label:t("actions.delete"),onClick:m,icon:e.jsx(H,{})}]}]})]})]}),e.jsx(x,{title:t("fields.description"),value:s.description}),e.jsx(x,{title:t("fields.subtitle"),value:s.subtitle}),e.jsx(x,{title:t("fields.handle"),value:`/${s.handle}`}),e.jsx(x,{title:t("fields.material"),value:s.material}),e.jsx(x,{title:t("fields.discountable"),value:s.discountable?t("fields.true"):t("fields.false")}),r.map((g,f)=>e.jsx(g,{data:s},f))]})},Oe=({product:s})=>{const{t}=v(),a=B(),n=M(),[i,r]=b.useState({}),o=$e(s),m=u=>{r(l=>{if(l[u]){const{[u]:c,...d}=l;return d}else return{...l,[u]:!0}})},{mutateAsync:g}=de(s.id),f=async()=>{const u=Object.keys(i),l=u.some(p=>{var h;return(h=o.find(C=>C.id===p))==null?void 0:h.isThumbnail});if(!await a({title:t("general.areYouSure"),description:l?t("products.media.deleteWarningWithThumbnail",{count:u.length}):t("products.media.deleteWarning",{count:u.length}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")}))return;const d=s.images.filter(p=>!u.includes(p.id)).map(p=>({id:p.id,url:p.url}));await g({images:d,thumbnail:l?"":void 0},{onSuccess:()=>{r({})}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.media.label")}),e.jsx(w,{groups:[{actions:[{label:t("actions.editImages"),to:"media?view=edit",icon:e.jsx(j,{})}]}]})]}),o.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:o.map((u,l)=>{const c=i[u.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:U("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":c}),children:e.jsx(ke,{checked:i[u.id]||!1,onCheckedChange:()=>m(u.id)})}),u.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(z,{content:t("fields.thumbnail"),children:e.jsx(we,{})})}),e.jsx(q,{to:"media",state:{curr:l},children:e.jsx("img",{src:u.url,alt:`${s.title} image`,className:"size-full object-cover"})})]},u.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(P,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("products.media.emptyState.header")}),e.jsx(P,{size:"small",className:"text-ui-fg-muted",children:t("products.media.emptyState.description")})]}),e.jsx(ue,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(q,{to:"media?view=edit",children:t("products.media.emptyState.action")})})]}),e.jsx(k,{open:!!Object.keys(i).length,children:e.jsxs(k.Bar,{children:[e.jsx(k.Value,{children:t("general.countSelected",{count:Object.keys(i).length})}),e.jsx(k.Seperator,{}),e.jsx(k.Command,{action:f,label:t("actions.delete"),shortcut:"d"}),Object.keys(i).length===1&&e.jsx(k.Command,{action:()=>{n(`images/${Object.keys(i)[0]}/variants`),r({})},label:t("products.media.manageImageVariants"),shortcut:"m"})]})})]})},$e=s=>{const{images:t=[],thumbnail:a}=s,n=t.map(i=>({id:i.id,url:i.url,isThumbnail:i.url===a}));return a&&!n.some(i=>i.url===a)&&n.unshift({id:"img_thumbnail",url:a,isThumbnail:!0}),n},Le=({product:s,option:t})=>{const{t:a}=v(),{mutateAsync:n}=ve(s.id,t.id),i=B(),r=async()=>{await i({title:a("general.areYouSure"),description:a("products.options.deleteWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await n()};return e.jsx(w,{groups:[{actions:[{label:a("actions.edit"),to:`options/${t.id}/edit`,icon:e.jsx(j,{})}]},{actions:[{label:a("actions.delete"),onClick:r,icon:e.jsx(H,{})}]}]})},Me=({product:s})=>{var a;const{t}=v();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.options.header")}),e.jsx(w,{groups:[{actions:[{label:t("actions.create"),to:"options/create",icon:e.jsx(me,{})}]}]})]}),(a=s.options)==null?void 0:a.map(n=>{var i;return e.jsx(x,{title:n.title,value:(i=n.values)==null?void 0:i.map(r=>e.jsx(R,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:r.value},r.value)),actions:e.jsx(Le,{product:s,option:n})},n.id)})]})},Be=({product:s})=>{var n,i;const{t}=v(),{getDisplays:a}=L();return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.organization.header")}),e.jsx(w,{groups:[{actions:[{label:t("actions.edit"),to:"organization",icon:e.jsx(j,{})}]}]})]}),e.jsx(x,{title:t("fields.tags"),value:(n=s.tags)!=null&&n.length?s.tags.map(r=>e.jsx(O,{label:r.value,to:`/settings/product-tags/${r.id}`},r.id)):void 0}),e.jsx(x,{title:t("fields.type"),value:s.type?e.jsx(O,{label:s.type.value,to:`/settings/product-types/${s.type_id}`}):void 0}),e.jsx(x,{title:t("fields.collection"),value:s.collection?e.jsx(O,{label:s.collection.title,to:`/collections/${s.collection.id}`}):void 0}),e.jsx(x,{title:t("fields.categories"),value:(i=s.categories)!=null&&i.length?s.categories.map(r=>e.jsx(O,{label:r.name,to:`/categories/${r.id}`},r.id)):void 0}),a("product","organize").map((r,o)=>e.jsx(r,{data:s},o))]})},O=({label:s,to:t})=>e.jsx(z,{content:s,children:e.jsx(R,{size:"2xsmall",className:"block w-fit truncate",asChild:!0,children:e.jsx(q,{to:t,children:s})})}),Ee=({product:s})=>{var o;const{count:t}=xe(),{t:a}=v(),n=((o=s.sales_channels)==null?void 0:o.map(m=>({id:m.id,name:m.name})))??[],i=n.slice(0,3),r=n.slice(3);return e.jsxs(S,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{level:"h2",children:a("fields.sales_channels")}),e.jsx(w,{groups:[{actions:[{label:a("actions.edit"),to:"sales-channels",icon:e.jsx(j,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(Ce,{className:"text-ui-fg-subtle"})})}),n.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(P,{size:"small",leading:"compact",children:i.map(m=>m.name).join(", ")}),r.length>0&&e.jsx(z,{content:e.jsx("ul",{children:r.map(m=>e.jsx("li",{children:m.name},m.id))}),children:e.jsx(P,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${r.length}`})})]}):e.jsx(P,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:a("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(P,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(he,{i18nKey:"sales_channels.availableIn",values:{x:n.length,y:t??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},V=10,K="pv",qe=({product:s})=>{const{t}=v(),{q:a,order:n,offset:i,allow_backorder:r,manage_inventory:o}=Se(["q","order","offset","manage_inventory","allow_backorder"],K),m=Ke(s),g=Re(),f=Fe(),{variants:u,count:l,isPending:c,isError:d,error:p}=pe(s.id,{q:a,order:n||"variant_rank",offset:i?parseInt(i):void 0,limit:V,allow_backorder:r?JSON.parse(r):void 0,manage_inventory:o?JSON.parse(o):void 0,fields:"title,sku,thumbnail,*options,created_at,*inventory_items.inventory.location_levels,inventory_quantity,manage_inventory"},{placeholderData:be});if(d)throw p;return e.jsx(S,{className:"divide-y p-0",children:e.jsx(se,{data:u,columns:m,filters:g,rowCount:l,getRowId:h=>h.id,rowHref:h=>`/products/${s.id}/variants/${h.id}`,pageSize:V,isLoading:c,heading:t("products.variants.header"),headingLevel:"h2",emptyState:{empty:{heading:t("products.variants.empty.heading"),description:t("products.variants.empty.description")},filtered:{heading:t("products.variants.filtered.heading"),description:t("products.variants.filtered.description")}},action:{label:t("actions.create"),to:"variants/create"},actionMenu:{groups:[{actions:[{label:t("products.editPrices"),to:"prices",icon:e.jsx(j,{})},{label:t("inventory.stock.action"),to:"stock",icon:e.jsx(J,{})}]}]},commands:f,prefix:K})})},_=_e(),Ke=s=>{const{t}=v(),a=M(),{mutateAsync:n}=ge(s.id),i=B(),[r]=je(),o=b.useMemo(()=>{const l=new URLSearchParams;for(const[c,d]of r.entries())c.startsWith(`${K}_`)&&l.append(c,d);return l},[r]),m=b.useCallback(async(l,c)=>{await i({title:t("general.areYouSure"),description:t("products.deleteVariantWarning",{title:c}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n({variantId:l})},[n,i,t]),g=b.useMemo(()=>s!=null&&s.options?s.options.map(l=>_.display({id:l.id,header:l.title,cell:({row:c})=>{var p;const d=(p=c.original.options)==null?void 0:p.find(h=>h.option_id===l.id);return d?e.jsx("div",{className:"flex items-center",children:e.jsx(z,{content:d.value,children:e.jsx(R,{size:"2xsmall",title:d.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:d.value})})}):e.jsx("span",{className:"text-ui-fg-muted",children:"-"})}})):[],[s]),f=b.useCallback(l=>{var C,T;const c=l.row.original,d=[{icon:e.jsx(j,{}),label:t("actions.edit"),onClick:y=>{a(`edit-variant?variant_id=${y.row.original.id}&${o.toString()}`,{state:{restore_params:o.toString()}})}}],p=[{icon:e.jsx(H,{}),label:t("actions.delete"),onClick:()=>m(c.id,c.title)}];switch(((C=c.inventory_items)==null?void 0:C.length)||0){case 0:break;case 1:{const y=`/inventory/${c.inventory_items[0].inventory.id}`;d.push({label:t("products.variant.inventory.actions.inventoryItems"),onClick:()=>{a(y)},icon:e.jsx(J,{})});break}default:{const y=(T=c.inventory_items)==null?void 0:T.map(D=>{var I;return(I=D.inventory)==null?void 0:I.id});if(!y||y.length===0)break;const A=`/inventory?${new URLSearchParams({id:y.join(",")}).toString()}`;d.push({label:t("products.variant.inventory.actions.inventoryKit"),onClick:()=>{a(A)},icon:e.jsx(F,{})})}}return[d,p]},[m,a,t,o]),u=b.useCallback(l=>{var A;const c=l;if(!l.manage_inventory)return{text:t("products.variant.inventory.notManaged"),hasInventoryKit:!1,notManaged:!0};const d=l.inventory_quantity,p=(A=c.inventory_items)==null?void 0:A.map(D=>D.inventory).filter(Boolean),h=p.length>1,C={};p.forEach(D=>{var I;(I=D.location_levels)==null||I.forEach(Q=>{C[Q.id]=!0})});const T=Object.keys(C).length;return{text:h?t("products.variant.tableItemAvailable",{availableCount:d}):t("products.variant.tableItem",{availableCount:d,locationCount:T,count:T}),hasInventoryKit:h,quantity:d,notManaged:!1}},[t]);return b.useMemo(()=>[_.accessor("thumbnail",{header:"",headerAlign:"center",maxSize:72,cell:({row:l})=>e.jsx("div",{className:"flex items-center pl-[1px]",children:e.jsx(ye,{src:l.original.thumbnail})})}),_.accessor("title",{header:t("fields.title"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),_.accessor("sku",{header:t("fields.sku"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),...g,_.display({id:"inventory",header:t("fields.inventory"),cell:({row:l})=>{const{text:c,hasInventoryKit:d,quantity:p,notManaged:h}=u(l.original);return e.jsx(z,{content:c,children:e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[d&&e.jsx(F,{}),e.jsx("span",{className:U("truncate",{"text-ui-fg-error":!p&&!h}),children:c})]})})},maxSize:250}),_.action({actions:f})],[t,g,f,u])},W=Pe(),Re=()=>{const{t:s}=v(),t=te();return b.useMemo(()=>[W.accessor("allow_backorder",{type:"radio",label:s("fields.allowBackorder"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),W.accessor("manage_inventory",{type:"radio",label:s("fields.manageInventory"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),...t],[s,t])},He=Te(),Fe=()=>{const{t:s}=v(),t=M();return[He.command({label:s("inventory.stock.action"),shortcut:"i",action:async a=>{t(`stock?${G}=${Object.keys(a).join(",")}`)}})]},Ve=({product:s})=>{const{t}=v(),a=s.shipping_profile;return e.jsxs(S,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(N,{level:"h2",children:t("products.shippingProfile.header")}),e.jsx(w,{groups:[{actions:[{label:t("actions.edit"),to:"shipping-profile",icon:e.jsx(j,{})}]}]})]}),a&&e.jsx(X,{to:`/settings/locations/shipping-profiles/${a.id}`,labelKey:a.name,descriptionKey:a.type,icon:e.jsx(Z,{})})]})},Ot=()=>{const s=ae(),{id:t}=ie(),{product:a,isLoading:n,isError:i,error:r}=Y(t,{fields:$},{initialData:s}),{getWidgets:o}=L(),m=o("product.details.after"),g=o("product.details.before"),f=o("product.details.side.after"),u=o("product.details.side.before");if(n||!a)return e.jsx(ne,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(i)throw r;return e.jsxs(E,{widgets:{after:m,before:g,sideAfter:f,sideBefore:u},showJSON:!0,showMetadata:!0,data:a,children:[e.jsxs(E.Main,{children:[e.jsx(Ae,{product:a}),e.jsx(Oe,{product:a}),e.jsx(Me,{product:a}),e.jsx(qe,{product:a})]}),e.jsxs(E.Sidebar,{children:[e.jsx(Ee,{product:a}),e.jsx(Ve,{product:a}),e.jsx(Be,{product:a}),e.jsx(Ie,{product:a})]})]})};export{zt as Breadcrumb,Ot as Component,At as loader};
