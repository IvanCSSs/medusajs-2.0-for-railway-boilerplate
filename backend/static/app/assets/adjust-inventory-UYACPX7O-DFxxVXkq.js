import{c as f}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{a as I,u as k,bA as L,bC as w,j as e,H as F,o as N,dy as S,n as A,s as C,cY as _,c as T,e as E,E as R,dH as z,t as g,F as c,I as H,B as q,q as b}from"./index-S35l5lon.js";import{K as Q}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as r,u as B}from"./chunk-AERWK3TJ-Gph8MRZF.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var l=({title:n,value:s})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(b,{className:"px-2 py-1.5",size:"small",leading:"compact",children:n}),e.jsx(b,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s})]}),P=({item:n,level:s,location:m})=>{const{t}=k(),{handleSuccess:x}=B(),v=N({stocked_quantity:S([A(),C()])}).superRefine((o,i)=>{const y=o.stocked_quantity?f(o.stocked_quantity):null;if(y===null){i.addIssue({code:_.invalid_type,expected:"number",received:"undefined",path:["stocked_quantity"]});return}y<s.reserved_quantity&&i.addIssue({code:_.custom,message:t("inventory.adjustInventory.errors.stockedQuantity",{quantity:s.reserved_quantity}),path:["stocked_quantity"]})}),a=T({defaultValues:{stocked_quantity:s.stocked_quantity},resolver:E(v)}),d=R({control:a.control,name:"stocked_quantity"}),u=d?f(d)-s.reserved_quantity:0-s.reserved_quantity,{mutateAsync:j,isPending:p}=z(n.id,s.location_id),h=a.handleSubmit(async o=>{await j({stocked_quantity:f(o.stocked_quantity)},{onSuccess:()=>{g.success(t("inventory.toast.updateLevel")),x()},onError:i=>{g.error(i.message)}})});return e.jsx(r.Form,{form:a,children:e.jsxs(Q,{onSubmit:h,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(r.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(l,{title:t("fields.title"),value:n.title??"-"}),e.jsx(l,{title:t("fields.sku"),value:n.sku}),e.jsx(l,{title:t("locations.domain"),value:m.name}),e.jsx(l,{title:t("inventory.reserved"),value:s.reserved_quantity}),e.jsx(l,{title:t("inventory.available"),value:u})]}),e.jsx(c.Field,{control:a.control,name:"stocked_quantity",render:({field:{onChange:o,value:i,...y}})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{children:t("fields.inStock")}),e.jsx(c.Control,{children:e.jsx(H,{type:"number",value:i,onChange:o,...y})}),e.jsx(c.ErrorMessage,{})]})})]}),e.jsx(r.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(r.Close,{asChild:!0,children:e.jsx(q,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(q,{type:"submit",size:"small",isLoading:p,children:t("actions.save")})]})})]})})},W=()=>{const{id:n,location_id:s}=I(),{t:m}=k(),{inventory_item:t,isPending:x,isError:v,error:a}=L(n),d=t==null?void 0:t.location_levels.find(h=>h.location_id===s),{stock_location:u,isLoading:j}=w(s),p=!x&&t&&d&&!j&&u;if(v)throw a;return e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx(F,{children:m("inventory.manageLocationQuantity")})}),p&&e.jsx(P,{item:t,level:d,location:u})]})};export{W as Component};
