import{D as V}from"./chunk-KEQOAJC2-7WPNwWw4.js";import{S as w}from"./chunk-PRLQLEEQ-CKYDE1LK.js";import{a as D,u as N,eB as P,j as e,H as M,c as z,e as R,E as v,ey as k,r as A,z as K,F as t,I as F,q as B,ak as E,B as S,o as U,n as I,J as h,bk as H,s as y}from"./index-S35l5lon.js";import{c as W,g as G}from"./chunk-DK4WIVY6-CYCbBMOO.js";import{K as J}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as n,u as $}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{R as r}from"./radio-group-DTwFvrbm.js";import{C as O}from"./currency-input-Chfr_R7S.js";import"./index.esm-BQ-YgayW.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./index-haGLTuDn.js";var Q=U({is_automatic:y().toLowerCase(),code:y().min(1),is_tax_inclusive:H().optional(),status:h(["active","inactive","draft"]),value_type:h(["fixed","percentage"]),value:I().min(0).or(y().min(1)),allocation:h(["each","across","once"]),target_type:h(["order","shipping_methods","items"]),max_quantity:I().min(1).optional().nullable()}),X=({promotion:i})=>{var g;const{t:o}=N(),{handleSuccess:m}=$(),s=z({defaultValues:{is_automatic:i.is_automatic.toString(),is_tax_inclusive:i.is_tax_inclusive,code:i.code,status:i.status,value:i.application_method.value,allocation:i.application_method.allocation,value_type:i.application_method.type,target_type:i.application_method.target_type,max_quantity:i.application_method.max_quantity},resolver:R(Q)}),j=v({control:s.control,name:"value_type"}),d=v({control:s.control,name:"allocation"}),_=j==="fixed",u=i.application_method.allocation,{mutateAsync:L,isPending:T}=k(i.id),q=s.handleSubmit(async a=>{const l=parseFloat(a.value);if(isNaN(l)||l<0){s.setError("value",{message:o("promotions.form.value.invalid")});return}await L({is_automatic:a.is_automatic==="true",code:a.code,status:a.status,is_tax_inclusive:a.is_tax_inclusive,application_method:{value:parseFloat(a.value),type:a.value_type,allocation:a.allocation,max_quantity:a.max_quantity}},{onSuccess:()=>{m()}})}),f=v({control:s.control,name:"value_type"});A.useEffect(()=>{f==="fixed"&&i.type==="standard"||s.setValue("is_tax_inclusive",!1)},[f,s,i]);const p=K();return e.jsx(n.Form,{form:s,children:e.jsxs(J,{onSubmit:q,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(n.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(t.Field,{control:s.control,name:"status",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.status.label")}),e.jsx(t.Control,{children:e.jsxs(r,{dir:p,className:"flex-col gap-y-3",...a,value:a.value,onValueChange:a.onChange,children:[e.jsx(r.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description")}),e.jsx(r.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description")}),e.jsx(r.ChoiceBox,{value:"inactive",label:o("promotions.form.status.inactive.title"),description:o("promotions.form.status.inactive.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:s.control,name:"is_automatic",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.method.label")}),e.jsx(t.Control,{children:e.jsxs(r,{dir:p,className:"flex-col gap-y-3",...a,value:a.value,onValueChange:a.onChange,children:[e.jsx(r.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description")}),e.jsx(r.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),f==="fixed"&&i.type==="standard"&&e.jsx(w,{control:s.control,name:"is_tax_inclusive",label:o("promotions.form.taxInclusive.title"),description:o("promotions.form.taxInclusive.description")}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(t.Field,{control:s.control,name:"code",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.code.title")}),e.jsx(t.Control,{children:e.jsx(F,{...a})})]})}),e.jsx(B,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(E,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]}),((g=i.application_method)==null?void 0:g.target_type)!=="shipping_methods"&&e.jsxs(e.Fragment,{children:[e.jsx(t.Field,{control:s.control,name:"value_type",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.fields.value_type")}),e.jsx(t.Control,{children:e.jsxs(r,{dir:p,className:"flex-col gap-y-3",...a,onValueChange:a.onChange,children:[e.jsx(r.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description")}),e.jsx(r.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description")})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:s.control,name:"value",render:({field:{onChange:a,...l}})=>{var C;const c=((C=i.application_method)==null?void 0:C.currency_code)??"USD",b=W[(c==null?void 0:c.toUpperCase())||"USD"];return e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o(_?"fields.amount":"fields.percentage")}),e.jsx(t.Control,{children:_?e.jsx(O,{min:0,onValueChange:x=>a(x),decimalSeparator:".",groupSeparator:",",decimalScale:b.decimal_digits,decimalsLimit:b.decimal_digits,code:c,symbol:G(c),...l,value:l.value}):e.jsx(V,{min:0,max:100,...l,value:l.value||"",onChange:x=>{a(x.target.value===""?null:parseFloat(x.target.value))}},"amount")}),e.jsx(t.ErrorMessage,{})]})}}),e.jsx(t.Field,{control:s.control,name:"allocation",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{tooltip:o("promotions.fields.allocationTooltip"),children:o("promotions.fields.allocation")}),e.jsx(t.Control,{children:e.jsxs(r,{dir:p,className:"flex-col gap-y-3",...a,onValueChange:a.onChange,children:[e.jsx(r.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description"),disabled:u==="across"}),e.jsx(r.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description"),disabled:u==="each"||u==="once"}),e.jsx(r.ChoiceBox,{value:"once",label:o("promotions.form.allocation.once.title"),description:o("promotions.form.allocation.once.description"),disabled:u==="across"})]})}),e.jsx(t.ErrorMessage,{})]})}),(d==="each"||d==="once")&&e.jsx(t.Field,{control:s.control,name:"max_quantity",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("promotions.form.max_quantity.title")}),e.jsx(t.Control,{children:e.jsx(F,{...s.register("max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(B,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(E,{t:o,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})}),e.jsx(t.ErrorMessage,{})]})})]})]})}),e.jsx(n.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(n.Close,{asChild:!0,children:e.jsx(S,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(S,{size:"small",type:"submit",isLoading:T,children:o("actions.save")})]})})]})})},me=()=>{const{id:i}=D(),{t:o}=N(),{promotion:m,isLoading:s,isError:j,error:d}=P(i);if(j)throw d;return e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsx(M,{children:o("promotions.edit.title")})}),!s&&m&&e.jsx(X,{promotion:m})]})};export{me as Component};
