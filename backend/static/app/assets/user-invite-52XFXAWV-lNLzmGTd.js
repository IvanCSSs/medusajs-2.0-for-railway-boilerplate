import{u as A}from"./chunk-C76H5USB-C4gmMgZH.js";import{r as n,j as r,u as w,c as C,dm as D,H as I,q as F,c_ as L,F as p,I as R,B as U,C as H,T as h,ak as z,e as q,A as B,o as $,s as K}from"./index-S35l5lon.js";import{a as V,b as J,c as Q,d as W}from"./chunk-CN7JXSGW-DPZz1cGH.js";import{u as G,_ as X}from"./chunk-ULVVVKLF-DQ5i1kAh.js";import"./chunk-GU5PJRPM-CRBxyP7n.js";import{K as Y}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as f}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{c as Z}from"./index-BZWkVw9-.js";import{u as ee}from"./use-prompt-D56I0Z60.js";import{A as re}from"./arrow-path-BQjzsCv0.js";import{T as te}from"./trash-VeZKzNu3.js";import{c as ae}from"./index-D8hIMFbh.js";import{S as y}from"./status-badge-CXGqPLdn.js";import{f as u}from"./format-BsAuNKh5.js";import"./chunk-HQKGZADC-CFjwmGLF.js";import"./table-u7knMi01.js";import"./chunk-EMIHDNB7-1UnYIHIF.js";import"./plus-mini-B5zW_eay.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./index-haGLTuDn.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var se=Object.defineProperty,x=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,P=(e,t,a)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,ie=(e,t)=>{for(var a in t||(t={}))S.call(t,a)&&P(e,a,t[a]);if(x)for(var a of x(t))M.call(t,a)&&P(e,a,t[a]);return e},ne=(e,t)=>{var a={};for(var s in e)S.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(e!=null&&x)for(var s of x(e))t.indexOf(s)<0&&M.call(e,s)&&(a[s]=e[s]);return a};const N=n.forwardRef((e,t)=>{var a=e,{color:s="currentColor"}=a,i=ne(a,["color"]);return n.createElement("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},i),n.createElement("g",{stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},n.createElement("path",{d:"m6.44 3.965 1.59-1.591a3.25 3.25 0 1 1 4.597 4.596l-1.591 1.59M3.964 6.44l-1.59 1.59a3.25 3.25 0 1 0 4.596 4.597l1.59-1.591M5.909 9.09 9.091 5.91"})),n.createElement("defs",null,n.createElement("clipPath",{id:"a"},n.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});N.displayName="Link";var oe=({prefix:e,pageSize:t=20})=>{const a=A(["offset","q","order","created_at","updated_at"],e),{offset:s,created_at:i,updated_at:o,q:l,order:c}=a;return{searchParams:{limit:t,offset:s?Number(s):0,order:c,created_at:i?JSON.parse(i):void 0,updated_at:o?JSON.parse(o):void 0,q:l},raw:a}},le=$({email:K().email()}),j=10,g="usr_invite",ce=`${window.location.origin}/app//invite?token=`,de=()=>{const{t:e}=w(),t=C({defaultValues:{email:""},resolver:q(le)}),{raw:a,searchParams:s}=oe({prefix:g,pageSize:j}),{invites:i,count:o,isPending:l,isError:c,error:d}=V(s),b=pe(),{table:E}=G({data:i??[],columns:b,count:o,enablePagination:!0,getRowId:m=>m.id,pageSize:j,prefix:g}),{mutateAsync:k,isPending:O}=J(),T=t.handleSubmit(async m=>{try{await k({email:m.email}),t.reset()}catch(v){if(D(v)&&v.status===400){t.setError("root",{type:"manual",message:v.message});return}}});if(c)throw d;return r.jsx(f.Form,{form:t,children:r.jsxs(Y,{onSubmit:T,className:"flex h-full flex-col overflow-hidden",children:[r.jsx(f.Header,{}),r.jsx(f.Body,{className:"flex flex-1 flex-col overflow-hidden",children:r.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:r.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[r.jsxs("div",{children:[r.jsx(I,{children:e("users.inviteUser")}),r.jsx(F,{size:"small",className:"text-ui-fg-subtle",children:e("users.inviteUserHint")})]}),t.formState.errors.root&&r.jsx(L,{variant:"error",dismissible:!1,className:"text-balance",children:t.formState.errors.root.message}),r.jsxs("div",{className:"flex flex-col gap-y-4",children:[r.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.jsx(p.Field,{control:t.control,name:"email",render:({field:m})=>r.jsxs(p.Item,{children:[r.jsx(p.Label,{children:e("fields.email")}),r.jsx(p.Control,{children:r.jsx(R,{...m})}),r.jsx(p.ErrorMessage,{})]})})}),r.jsx("div",{className:"flex items-center justify-end",children:r.jsx(U,{size:"small",variant:"secondary",type:"submit",isLoading:O,children:e("users.sendInvite")})})]}),r.jsxs("div",{className:"flex flex-col gap-y-4",children:[r.jsx(I,{level:"h2",children:e("users.pendingInvites")}),r.jsx(H,{className:"overflow-hidden p-0",children:r.jsx(X,{table:E,columns:b,count:o,pageSize:j,pagination:!0,search:"autofocus",isLoading:l,queryObject:a,prefix:g,orderBy:[{key:"email",label:e("fields.email")},{key:"created_at",label:e("fields.createdAt")},{key:"updated_at",label:e("fields.updatedAt")}]})})]})]})})})]})})},me=({invite:e})=>{const{mutateAsync:t}=Q(e.id),{mutateAsync:a}=W(e.id),s=ee(),{t:i}=w(),o=async()=>{await s({title:i("general.areYouSure"),description:i("users.deleteInviteWarning",{email:e.email}),cancelText:i("actions.cancel"),confirmText:i("actions.delete")})&&await t()},l=async()=>{await a()},c=()=>{const d=`${ce}${e.token}`;Z(d)};return r.jsx(B,{groups:[{actions:[{icon:r.jsx(re,{}),label:i("users.resendInvite"),onClick:l}]},{actions:[{icon:r.jsx(N,{}),label:i("users.copyInviteLink"),onClick:c}]},{actions:[{icon:r.jsx(te,{}),label:i("actions.delete"),onClick:o}]}]})},_=ae(),pe=()=>{const{t:e}=w();return n.useMemo(()=>[_.accessor("email",{header:e("fields.email"),cell:({getValue:t})=>t()}),_.accessor("accepted",{header:e("fields.status"),cell:({getValue:t,row:a})=>{const s=t(),i=new Date(a.original.expires_at)<new Date;return s?r.jsx(h,{content:e("users.acceptedOnDate",{date:u(new Date(a.original.updated_at),"dd MMM, yyyy")}),children:r.jsx(y,{color:"green",children:e("users.inviteStatus.accepted")})}):i?r.jsx(h,{content:e("users.expiredOnDate",{date:u(new Date(a.original.expires_at),"dd MMM, yyyy")}),children:r.jsx(y,{color:"red",children:e("users.inviteStatus.expired")})}):r.jsx(h,{content:r.jsx(z,{i18nKey:"users.validFromUntil",components:[r.jsx("span",{className:"font-medium"},"from"),r.jsx("span",{className:"font-medium"},"untill")],values:{from:u(new Date(a.original.created_at),"dd MMM, yyyy"),until:u(new Date(a.original.expires_at),"dd MMM, yyyy")}}),children:r.jsx(y,{color:"orange",children:e("users.inviteStatus.pending")})})}}),_.display({id:"actions",cell:({row:t})=>r.jsx(me,{invite:t.original})})],[e])},ze=()=>r.jsx(f,{children:r.jsx(de,{})});export{ze as Component};
