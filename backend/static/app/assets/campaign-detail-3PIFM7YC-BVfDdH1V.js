import{D as U}from"./chunk-NL376WAO-DGir6Cyw.js";import{a as $,u as K,b as Q}from"./chunk-LSEYENCI-wt8LlUNJ.js";import"./chunk-SC6BSTC7-C1YGBU_J.js";import{r as l,fg as h,P as F,a as J,b as D,m as V,j as t,R as W,O as X,fh as Z,M as Y,u,X as ee,eG as te,C as m,H as p,A as j,q as c,G as se,h as re,g as k,L as ie,B as ae,er as oe,ak as E,t as N}from"./index-S35l5lon.js";import{T as v}from"./chunk-GIZFNLKK-DRFYVOmD.js";import{u as ne,_ as le}from"./chunk-ULVVVKLF-DQ5i1kAh.js";import"./chunk-GU5PJRPM-CRBxyP7n.js";import{c as ce}from"./chunk-DK4WIVY6-CYCbBMOO.js";import{u as _}from"./use-prompt-D56I0Z60.js";import{S as de}from"./status-badge-CXGqPLdn.js";import{P as y}from"./pencil-square-Y_YO1xMN.js";import{T as z}from"./trash-VeZKzNu3.js";import{c as ue}from"./index-D8hIMFbh.js";import{C as P}from"./checkbox-Bm9_gGRM.js";import"./chunk-DZWH2RV6-B7cI8-p8.js";import"./sub-Ca2BFeSf.js";import"./format-BsAuNKh5.js";import"./chunk-ADOCJB6L-3RvuFqSE.js";import"./chunk-MSDRGCRR-CygM1UmD.js";import"./chunk-P3UUX2T6-CDvcsuG9.js";import"./chunk-C76H5USB-C4gmMgZH.js";import"./index-DRUHz9yq.js";import"./check-B9bFzKnZ.js";import"./chunk-HQKGZADC-CFjwmGLF.js";import"./table-u7knMi01.js";import"./chunk-EMIHDNB7-1UnYIHIF.js";import"./plus-mini-B5zW_eay.js";import"./command-bar-D5PjKtE8.js";import"./index-BqPH3RWs.js";import"./index-haGLTuDn.js";import"./date-picker-CzxuXAvc.js";import"./popover-9ZHd-JXE.js";import"./triangle-left-mini-CmFFwE40.js";import"./prompt-YaiseBxh.js";var me=Object.defineProperty,b=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,T=(e,s,r)=>s in e?me(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,pe=(e,s)=>{for(var r in s||(s={}))O.call(s,r)&&T(e,r,s[r]);if(b)for(var r of b(s))R.call(s,r)&&T(e,r,s[r]);return e},xe=(e,s)=>{var r={};for(var i in e)O.call(e,i)&&s.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&b)for(var i of b(e))s.indexOf(i)<0&&R.call(e,i)&&(r[i]=e[i]);return r};const B=l.forwardRef((e,s)=>{var r=e,{color:i="currentColor"}=r,o=xe(r,["color"]);return l.createElement("svg",pe({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},o),l.createElement("g",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},l.createElement("path",{d:"M13.368 10.167a6.446 6.446 0 1 1-8.535-8.535"}),l.createElement("path",{d:"M13.944 7.5A6.444 6.444 0 0 0 7.5 1.056V7.5z"})),l.createElement("defs",null,l.createElement("clipPath",{id:"a"},l.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});B.displayName="ChartPie";function fe(e,s){const r=h(e),i=h(s);return r.getTime()>i.getTime()}function ge(e,s){const r=h(e),i=h(s);return+r<+i}var C="+promotions.id",lt=e=>{const{id:s}=e.params||{},{campaign:r}=D(s,{fields:C},{initialData:e.data,enabled:!!s});return r?t.jsx("span",{children:r.name}):null},he=({campaign:e})=>{var i,o,n;const{t:s}=u(),r=()=>{const a=e.budget;return(a==null?void 0:a.type)==="use_by_attribute"?(a==null?void 0:a.attribute)==="customer_id"?s("campaigns.budget.fields.totalUsedByAttributeCustomerId"):(a==null?void 0:a.attribute)==="customer_email"?s("campaigns.budget.fields.totalUsedByAttributeEmail"):s("campaigns.budget.fields.totalUsedByAttribute",{attribute:a==null?void 0:a.attribute}):s("campaigns.fields.budget_limit")};return t.jsxs(m,{className:"flex flex-col gap-y-4 px-6 py-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("div",{className:"mb-2 grid flex-grow grid-cols-[28px_1fr] items-center gap-x-3",children:[t.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:t.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:t.jsx(B,{className:"text-ui-fg-subtle"})})}),t.jsx(p,{level:"h2",children:r()})]}),t.jsx(j,{groups:[{actions:[{icon:t.jsx(y,{}),label:s("actions.edit"),to:"edit-budget"}]}]})]}),t.jsx("div",{children:t.jsx(c,{className:"text-ui-fg-subtle border-ui-border-strong border-l-4 ps-3",size:"small",leading:"compact",children:t.jsx(E,{i18nKey:"campaigns.totalSpend",values:{amount:((i=e==null?void 0:e.budget)==null?void 0:i.limit)||"no limit",currency:((o=e==null?void 0:e.budget)==null?void 0:o.type)==="spend"&&(e!=null&&e.budget.limit)?(n=e.budget)==null?void 0:n.currency_code:""},components:[t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"amount"),t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"currency")]})})})]})};function be(e){return e.ends_at&&ge(new Date(e.ends_at),new Date)?"expired":e.starts_at&&fe(new Date(e.starts_at),new Date)?"scheduled":"active"}var je=e=>{switch(e){case"expired":return"red";case"scheduled":return"orange";case"active":return"green";default:return"grey"}},ye=({campaign:e})=>{var x,f;const{t:s}=u(),r=_(),i=ee(),{mutateAsync:o}=te(e.id),n=async()=>{await r({title:s("campaigns.delete.title"),description:s("campaigns.delete.description",{name:e.name}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await o(void 0,{onSuccess:()=>{N.success(s("campaigns.delete.successToast",{name:e.name})),i("/campaigns",{replace:!0})},onError:g=>{N.error(g.message)}})},a=be(e);return t.jsxs(m,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(p,{children:e.name}),t.jsxs("div",{className:"flex items-center gap-x-4",children:[t.jsx(de,{color:je(a),children:s(`campaigns.status.${a}`)}),t.jsx(j,{groups:[{actions:[{icon:t.jsx(y,{}),label:s("actions.edit"),to:`/campaigns/${e.id}/edit`}]},{actions:[{icon:t.jsx(z,{}),label:s("actions.delete"),onClick:n}]}]})]})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(c,{size:"small",leading:"compact",weight:"plus",children:s("campaigns.fields.identifier")}),t.jsx(c,{size:"small",leading:"compact",children:e.campaign_identifier})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(c,{size:"small",leading:"compact",weight:"plus",children:s("fields.description")}),t.jsx(c,{size:"small",leading:"compact",children:e.description||"-"})]}),(e==null?void 0:e.budget)&&e.budget.type==="spend"&&t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(c,{size:"small",leading:"compact",weight:"plus",children:s("fields.currency")}),t.jsxs("div",{children:[t.jsx(se,{size:"xsmall",children:e==null?void 0:e.budget.currency_code}),t.jsx(c,{className:"inline pl-3",size:"small",leading:"compact",children:(f=ce[(x=e==null?void 0:e.budget.currency_code)==null?void 0:x.toUpperCase()])==null?void 0:f.name})]})]})]})},w=10,ve=({campaign:e})=>{const[s,r]=l.useState({}),{t:i}=u(),o=_(),n=_e(),a=$(),{searchParams:x,raw:f}=K({pageSize:w}),{promotions:S,count:g,isLoading:I,isError:M,error:L}=re({...x,campaign_id:e.id}),{table:q}=ne({data:S??[],columns:n,count:g,getRowId:d=>d.id,enablePagination:!0,enableRowSelection:!0,pageSize:w,rowSelection:{state:s,updater:r},meta:{campaignId:e.id}});if(M)throw L;const{mutateAsync:G}=k(e.id),H=async()=>{const d=Object.keys(s);await o({title:i("campaigns.promotions.remove.title",{count:d.length}),description:i("campaigns.promotions.remove.description",{count:d.length}),confirmText:i("actions.continue"),cancelText:i("actions.cancel")})&&await G({remove:d},{onSuccess:()=>r({})})};return t.jsxs(m,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(p,{level:"h2",children:i("promotions.domain")}),t.jsx(ie,{to:`/campaigns/${e.id}/add-promotions`,children:t.jsx(ae,{variant:"secondary",size:"small",children:i("general.add")})})]}),t.jsx(le,{table:q,columns:n,pageSize:w,isLoading:I,count:g,navigateTo:d=>`/promotions/${d.id}`,filters:a,search:!0,pagination:!0,orderBy:[{key:"code",label:i("fields.code")},{key:"type",label:i("fields.type")},{key:"created_at",label:i("fields.createdAt")},{key:"updated_at",label:i("fields.updatedAt")}],queryObject:f,commands:[{action:H,label:i("actions.remove"),shortcut:"r"}],noRecords:{message:i("campaigns.promotions.list.noRecordsMessage")}})]})},we=({promotion:e,campaignId:s})=>{const{t:r}=u(),{mutateAsync:i}=k(s),o=_(),n=async()=>{await o({title:r("campaigns.promotions.remove.title",{count:1}),description:r("campaigns.promotions.remove.description",{count:1}),confirmText:r("actions.continue"),cancelText:r("actions.cancel")})&&await i({remove:[e.id]})};return t.jsx(j,{groups:[{actions:[{icon:t.jsx(y,{}),label:r("actions.edit"),to:`/promotions/${e.id}/edit`}]},{actions:[{icon:t.jsx(z,{}),label:r("actions.remove"),onClick:n}]}]})},A=ue(),_e=()=>{const e=Q();return l.useMemo(()=>[A.display({id:"select",header:({table:s})=>t.jsx(P,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:r=>s.toggleAllPageRowsSelected(!!r)}),cell:({row:s})=>t.jsx(P,{checked:s.getIsSelected(),onCheckedChange:r=>s.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...e,A.display({id:"actions",cell:({row:s,table:r})=>{const{campaignId:i}=r.options.meta;return t.jsx(we,{promotion:s.original,campaignId:i})}})],[e])},Ce=({campaign:e})=>{var r,i,o,n,a;const{t:s}=u();return t.jsxs(m,{className:"flex flex-col gap-y-4 px-6 py-4",children:[t.jsxs("div",{className:"mb-2 grid grid-cols-[28px_1fr] items-center gap-x-3",children:[t.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:t.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:t.jsx(oe,{className:"text-ui-fg-subtle"})})}),t.jsx(p,{level:"h2",children:((r=e.budget)==null?void 0:r.type)==="use_by_attribute"?s("campaigns.fields.totalUsedByAttribute"):((i=e.budget)==null?void 0:i.type)==="spend"?s("campaigns.fields.total_spend"):s("campaigns.fields.total_used")})]}),t.jsx("div",{children:t.jsx(c,{className:"text-ui-fg-subtle border-ui-border-strong border-l-4 pl-3",size:"small",leading:"compact",children:t.jsx(E,{i18nKey:"campaigns.totalSpend",values:{amount:((o=e==null?void 0:e.budget)==null?void 0:o.used)||0,currency:((n=e==null?void 0:e.budget)==null?void 0:n.type)==="spend"?(a=e==null?void 0:e.budget)==null?void 0:a.currency_code:""},components:[t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"amount"),t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"currency")]})})})]})},Se=({campaign:e})=>{const{t:s}=u();return t.jsxs(m,{className:"flex flex-col gap-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(p,{level:"h2",children:s("campaigns.configuration.header")}),t.jsx(j,{groups:[{actions:[{label:s("actions.edit"),icon:t.jsx(y,{}),to:"configuration"}]}]})]}),t.jsx(U,{startsAt:e.starts_at,endsAt:e.ends_at,showTime:!0})]})},ct=()=>{const e=F(),{id:s}=J(),{campaign:r,isLoading:i,isError:o,error:n}=D(s,{fields:C},{initialData:e}),{getWidgets:a}=V();if(i||!r)return t.jsx(W,{mainSections:2,sidebarSections:3,showJSON:!0,showMetadata:!0});if(o)throw n;return t.jsxs(v,{widgets:{after:a("campaign.details.after"),before:a("campaign.details.before"),sideAfter:a("campaign.details.side.after"),sideBefore:a("campaign.details.side.before")},hasOutlet:!0,showJSON:!0,showMetadata:!0,data:r,children:[t.jsxs(v.Main,{children:[t.jsx(ye,{campaign:r}),t.jsx(ve,{campaign:r})]}),t.jsxs(v.Sidebar,{children:[t.jsx(Se,{campaign:r}),t.jsx(Ce,{campaign:r}),t.jsx(he,{campaign:r})]})]})},Ne=e=>({queryKey:Z.detail(e),queryFn:async()=>X.admin.campaign.retrieve(e,{fields:C})}),dt=async({params:e})=>{const s=e.id,r=Ne(s);return Y.ensureQueryData(r)};export{lt as Breadcrumb,ct as Component,dt as loader};
