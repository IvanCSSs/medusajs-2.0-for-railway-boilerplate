import{o as p}from"./chunk-ZQRKUG6J-TyK87Nny.js";import{S as A}from"./chunk-PRLQLEEQ-CKYDE1LK.js";import{D as v,c as G}from"./chunk-C3TFORYK-CR60shj4.js";import{C as Q}from"./chunk-BW4QA6B6-D7Qkz6P4.js";import{t as V,a as $,b as U}from"./chunk-3ISBJK7K-B3eevHdQ.js";import{bv as J,j as e,u as _,r as c,z as W,c as X,e as Y,dw as Z,t as g,O as ee,M as le,dx as te,v as se,H as N,F as l,I as n,co as re,B as I,o as ie,bT as ae,s as o,bk as ne}from"./index-S35l5lon.js";import{K as oe}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as h,u as k}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{P as u}from"./progress-tabs-DyqPaYnl.js";import{T as ce}from"./textarea-FJbwiCAd.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-DK4WIVY6-CYCbBMOO.js";import"./index.esm-BQ-YgayW.js";import"./index-D8hIMFbh.js";import"./adjustments-D-7QP2vC.js";import"./checkbox-Bm9_gGRM.js";import"./select-CmrtK7XQ.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var de=({form:a,locations:s})=>{const{setCloseOnEscape:x}=k(),i=me();return e.jsx("div",{className:"size-full",children:e.jsx(v,{columns:i,data:s,state:a,onEditingChange:d=>x(!d)})})},F=G(),me=()=>{const{t:a}=_();return c.useMemo(()=>[F.column({id:"location",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a("locations.domain")})}),cell:s=>e.jsx(v.ReadonlyCell,{context:s,children:s.row.original.name}),disableHiding:!0}),F.column({id:"in-stock",name:a("fields.inStock"),header:a("fields.inStock"),field:s=>`locations.${s.row.original.id}`,type:"number",cell:s=>e.jsx(v.NumberCell,{placeholder:"0",context:s}),disableHiding:!0})],[a])},ue=ie({title:o().min(1),description:o().optional(),sku:o().optional(),hs_code:o().optional(),weight:p,length:p,height:p,width:p,origin_country:o().optional(),mid_code:o().optional(),material:o().optional(),requires_shipping:ne().optional(),thumbnail:o().optional(),locations:ae(o(),p).optional()});function he({locations:a}){const{t:s}=_(),{handleSuccess:x}=k(),[i,d]=c.useState("details"),S=W(),r=X({defaultValues:{title:"",sku:"",hs_code:"",weight:"",length:"",height:"",width:"",origin_country:"",mid_code:"",material:"",description:"",requires_shipping:!0,thumbnail:"",locations:Object.fromEntries(a.map(t=>[t.id,""]))},resolver:Y(ue)}),{trigger:j,formState:{isDirty:f}}=r,{mutateAsync:L,isPending:T}=Z(),E=r.handleSubmit(async t=>{const{locations:C,weight:H,length:z,height:M,width:O,...R}=t,B=V(R,!1),K=$({weight:H,length:z,height:M,width:O},!1),{inventory_item:P}=await L({...B,...K},{onError:m=>{g.error(m.message)}});await ee.admin.inventoryItem.batchUpdateLevels(P.id,{create:Object.entries(C??{}).filter(([m,y])=>!!y).map(([m,y])=>({location_id:m,stocked_quantity:U(y,!1)}))}).then(async()=>{await le.invalidateQueries({queryKey:te.lists()})}).catch(m=>{g.error(m.message)}).finally(()=>{x(),g.success(s("inventory.create.successToast"))})}),[w,b]=c.useState({availability:"not-started",details:"not-started"}),D=c.useCallback(async t=>{await j()&&d(t)},[j]),q=c.useCallback(async()=>{if(await j())switch(i){case"details":{d("availability");break}}},[i,j]);return c.useEffect(()=>{b(f?t=>({...t,details:"in-progress"}):t=>({...t,details:"not-started"}))},[f]),c.useEffect(()=>{i==="details"&&f&&b(t=>({...t,details:"in-progress"})),i==="availability"&&b(t=>({...t,details:"completed",availability:"in-progress"}))},[i,f]),e.jsx(h.Form,{form:r,children:e.jsx(u,{dir:S,value:i,className:"h-full",onValueChange:t=>D(t),children:e.jsxs(oe,{className:"flex h-full flex-col overflow-hidden",onSubmit:E,children:[e.jsx(h.Header,{children:e.jsxs(u.List,{className:"border-ui-border-base -my-2 ml-2 min-w-0 flex-1 border-l",children:[e.jsx(u.Trigger,{value:"details",status:w.details,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full cursor-auto overflow-hidden text-ellipsis whitespace-nowrap",children:s("inventory.create.details")})}),e.jsx(u.Trigger,{value:"availability",className:"w-full max-w-[200px]",status:w.availability,children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:s("inventory.create.availability")})})]})}),e.jsxs(h.Body,{className:se("flex h-full w-full flex-col items-center divide-y overflow-hidden",{"mx-auto":i==="details"}),children:[e.jsx(u.Content,{value:"details",className:"h-full w-full overflow-auto px-3",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-[720px] flex-col gap-y-8 px-px py-16",children:[e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(N,{children:s("inventory.create.title")}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsx(l.Field,{control:r.control,name:"title",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{children:s("fields.title")}),e.jsx(l.Control,{children:e.jsx(n,{...t,placeholder:s("fields.title")})}),e.jsx(l.ErrorMessage,{})]})}),e.jsx(l.Field,{control:r.control,name:"sku",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{children:s("fields.sku")}),e.jsx(l.Control,{children:e.jsx(n,{...t,placeholder:"sku-123"})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx(l.Field,{control:r.control,name:"description",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(l.Control,{children:e.jsx(ce,{...t,placeholder:"The item description"})})]})})]}),e.jsx(A,{control:r.control,name:"requires_shipping",label:s("inventory.create.requiresShipping"),description:s("inventory.create.requiresShippingHint")})]}),e.jsx(re,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(N,{level:"h2",children:s("inventory.create.attributes")}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4 lg:grid-cols-2 lg:gap-y-8",children:[e.jsx(l.Field,{control:r.control,name:"width",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.width.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(l.Field,{control:r.control,name:"length",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.length.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(l.Field,{control:r.control,name:"height",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.height.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(l.Field,{control:r.control,name:"weight",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.weight.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(l.Field,{control:r.control,name:"mid_code",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.mid_code.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t})})]})}),e.jsx(l.Field,{control:r.control,name:"hs_code",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.hs_code.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t})})]})}),e.jsx(l.Field,{control:r.control,name:"origin_country",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.countryOrigin.label")}),e.jsx(l.Control,{children:e.jsx(Q,{...t})})]})}),e.jsx(l.Field,{control:r.control,name:"material",render:({field:t})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.material.label")}),e.jsx(l.Control,{children:e.jsx(n,{...t})})]})})]})]})]})}),e.jsx(u.Content,{value:"availability",className:"size-full",children:e.jsx(de,{form:r,locations:a})})]}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(I,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(I,{size:"small",className:"whitespace-nowrap",isLoading:T,onClick:i!=="availability"?q:void 0,type:i==="availability"?"submit":"button",children:s(i==="availability"?"actions.save":"general.next")},i==="availability"?"details":"pricing")]})})]})})})}function He(){const{isPending:a,stock_locations:s,isError:x,error:i}=J({limit:9999,fields:"id,name"}),d=!a&&!!s;if(x)throw i;return e.jsx(h,{children:d&&e.jsx(he,{locations:s})})}export{He as Component};
