import{t as q}from"./chunk-3ISBJK7K-B3eevHdQ.js";import{C as G}from"./chunk-XDCNT5GQ-B0dIRHFU.js";import{i as J}from"./chunk-54IEHX46-DWMq7yL7.js";import{H as W}from"./chunk-7OYLCEKK-B-sdtvWw.js";import{y as O,j as e,u as M,z as A,r as p,c as Q,D as U,t as R,B as V,e as X,o as K,H as Y,q as Z,F as s,I as ee,p as se,E as P,G as re,J as B,s as b,n as te}from"./index-S35l5lon.js";import{K as ae}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as x,u as ie}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{P as m}from"./progress-tabs-DyqPaYnl.js";import{T as ne}from"./textarea-FJbwiCAd.js";import{S as n}from"./select-CmrtK7XQ.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./sortable.esm-G2J7QBKc.js";import"./dots-six-DvRLB6s4.js";import"./folder-illustration-D2z_kJwh.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";var le=({form:t})=>{const{t:r}=M(),d=A();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(Y,{children:r("categories.create.header")}),e.jsx(Z,{size:"small",className:"text-ui-fg-subtle",children:r("categories.create.hint")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"name",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.title")}),e.jsx(s.Control,{children:e.jsx(ee,{autoComplete:"off",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"handle",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,tooltip:r("collections.handleTooltip"),children:r("fields.handle")}),e.jsx(s.Control,{children:e.jsx(W,{...a})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(s.Field,{control:t.control,name:"description",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:r("fields.description")}),e.jsx(s.Control,{children:e.jsx(ne,{...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"status",render:({field:{ref:a,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("categories.fields.status.label")}),e.jsx(s.Control,{children:e.jsxs(n,{dir:d,...c,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"active",children:r("categories.fields.status.active")}),e.jsx(n.Item,{value:"inactive",children:r("categories.fields.status.inactive")})]})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"visibility",render:({field:{ref:a,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("categories.fields.visibility.label")}),e.jsx(s.Control,{children:e.jsxs(n,{dir:d,...c,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"public",children:r("categories.fields.visibility.public")}),e.jsx(n.Item,{value:"internal",children:r("categories.fields.visibility.internal")})]})]})}),e.jsx(s.ErrorMessage,{})]})})]})]})})},L="new-item",oe=({form:t,shouldFreeze:r})=>{const{t:d}=M(),[a,o]=p.useState([]),{product_categories:c,isPending:C,isError:_,error:T}=se({parent_category_id:"null",limit:9999,fields:"id,name,parent_category_id,rank,category_children,rank",include_descendants_tree:!0}),h=P({control:t.control,name:"parent_category_id"}),i=P({control:t.control,name:"rank"}),g=P({control:t.control,name:"name"}),N=p.useMemo(()=>J(c??[],{id:L,name:g,parent_category_id:h,rank:i,category_children:null}),[c,g,h,i]),w=({parentId:l,index:z},j)=>{t.setValue("parent_category_id",l,{shouldDirty:!0,shouldTouch:!0}),t.setValue("rank",z,{shouldDirty:!0,shouldTouch:!0}),o(j)};if(_)throw T;const S=!C&&!!c;return e.jsx(G,{value:r?a:N,enableDrag:l=>l.id===L,onChange:w,renderValue:l=>l.id===L?e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("span",{children:l.name}),e.jsx(re,{size:"2xsmall",color:"blue",children:d("categories.fields.new.label")})]}):l.name,isLoading:!S})},$=K({name:b().min(1),description:b().optional(),handle:b().optional(),status:B(["active","inactive"]),visibility:B(["public","internal"])}),ce=K({rank:te().nullable(),parent_category_id:b().nullable()}).merge($),de=({parentCategoryId:t})=>{var j,H;const{t:r}=M(),{handleSuccess:d}=ie(),a=A(),[o,c]=p.useState("details"),[C,_]=p.useState(!1),[T,h]=p.useState(!1),i=Q({defaultValues:{name:"",description:"",handle:"",status:"active",visibility:"public",rank:t?0:null,parent_category_id:t},resolver:X(ce)}),g=u=>{if(u==="organize"){const{name:F,handle:D,description:I,status:E,visibility:k}=i.getValues(),f=$.safeParse({name:F,handle:D,description:I,status:E,visibility:k});if(!f.success){f.error.errors.forEach(v=>{i.setError(v.path.join("."),{type:"manual",message:v.message})});return}i.clearErrors(),_(!0)}c(u)},{mutateAsync:N,isPending:w}=U(),S=i.handleSubmit(u=>{const{visibility:F,status:D,parent_category_id:I,rank:E,name:k,...f}=u,v=q(f,!1);h(!0),N({name:k,...v,parent_category_id:I??void 0,rank:E??void 0,is_active:D==="active",is_internal:F==="internal"},{onSuccess:({product_category:y})=>{R.success(r("categories.create.successToast",{name:y.name})),d(`/categories/${y.id}`)},onError:y=>{R.error(y.message),h(!1)}})}),l=(j=i.getFieldState("parent_category_id"))!=null&&j.isDirty||(H=i.getFieldState("rank"))!=null&&H.isDirty||o==="organize"?"in-progress":"not-started",z=C?"completed":"in-progress";return e.jsx(x.Form,{form:i,children:e.jsx(ae,{onSubmit:S,className:"flex size-full flex-col overflow-hidden",children:e.jsxs(m,{dir:a,value:o,onValueChange:u=>g(u),className:"flex size-full flex-col",children:[e.jsx(x.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(m.List,{className:"grid w-full grid-cols-2",children:[e.jsx(m.Trigger,{value:"details",status:z,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:r("categories.create.tabs.details")})}),e.jsx(m.Trigger,{value:"organize",status:l,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:r("categories.create.tabs.organize")})})]})})})}),e.jsxs(x.Body,{className:"flex size-full flex-col overflow-auto",children:[e.jsx(m.Content,{value:"details",children:e.jsx(le,{form:i})}),e.jsx(m.Content,{value:"organize",className:"bg-ui-bg-subtle flex-1",children:e.jsx(oe,{form:i,shouldFreeze:T})})]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(V,{size:"small",variant:"secondary",children:r("actions.cancel")})}),o==="organize"?e.jsx(V,{size:"small",variant:"primary",type:"submit",isLoading:w,children:r("actions.save")},"submit-btn"):e.jsx(V,{size:"small",variant:"primary",type:"button",onClick:()=>g("organize"),children:r("actions.continue")},"continue-btn")]})})]})})})},Fe=()=>{const[t]=O(),r=t.get("parent_category_id");return e.jsx(x,{children:e.jsx(de,{parentCategoryId:r})})};export{Fe as Component};
