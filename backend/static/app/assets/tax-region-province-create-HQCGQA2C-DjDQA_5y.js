import{g as S}from"./chunk-EHAU7SOS-CihDnY6t.js";import{P}from"./chunk-KEQOAJC2-7WPNwWw4.js";import{S as L}from"./chunk-PRLQLEEQ-CKYDE1LK.js";import{a as E,cZ as $,j as e,u as F,c as M,cW as B,t as _,H as C,q as T,F as a,r as R,I as y,T as z,cX as H,B as N,e as K,o as w,bk as V,s as g,n as k}from"./index-S35l5lon.js";import{K as q}from"./chunk-6HTZNHPT-USxWRfar.js";import{R as m,u as W}from"./chunk-AERWK3TJ-Gph8MRZF.js";import{S as f}from"./select-CmrtK7XQ.js";import"./index.esm-BQ-YgayW.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";var I=R.forwardRef(({disabled:t,placeholder:o,defaultValue:n,country_code:r,valueAs:i="iso_2",onChange:u,...d},c)=>{const{t:p}=F(),h=R.useRef(null);R.useImperativeHandle(c,()=>h.current);const s=S(r);s||(t=!0);const j=Object.entries((s==null?void 0:s.options)??{}).map(([l,b])=>e.jsx(f.Item,{value:i==="iso_2"?l.toLowerCase():b,children:b},l)),x=s?p(`taxRegions.fields.sublevels.placeholders.${s.type}`):"";return e.jsx("div",{className:"relative",children:e.jsxs(f,{...d,value:d.value?i==="iso_2"?d.value.toLowerCase():d.value:void 0,defaultValue:n?i==="iso_2"?n.toLowerCase():n:void 0,onValueChange:u,disabled:t,children:[e.jsx(f.Trigger,{ref:h,className:"w-full",children:e.jsx(f.Value,{placeholder:o||x})}),e.jsx(f.Content,{children:j})]})})});I.displayName="ProvinceSelect";var X=w({province_code:g().min(1),name:g().optional(),code:g().min(1),rate:w({float:k().optional(),value:g().optional()}).optional(),is_combinable:V().optional()}),Z=({parent:t})=>{const{t:o}=F(),{handleSuccess:n}=W(),r=M({defaultValues:{province_code:"",code:"",is_combinable:!1,name:"",rate:{value:""}},resolver:K(X)}),{mutateAsync:i,isPending:u}=B(),d=r.handleSubmit(async s=>{var x;const j=s.name&&((x=s.rate)!=null&&x.float)?{name:s.name,rate:s.rate.float,code:s.code,is_combinable:s.is_combinable}:void 0;await i({country_code:t.country_code,province_code:s.province_code,parent_id:t.id,default_tax_rate:j},{onSuccess:({tax_region:l})=>{_.success(o("taxRegions.create.successToast")),n(`/settings/tax-regions/${t.id}/provinces/${l.id}`)},onError:l=>{_.error(l.message)}})}),c=S(t.country_code),p=(c==null?void 0:c.type)||"sublevel",h=o(`taxRegions.fields.sublevels.labels.${p}`);return e.jsx(m.Form,{form:r,children:e.jsxs(q,{onSubmit:d,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(m.Header,{}),e.jsx(m.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(C,{children:o(`taxRegions.${p}.create.header`)}),e.jsx(T,{size:"small",className:"text-ui-fg-subtle",children:o(`taxRegions.${p}.create.hint`)})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(a.Field,{control:r.control,name:"province_code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{tooltip:!c&&o("taxRegions.fields.sublevels.tooltips.sublevel"),children:h}),e.jsx(a.Control,{children:c?e.jsx(I,{country_code:t.country_code,...s}):e.jsx(y,{...s,placeholder:"KR-26"})}),e.jsx(a.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(C,{level:"h2",className:"!txt-compact-small-plus",children:o("taxRegions.fields.defaultTaxRate.label")}),e.jsxs(T,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:["(",o("fields.optional"),")"]}),e.jsx(z,{content:o("taxRegions.fields.defaultTaxRate.tooltip"),children:e.jsx(H,{className:"text-ui-fg-muted"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(a.Field,{control:r.control,name:"name",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("fields.name")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"rate",render:({field:{value:s,onChange:j,...x}})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxRate")}),e.jsx(a.Control,{children:e.jsx(P,{...x,value:s==null?void 0:s.value,decimalsLimit:4,onValueChange:(l,b,v)=>j({value:l,float:v==null?void 0:v.float})})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxCode")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})})]})]}),e.jsx(L,{control:r.control,name:"is_combinable",label:o("taxRegions.fields.isCombinable.label"),description:o("taxRegions.fields.isCombinable.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(N,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(N,{size:"small",type:"submit",isLoading:u,children:o("actions.save")})]})})]})})},re=()=>{const{id:t}=E(),{tax_region:o,isPending:n,isError:r,error:i}=$(t),u=!n&&!!o;if(r)throw i;return e.jsx(m,{children:u&&e.jsx(Z,{parent:o})})};export{re as Component,re as TaxProvinceCreate};
