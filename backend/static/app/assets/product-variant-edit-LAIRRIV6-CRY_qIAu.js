import{o as y}from"./chunk-ZQRKUG6J-TyK87Nny.js";import{C as T}from"./chunk-BW4QA6B6-D7Qkz6P4.js";import{t as B,b}from"./chunk-3ISBJK7K-B3eevHdQ.js";import{C as K}from"./chunk-OFN7DIZA-C5u54b_Q.js";import{P as R,u as k,a as z,y as Q,dN as O,d2 as U,j as e,H as C,ei as $,M as _,c as A,e as G,ej as J,t as F,F as r,I as c,co as E,bI as I,B as L,O as W,o as X,bT as Y,s as h,bk as P}from"./index-S35l5lon.js";import{K as Z}from"./chunk-6HTZNHPT-USxWRfar.js";import{a as m,u as ee}from"./chunk-AERWK3TJ-Gph8MRZF.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./select-CmrtK7XQ.js";import"./check-B9bFzKnZ.js";import"./triangles-mini-CX2619vl.js";import"./combobox-provider-CcO6EPfN.js";import"./plus-mini-B5zW_eay.js";import"./focus-modal-B7NOABos.js";import"./prompt-YaiseBxh.js";var re=X({title:h().min(1),material:h().optional(),sku:h().optional(),ean:h().optional(),upc:h().optional(),barcode:h().optional(),manage_inventory:P(),allow_backorder:P(),weight:y,height:y,width:y,length:y,mid_code:h().optional(),hs_code:h().optional(),origin_country:h().optional(),options:Y(h())}),se=({variant:o,product:x})=>{var f,p;const{t}=k(),{handleSuccess:g}=ee(),j=(f=x.options)==null?void 0:f.reduce((s,a)=>{var d;const i=(d=o.options)==null?void 0:d.find(u=>u.option_id===a.id);return s[a.title]=i==null?void 0:i.value,s},{}),n=A({defaultValues:{title:o.title||"",material:o.material||"",sku:o.sku||"",ean:o.ean||"",upc:o.upc||"",barcode:o.barcode||"",manage_inventory:o.manage_inventory||!1,allow_backorder:o.allow_backorder||!1,weight:o.weight||"",height:o.height||"",width:o.width||"",length:o.length||"",mid_code:o.mid_code||"",hs_code:o.hs_code||"",origin_country:o.origin_country||"",options:j},resolver:G(re)}),{mutateAsync:l,isPending:w}=J(o.product_id,o.id),v=n.handleSubmit(async s=>{const{title:a,weight:i,height:d,width:u,length:M,allow_backorder:N,manage_inventory:V,options:S,...D}=s,H=B(D);await l({id:o.id,weight:b(i),height:b(d),width:b(u),length:b(M),title:a,allow_backorder:N,manage_inventory:V,options:S,...H},{onSuccess:()=>{g("../"),F.success(t("products.variant.edit.success"))},onError:q=>{F.error(q.message)}})});return e.jsx(m.Form,{form:n,children:e.jsxs(Z,{onSubmit:v,className:"flex size-full flex-col overflow-hidden",children:[e.jsxs(m.Body,{className:"flex size-full flex-col gap-y-8 overflow-auto",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:n.control,name:"title",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.title")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"material",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.material")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),(p=x.options)==null?void 0:p.map(s=>e.jsx(r.Field,{control:n.control,name:`options.${s.title}`,render:({field:{value:a,onChange:i,...d}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s.title}),e.jsx(r.Control,{children:e.jsx(K,{value:a,onChange:u=>{i(u)},...d,options:s.values.map(u=>({label:u.value,value:u.value}))})})]})},s.id))]}),e.jsx(E,{}),e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(C,{level:"h2",children:t("products.variant.inventory.header")}),e.jsx(r.Field,{control:n.control,name:"sku",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.sku")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"ean",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.ean")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"upc",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.upc")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"barcode",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.barcode")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(r.Field,{control:n.control,name:"manage_inventory",render:({field:{value:s,onChange:a,...i}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:t("products.variant.inventory.manageInventoryLabel")}),e.jsx(r.Control,{children:e.jsx(I,{dir:"ltr",checked:s,className:"rtl:rotate-180",onCheckedChange:d=>a(!!d),...i})})]}),e.jsx(r.Hint,{children:t("products.variant.inventory.manageInventoryHint")})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"allow_backorder",render:({field:{value:s,onChange:a,...i}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:t("products.variant.inventory.allowBackordersLabel")}),e.jsx(r.Control,{children:e.jsx(I,{dir:"ltr",className:"rtl:rotate-180",checked:s,onCheckedChange:d=>a(!!d),...i})})]}),e.jsx(r.Hint,{children:t("products.variant.inventory.allowBackordersHint")})]}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(E,{}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(C,{level:"h2",children:t("products.attributes")}),e.jsx(r.Field,{control:n.control,name:"weight",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.weight")}),e.jsx(r.Control,{children:e.jsx(c,{type:"number",...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"width",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.width")}),e.jsx(r.Control,{children:e.jsx(c,{type:"number",...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"length",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.length")}),e.jsx(r.Control,{children:e.jsx(c,{type:"number",...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"height",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.height")}),e.jsx(r.Control,{children:e.jsx(c,{type:"number",...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"mid_code",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.midCode")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"hs_code",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.hsCode")}),e.jsx(r.Control,{children:e.jsx(c,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"origin_country",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:t("fields.countryOfOrigin")}),e.jsx(r.Control,{children:e.jsx(T,{...s})}),e.jsx(r.ErrorMessage,{})]})})]})]}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(L,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(L,{type:"submit",size:"small",isLoading:w,children:t("actions.save")})]})})]})})},be=()=>{const o=R(),{t:x}=k(),{id:t,variant_id:g}=z(),[j]=Q(),n=j.get("variant_id"),{variant:l,isPending:w,isError:v,error:f}=O(t,g||n,void 0,{initialData:o}),{product:p,isPending:s,isError:a,error:i}=U(l==null?void 0:l.product_id,{fields:"-variants"},{enabled:!!(l!=null&&l.product_id)}),d=!w&&!!l&&!s&&!!p;if(v)throw f;if(a)throw i;return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(C,{children:x("products.variant.edit.header")})}),d&&e.jsx(se,{variant:l,product:p})]})},oe=async(o,x)=>await W.admin.product.retrieveVariant(o,x),te=(o,x)=>({queryKey:$.detail(x),queryFn:async()=>oe(o,x)}),we=async({params:o,request:x})=>{const t=o.id,j=new URL(x.url).searchParams.get("variant_id"),n=o.variant_id||j,l=te(t,n||j);return _.getQueryData(l.queryKey)??await _.fetchQuery(l)};export{be as Component,we as loader};
